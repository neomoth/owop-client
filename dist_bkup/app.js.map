{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/events/events.js","webpack:///./src/audio/click.mp3","webpack:///./src/audio/launch.mp3","webpack:///./src/audio/place.mp3","webpack:///./src/img/toolset.png","webpack:///./src/img/unloaded.png","webpack:///./src/js/Fx.js","webpack:///./src/js/Player.js","webpack:///./src/js/World.js","webpack:///./src/js/canvas_renderer.js","webpack:///./src/js/captcha.js","webpack:///./src/js/conf.js","webpack:///./src/js/context.js","webpack:///./src/js/global.js","webpack:///./src/js/local_player.js","webpack:///./src/js/main.js","webpack:///./src/js/networking.js","webpack:///./src/js/polyfill/canvas-toBlob.js","webpack:///./src/js/protocol/Protocol.js","webpack:///./src/js/protocol/all.js","webpack:///./src/js/protocol/old.js","webpack:///./src/js/tool_renderer.js","webpack:///./src/js/tools.js","webpack:///./src/js/util/Bucket.js","webpack:///./src/js/util/Lerp.js","webpack:///./src/js/util/anchorme.js","webpack:///./src/js/util/color.js","webpack:///./src/js/util/misc.js","webpack:///./src/js/util/normalizeWheel.js","webpack:///./src/js/windowsys.js"],"names":["PLAYERFX","NONE","RECT_SELECT_ALIGNED","pixelSize","htmlColor","fx","ctx","time","x","extra","player","y","fxx","Math","floor","camera","zoom","fxy","globalAlpha","strokeStyle","htmlRgb","strokeRect","WORLDFX","RECT_FADE_ALIGNED","size","startTime","alpha","delete","s","options","enableIdView","rank","RANK","MODERATOR","tag","str","ts","measureText","width","fillStyle","strokeText","fillText","activeFx","Fx","renderFunc","visible","push","func","Object","defineProperty","get","bool","i","indexOf","splice","PublicAPI","world","class","eventSys","on","e","net","tilesUpdated","made","tiles","length","t","isVisible","color","toHTML","rgb","id","renderer","render","rendertype","FX","chunk","set","chunkX","chunkY","data","wX","protocol","chunkSize","wY","lock","state","local","Player","tool","toString","_x","Lerp","_y","tools","fxType","setVisible","misc","validMousePos","endX","endY","u24_888","clr","playerListEntry","document","createElement","innerHTML","playerList","playerListTable","appendChild","val","setRenderer","fxRenderer","childNodes","removeChild","end","lastPlace","Chunk","netdata","locked","needsRedraw","tmpChunkBuf","view","lockedNeighbors","cb","j","Number","isInteger","fill","fillFromBuf","emit","unload","dir","UP","RIGHT","DOWN","LEFT","World","worldName","name","chunks","protectedChunks","players","undoHistory","pathUpdaterTimeout","pathFx","retval","path","noUi","l","lineWidth","setTransform","placeTime","patterns","unloaded","showProtectionOutlines","stroke","loadCFunc","chunkLoaded","unloadCFunc","chunkUnloaded","setCFunc","chunkPasted","lockCFunc","newState","chunkLocked","disconnectedFunc","leave","updateTileFunc","updatePlayerFunc","playersMoved","p","destroyPlayerFunc","playersLeft","leaveWFunc","unloadAllChunks","keys","removeListener","load","disconnected","once","d","mainPath","Path2D","vpoints","hpoints","addPoint","fy","tx","ty","points","fkey","tkey","newTo","newFrom","k","ln","polys","pointobjs","a","split","moveTo","prev","next","lineTo","closePath","checkSide","to","from","sidec","getChunkAt","clearTimeout","setTimeout","update","makeLockedChunksPath","key","isConnected","requestChunk","allChunksLoaded","chunksUpdated","c","updateChunk","rendered","u","ids","disconnect","noUndo","Date","now","oldPixel","getPixel","updatePixel","colorUtils","sounds","play","place","bulkUndo","eq","b","changeTime","undo","px","shouldContinue","unchanged","setPixel","tileX","tileY","findNeighborLockedChunks","addChunk","rmChunk","remove","drawText","unloadFarClusters","centerCameraTo","moveCameraBy","moveCameraTo","cameraValues","z","min","zoomLimitMax","max","zoomLimitMin","center","getCenterPixel","rendererValues","updateRequired","animContext","gridShown","gridPattern","unloadedPattern","worldBackground","minGridZoom","updatedClusters","clusters","visibleClusters","currentFontSize","ALL","WORLD","requestRender","showGrid","setGridVisibility","updateCamera","onCameraMove","BufView","u32data","w","h","realw","chunkBugWorkaround","changes","offx","offy","realwidth","height","u32buf","ChunkCluster","removed","toUpdate","shown","canvas","clusterChunkAmount","getContext","createImageData","Uint32Array","buffer","currentColor","arr","current","fillRect","putImageData","visiblecl","centered","visibilityState","cx","cy","czoom","cw","window","innerWidth","ch","innerHeight","camx","camy","camw","camh","ctrx","ctry","dx","abs","dy","dist","unloadDistance","type","needsRender","uClusters","clusterCanvasSize","cwidth","cheight","background","bggx","bggy","clearRect","translate","scale","cluster","gx","gy","clipx","clipy","clipw","cliph","drawImage","fontsize","font","showPlayers","renderPlayer","targetPlayer","cnvs","toolwidth","cursor","toolheight","offset","idstr","textw","enabled","renderGrid","tmpcanvas","round","setLineDash","fadeMult","beginPath","createPattern","setGridZoom","updateVisible","onResize","elements","animCanvas","imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","oImageSmoothingEnabled","alignCamera","alignedX","alignedY","requestMissingChunks","mx","my","loadChunk","moved","isNaN","teleported","clusterX","clusterY","delChunk","worldInitialized","init","addEventListener","defaultZoom","mkPatternFromUrl","url","patImg","Image","onload","pat","src","unloadedPatternUrl","backgroundUrl","frameLoop","requestAnimationFrame","toolsInitialized","loadAndRequestCaptcha","SITEKEY","loadCaptcha","grecaptcha","callback","bind","loadingCaptcha","requestVerification","windowSys","addWindow","GUIWindow","wdow","addObj","theme","sitekey","captchaToken","token","close","frame","style","cssText","container","localStorage","owopcaptcha","evtId","USER","ADMIN","EVENTS","loaded","tick","toolsRendered","logoMakeRoom","windowAdded","connecting","connected","playerCount","chat","devChat","join","joining","setId","allLoaded","sec","maxCount","donUntil","PUBLIC_EVENTS","camMoved","camZoomed","events","userOptions","JSON","parse","getItem","console","error","shouldFool","getDefaultWorld","navigator","language","languages","startsWith","serverAddress","default","title","proto","fallbackFps","maxChatBuffer","tickSpeed","movementSpeed","defaultWorld","enableSounds","zoomStrength","toolSetUrl","toolSet","unloadedPat","fool","hexCoords","debug","server","createContextMenu","contextMenu","className","removeMenu","event","body","removeEventListener","buttons","button","textContent","offsetHeight","log","top","left","OWOP","WorldOfPixels","AnnoyingAPI","ws","WebSocket","EventEmitter","wsTroll","send","shift","eval","shouldUpdate","getDefaultTool","updateClientFx","toolSelected","palette","paletteIndex","clientFx","isLocalPlayer","mouse","worldX","worldY","setVisibleFunc","insideViewport","validTile","networkRankVerification","somethingChanged","cachedHtmlRgb","updatePalette","selClr","selectedColor","addPaletteColor","selectTool","toolId","currentServer","changedColor","updatePaletteIndex","paletteColors","colorClick","index","colorDelete","element","backgroundColor","onmouseup","sel","del","oncontextmenu","transform","toolName","rankRequired","call","cancelMouseDown","validClick","newRank","Uint8Array","paletteInput","onclick","value","onchange","exec","parseInt","paletteCreate","click","revealSecrets","retryingConnect","showDevChat","showPlayerList","statusMsg","keysDown","lastX","lastY","mouseDownWorldX","mouseDownWorldY","touches","viewport","xyDisplay","chatInput","_world","lastXYDisplay","devRecvReader","chatPostFormatRecvModifier","msg","chatRecvModifier","chatSendModifier","exceptionTimeout","worldPasswords","urlWorldName","tickInterval","lastMessage","lastCleanup","getNewWorldApi","guiShown","cookiesEnabled","storageEnabled","showEUCookieNag","usingFirefox","userAgent","donTimer","sound","currentTime","launch","Audio","launchSoundUrl","placeSoundUrl","clickSoundUrl","playerListWindow","closeable","tableHeader","move","obj","defProp","prop","receiveMessage","text","addContext","elem","nickname","clientX","clientY","muted","stopPropagation","message","realText","isAdmin","nick","slice","cuttxt","includes","charAt","idIndex","ntext","substr","replace","incCount","span","times","recvTimes","attributes","animation","textByNls","firstNl","scrollChatToBottom","chatMessages","childs","children","receiveDevMessage","devChatMessages","scrollTop","scrollHeight","dontScrollIfNotTop","shouldScroll","clientHeight","clearChat","tickNum","speed","offX","offY","updateMouse","eventName","mouseX","mouseY","cancelled","updateXYDisplay","openChat","closeChat","blur","display","delWindow","hexify","updatePlayerCount","countStr","final","playerCountDisplay","loadUl","showWorldUI","disabled","paletteBg","visibility","helpButton","topRightDisplays","classList","showLoadScr","showOptions","loadOptions","loadScr","showSpinner","statusShown","status","spinner","inGameDisconnected","serverGetter","tryConnect","tryN","maxRetries","ncs","connect","saveWorldPasswords","stringify","checkFunctionality","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","f","n","Infinity","trunc","toBlob","HTMLCanvasElement","prototype","msToBlob","require","chatinput","chatHistory","historyIndex","keyCode","which","shiftKey","preventDefault","unshift","adminlogin","modlogin","pass","ctrlKey","sendMessage","activeElement","tagName","isEventDefined","parseClr","tmp","nrgb","colr","input","prompt","focus","pageX","pageY","realBtn","cancelledButtons","remainingButtons","mousewheel","nevt","pixelY","delta","spinY","pIndex","wheelEventName","passive","touchEventNoUpdate","evtName","changedTouches","soundToggle","checked","hexToggle","decodeURIComponent","location","pathname","defaults","availableServers","serverList","sv","reconnectBtn","setInterval","UtilDialog","count","pmult","updTimer","secs","mins","hours","tmer","dInfoDisplay","setAttribute","clearInterval","autoNick","desiredRank","mightBeMod","onWrong","onCorrect","newrank","errmsg","stack","getElementById","logo","windows","donateBtn","PayPal","Donation","Button","env","hosted_button_id","custom","encodeURIComponent","image","getAttribute","alt","clear","onDevMsg","fn","postFormatRecvModifier","recvModifier","sendModifier","poke","lastSentX","captcha","connection","aa","binaryType","module","exports","__webpack_public_path__","Protocol","lasterr","subClass","messageHandler","openHandler","closeHandler","errorHandler","readyState","OPEN","err","resolveProtocols","definedProtos","OldProtocol","captchaState","CA_WAITING","CA_VERIFYING","CA_VERIFIED","CA_OK","CA_INVALID","netUpdateSpeed","maxWorldNameLength","worldBorder","chatBucket","placeBucket","maxMessageLength","worldVerification","chatVerification","String","fromCharCode","tokenVerification","opCode","client","worldUpdate","chunkLoad","teleport","setRank","setPQuota","chunkProtected","stoi","string","ints","fstring","toLowerCase","charCode","charCodeAt","OldProtocolImpl","lastSentY","playercount","chunksLoading","waitingForChunks","pendingEdits","params","Bucket","placeBucketMult","donUntilTs","interval","clet","joinFunc","lastCheck","allowance","sendUpdates","rankChanged","infinite","maxLength","leaveFunc","dv","DataView","oc","getUint8","getUint32","shouldrender","updated","updates","pid","pmx","getInt32","pmy","pr","pg","pb","ptool","off","getUint16","bid","bpx","bpy","br","bg","bb","bbgr","edkey","edtmoid","decreased","dpid","u8data","byteLength","joinWorld","rate","per","oallownc","pow","nstr","array","ArrayBuffer","setUint8","setUint16","wb","setInt32","undocb","distx","disty","sqrt","canSpend","worldx","worldy","lastx","lasty","selrgb","buf","cursors","imgpos","hotspot","pipette","erase","brush","select","selectprotect","copy","paste","cut","wand","shield","kick","ban","write","reduce","nw","nh","idat","getImageData","u32dat","xoff","yoff","shadow","img","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","popOut","shadowcolor","backgroundcolor","oncomplete","crossOrigin","slotcanvas","original","shadowed","shadowblob","blob","URL","createObjectURL","slotset","updateToolWindow","updateToolbar","showToolsWindow","addTool","toolsWindow","windowShown","isSelected","backgroundImage","cursorblob","win","toolButtonClick","mask","backgroundPosition","setposition","Tool","rankNeeded","onInit","mouseup","mousedown","mousemove","touchstart","touchmove","touchend","touchcancel","deselect","keydown","keyup","scroll","apply","defaultTouchHandler","handlers","start","cancel","handler","toolsApi","addToolObject","allTools","setEvent","usedButtons","pixel","startX","startY","rawEvent","spinX","pxAmount","fillChunk","empty","firstLoop","clearChunk","lzoom","nzoom","maxTouches","setFxRenderer","oldlinew","rect","sin","oldfont","txt","clicking","txtx","txty","dlarea","onblob","pix","isInside","finish","cvs","centerOnce","props","reverse","r","shownSize","add","tickAmount","queue","fillingColor","defaultFx","check","painted","pop","thisClr","bottom","right","line","x1","y1","x2","y2","plot","sx","sy","e2","pc","protectChunk","rw","rh","isSure","timeout","sure","rx","ry","isChunkSolid","lastClr","forEach","sendQueue","q","cs","paint","tmpBuffer","dat","totalChunksW","ceil","totalChunksH","getModifiedPixel","imgY","imgX","currentPixel","wreckStuff","g","getModifiedChunk","modified","Error","setChunk","tw","newChunk","nbuf","accept","files","reader","FileReader","target","result","readAsDataURL","oldSelect","getTime","ms","amt","v","define","ips","emails","urls","truncate","defaultProtocol","list","defaultOptions","isPort","tlds","htmlAttrs","match","o","test","fixSeparators","separate","deSeparate","map","encodeURI","reason","raw","encoded","exclude","substring","validate","ip","email","__esModule","to888","R","G","B","to565","u16_565","u32_888","u16_565_to_888","arrFrom565","setCookie","getCookie","propertyDefaults","absMod","htmlToElement","escapeHTML","mkHTML","loadScript","eventOnce","setTooltip","waitFrames","decompress","util","cookie","idx","cookieEnabled","hasOwnProperty","n1","n2","html","content","firstChild","opts","elm","getElementsByTagName","ev","elementSpacing","intr","tip","tooltip","epos","getBoundingClientRect","tpos","mleave","menter","u8arr","originalLength","u8decompressedarr","numOfRepeats","uptr","cptr","currentRepeatLoc","repeatedNum","repeatedColorR","repeatedColorG","repeatedColorB","normalizeWheel","PIXEL_STEP","LINE_HEIGHT","PAGE_HEIGHT","sX","sY","pX","pY","detail","wheelDelta","wheelDeltaY","wheelDeltaX","axis","HORIZONTAL_AXIS","deltaY","deltaX","deltaMode","pixelX","UtilInput","OWOPDropDown","centerWindow","dialog","dropDown","closeAllWindows","inputType","inputField","placeholder","onkeyup","okButton","getWindow","resize","canClose","messageBox","immobile","hlpdiv","hidebtn","hlpcontainer","initfunc","wm","windowsys","opt","random","titlespan","offsetWidth","creationtime","currentaction","mdownfunc","mupfunc","mmovefunc","touchfuncbuilder","object","delObj","onclose","realWindow","realh"],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;AClFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEa;;AAEb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,sBAAsB;AACvC;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA,cAAc;AACd;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA,mBAAmB,SAAS;AAC5B;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA,iCAAiC,QAAQ;AACzC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,OAAO;AACP;AACA,sCAAsC,QAAQ;AAC9C;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;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","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/js/main.js\");\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","module.exports = __webpack_public_path__ + \"audio/click.mp3\";","module.exports = __webpack_public_path__ + \"audio/launch.mp3\";","module.exports = __webpack_public_path__ + \"audio/place.mp3\";","module.exports = __webpack_public_path__ + \"img/toolset.png\";","module.exports = __webpack_public_path__ + \"img/unloaded.png\";","\"use strict\";\r\nimport { colorUtils as color } from './util/color.js';\r\nimport { EVENTS as e, protocol, RANK, options } from './conf.js';\r\nimport { getTime } from './util/misc.js';\r\nimport { eventSys, PublicAPI } from './global.js';\r\nimport { camera, renderer, ghosts, Ghost } from './canvas_renderer.js';\r\nimport { player } from './local_player.js';\r\nimport { misc } from './main.js';\r\n\r\nexport const PLAYERFX = {\r\n\tNONE: null,\r\n\tRECT_SELECT_ALIGNED: (pixelSize, htmlColor) => (fx, ctx, time) => {\r\n\t\tvar x = fx.extra.player.x;\r\n\t\tvar y = fx.extra.player.y;\r\n\t\tvar fxx = (Math.floor(x / (16 * pixelSize)) * pixelSize - camera.x) * camera.zoom;\r\n\t\tvar fxy = (Math.floor(y / (16 * pixelSize)) * pixelSize - camera.y) * camera.zoom;\r\n\t\tctx.globalAlpha = 0.8;\r\n\t\tctx.strokeStyle = htmlColor || fx.extra.player.htmlRgb;\r\n\t\tctx.strokeRect(fxx, fxy, camera.zoom * pixelSize, camera.zoom * pixelSize);\r\n\t\treturn 1; /* Rendering finished (won't change on next frame) */\r\n\t}\r\n};\r\n\r\nexport const WORLDFX = {\r\n\tNONE: null,\r\n\tRECT_FADE_ALIGNED: (size, x, y, startTime = getTime()) => (fx, ctx, time) => {\r\n\t\tvar alpha = 1 - (time - startTime) / 1000;\r\n\t\tif (alpha <= 0) {\r\n\t\t\tfx.delete();\r\n\t\t\treturn 2; /* 2 = An FX object was deleted */\r\n\t\t}\r\n\t\tvar fxx = (x * size - camera.x) * camera.zoom;\r\n\t\tvar fxy = (y * size - camera.y) * camera.zoom;\r\n\t\tvar s = camera.zoom * size;\r\n\t\tctx.globalAlpha = alpha;\r\n\t\tctx.strokeStyle = fx.extra.htmlRgb || \"#000000\";\r\n\t\tctx.strokeRect(fxx, fxy, s, s);\r\n\t\tif (options.enableIdView && player.rank >= RANK.MODERATOR && camera.zoom >= 8 && fx.extra.tag) {\r\n\t\t\tfxx += s;\r\n\t\t\tvar str = fx.extra.tag;\r\n\t\t\tvar ts = ctx.measureText(str).width;\r\n\t\t\tctx.fillStyle = \"#FFFFFF\";\r\n\t\t\tctx.strokeStyle = \"#000000\";\r\n\t\t\tctx.strokeText(str, fxx, fxy);\r\n\t\t\tctx.fillText(str, fxx, fxy);\r\n\t\t}\r\n\r\n\t\treturn 0; /* 0 = Animation not finished */\r\n\t}\r\n};\r\n\r\nexport const activeFx = [];\r\n\r\n/*PublicAPI.activeFx = activeFx;*/\r\n\r\nexport class Fx {\r\n    constructor(renderFunc, extra) {\r\n\t\tthis.visible = true;\r\n\t\tthis.renderFunc = renderFunc;\r\n\t\tthis.extra = extra || {};\r\n\t\tactiveFx.push(this);\r\n\t}\r\n\r\n\trender(ctx, time) {\r\n\t\tif (this.renderFunc && this.visible) {\r\n\t\t\treturn this.renderFunc(this, ctx, time);\r\n\t\t}\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tsetVisibleFunc(func) {\r\n\t\tObject.defineProperty(this, 'visible', {\r\n\t\t\tget: func\r\n\t\t});\r\n\t}\r\n\r\n\tsetVisible(bool) {\r\n\t\tthis.visible = bool;\r\n\t}\r\n\r\n\tsetRenderer(func) {\r\n\t\tthis.renderFunc = func;\r\n\t}\r\n\r\n\tupdate(extra) {\r\n\t\tthis.extra = extra;\r\n\t}\r\n\r\n\tdelete() {\r\n\t\tvar i = activeFx.indexOf(this);\r\n\t\tif(i !== -1) {\r\n\t\t\tactiveFx.splice(i, 1);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nPublicAPI.fx = {\r\n\tworld: WORLDFX,\r\n\tplayer: PLAYERFX,\r\n\tclass: Fx\r\n};\r\n\r\neventSys.on(e.net.world.tilesUpdated, tiles => {\r\n\tlet time = getTime(true);\r\n\tlet made = false;\r\n\r\n\tfor (var i = 0; i < tiles.length; i++) {\r\n\t\tvar t = tiles[i];\r\n\r\n\t\tif (camera.isVisible(t.x, t.y, 1, 1)) {\r\n\t\t\tnew Fx(WORLDFX.RECT_FADE_ALIGNED(1, t.x, t.y), { htmlRgb: color.toHTML(t.rgb ^ 0xFFFFFF) , tag: '' + t.id});\r\n\t\t\tmade = true;\r\n\t\t}\r\n\t}\r\n\tif (made) {\r\n\t\trenderer.render(renderer.rendertype.FX);\r\n\t}\r\n});\r\n\r\neventSys.on(e.net.chunk.set, (chunkX, chunkY, data) => {\r\n\tvar wX = chunkX * protocol.chunkSize;\r\n\tvar wY = chunkY * protocol.chunkSize;\r\n\tif (camera.isVisible(wX, wY, protocol.chunkSize, protocol.chunkSize)) {\r\n\t\tnew Fx(WORLDFX.RECT_FADE_ALIGNED(16, chunkX, chunkY));\r\n\t\trenderer.render(renderer.rendertype.FX);\r\n\t}\r\n});\r\n\r\neventSys.on(e.net.chunk.lock, (chunkX, chunkY, state, local) => {\r\n\tvar wX = chunkX * protocol.chunkSize;\r\n\tvar wY = chunkY * protocol.chunkSize;\r\n\tif (!local && camera.isVisible(wX, wY, protocol.chunkSize, protocol.chunkSize)) {\r\n\t\tnew Fx(WORLDFX.RECT_FADE_ALIGNED(16, chunkX, chunkY), {\r\n\t\t\thtmlRgb: state ? \"#00FF00\" : \"#FF0000\"\r\n\t\t});\r\n\t\trenderer.render(renderer.rendertype.FX);\r\n\t}\r\n});","'use strict';\nimport { Lerp } from './util/Lerp.js';\nimport { colorUtils as color } from './util/color.js';\nimport { misc, playerList, playerListTable } from './main.js';\nimport { Fx, PLAYERFX } from './Fx.js';\nimport { tools } from './tools.js';\n\nexport class Player {\n    constructor(x, y, rgb, tool, id) {\n        this.id = id.toString(); /* Prevents calling .toString every frame */\n        this._x = new Lerp(x, x, 65);\n        this._y = new Lerp(y, y, 65);\n\n        this.tool = tools[tool] || tools['cursor'];\n        this.fx = new Fx(tool ? tool.fxType : PLAYERFX.NONE, { player: this });\n        this.fx.setVisible(misc.world.validMousePos(\n            Math.floor(this.endX / 16), Math.floor(this.endY / 16)));\n\n        this.rgb = rgb;\n        this.htmlRgb = color.toHTML(color.u24_888(rgb[0], rgb[1], rgb[2]));\n\n        this.clr = (((id + 75387) * 67283 + 53143) % 256) << 16\n                 | (((id + 9283)  * 4673  + 7483)  % 256) << 8\n                 | (  id * 3000                    % 256);\n        this.clr = color.toHTML(this.clr);\n\n\t\tvar playerListEntry = document.createElement(\"tr\");\n\t\tplayerListEntry.innerHTML = \"<td>\" + this.id + \"</td><td>\" + Math.floor(x / 16) + \"</td><td>\" + Math.floor(y / 16) + \"</td>\";\n\t\tplayerList[this.id] = playerListEntry;\n\t\tplayerListTable.appendChild(playerListEntry);\n\t}\n\t\n\tget tileX() {\n\t\treturn Math.floor(this.x / 16);\n\t}\n\n\tget tileY() {\n\t\treturn Math.floor(this.y / 16);\n\t}\n\n    get endX() {\n        return this._x.end;\n    }\n\n    get endY() {\n        return this._y.end;\n    }\n\n    get x() {\n        return this._x.val;\n    }\n\n    get y() {\n        return this._y.val;\n    }\n\n    update(x, y, rgb, tool) {\n        this._x.val = x;\n        this._y.val = y;\n        /* TODO: fix weird bug (caused by connecting before tools initialized?) */\n        //console.log(tool)\n        this.tool = tools[tool] || tools['cursor'];\n        this.fx.setRenderer((this.tool || {}).fxRenderer ); // temp until fix: || {}\n        this.fx.setVisible(misc.world.validMousePos(\n            Math.floor(this.endX / 16), Math.floor(this.endY / 16)));\n        this.rgb = rgb;\n        this.htmlRgb = color.toHTML(color.u24_888(rgb[0], rgb[1], rgb[2]));\n\n\t\tplayerList[this.id].childNodes[1].innerHTML = Math.floor(x / 16);\n\t\tplayerList[this.id].childNodes[2].innerHTML = Math.floor(y / 16);\n    }\n\n    disconnect() {\n        this.fx.delete();\n\n\t\tplayerListTable.removeChild(playerList[this.id]);\n\t\tdelete playerList[this.id];\n    }\n}\n","\"use strict\";\nimport { protocol, EVENTS as e, options, RANK } from './conf.js';\nimport { eventSys } from './global.js';\nimport { colorUtils } from './util/color.js';\nimport { net } from './networking.js';\nimport { camera, isVisible, renderer } from './canvas_renderer.js';\nimport { mouse, sounds } from './main.js';\nimport { player } from './local_player.js';\nimport { Player } from './Player.js';\nimport { Fx } from './Fx.js';\n\nlet lastPlace = 0;\n\nexport class Chunk {\n\tconstructor(x, y, netdata, locked) { /* netdata = Uint32Array */\n\t\tthis.needsRedraw = false;\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.tmpChunkBuf = netdata;\n\t\tthis.view = null;\n\t\tthis.locked = locked;\n\t\tthis.lockedNeighbors = 0b0000; /* Up, Right, Down, Left */\n\t}\n\n\tupdate(x, y, color) {\n\t\t/* WARNING: Should absMod if not power of two */\n\t\tx &= (protocol.chunkSize - 1);\n\t\ty &= (protocol.chunkSize - 1);\n\t\tthis.view.set(x, y, 0xFF000000 | color);\n\t\tthis.needsRedraw = true;\n\t}\n\n\tforEach(cb) {\n\t\tvar s = protocol.chunkSize;\n\t\tfor (var i = 0; i < s; i++) {\n\t\t\tfor (var j = 0; j < s; j++) {\n\t\t\t\tif (!cb(j, i, this.get(j, i))) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tget(x, y) {\n\t\tx &= (protocol.chunkSize - 1);\n\t\ty &= (protocol.chunkSize - 1);\n\t\treturn this.view.get(x, y);\n\t}\n\n\tset(data) {\n\t\tif (Number.isInteger(data)) {\n\t\t\tthis.view.fill(0xFF000000 | data);\n\t\t} else {\n\t\t\tthis.view.fillFromBuf(data);\n\t\t}\n\t\tthis.needsRedraw = true;\n\t}\n\n\tremove() { /* Can be called when manually unloading too */\n\t\teventSys.emit(e.net.chunk.unload, this);\n\t}\n}\nChunk.dir = {\n\tUP: 0b1000,\n\tRIGHT: 0b0100,\n\tDOWN: 0b0010,\n\tLEFT: 0b0001\n};\n\nexport class World {\n\tconstructor(worldName) {\n\t\tthis.name = worldName;\n\t\tthis.chunks = {};\n\t\tthis.protectedChunks = {};\n\t\tthis.players = {};\n\t\tthis.undoHistory = [];\n\t\tthis.pathUpdaterTimeout = -1;\n\t\tthis.pathFx = new Fx((fx, ctx, time) => {\n\t\t\tvar retval = 1;\n\t\t\tif (fx.extra.path && !options.noUi) {\n\t\t\t\tctx.strokeStyle = \"#525252\";\n\t\t\t\tvar l = ctx.lineWidth;\n\t\t\t\tctx.lineWidth = 3 / camera.zoom;\n\t\t\t\tctx.setTransform(camera.zoom, 0, 0, camera.zoom, -camera.x * camera.zoom, -camera.y * camera.zoom);\n\t\t\t\tif (time - fx.extra.placeTime < 1500) {\n\t\t\t\t\tctx.globalAlpha = (1 - (time - fx.extra.placeTime) / 1500) * 0.5;\n\t\t\t\t\tctx.fillStyle = renderer.patterns.unloaded;\n\t\t\t\t\tctx.fill(fx.extra.path);\n\t\t\t\t\tretval = 0;\n\t\t\t\t}\n\t\t\t\tctx.globalAlpha = 0.75;\n\t\t\t\tif (options.showProtectionOutlines) {\n\t\t\t\t\tctx.stroke(fx.extra.path);\n\t\t\t\t}\n\t\t\t\tctx.setTransform(1, 0, 0, 1, 0, 0);\n\t\t\t\tctx.lineWidth = l;\n\t\t\t}\n\t\t\treturn retval;\n\t\t});\n\n\t\tconst loadCFunc = chunk => this.chunkLoaded(chunk);\n\t\tconst unloadCFunc = chunk => this.chunkUnloaded(chunk);\n\t\tconst setCFunc = (x, y, data) => this.chunkPasted(x, y, data);\n\t\tconst lockCFunc = (x, y, newState) => this.chunkLocked(x, y, newState);\n\t\tconst disconnectedFunc = () => eventSys.emit(e.net.world.leave);\n\t\tconst updateTileFunc = t => this.tilesUpdated(t);\n\t\tconst updatePlayerFunc = p => this.playersMoved(p);\n\t\tconst destroyPlayerFunc = p => this.playersLeft(p);\n\t\tconst leaveWFunc = () => {\n\t\t\tthis.pathFx.delete();\n\t\t\tthis.unloadAllChunks();\n\t\t\tthis.playersLeft(Object.keys(this.players));\n\t\t\teventSys.removeListener(e.net.chunk.load, loadCFunc);\n\t\t\teventSys.removeListener(e.net.chunk.unload, unloadCFunc);\n\t\t\teventSys.removeListener(e.net.chunk.set, setCFunc);\n\t\t\teventSys.removeListener(e.net.chunk.lock, lockCFunc);\n\t\t\teventSys.removeListener(e.net.disconnected, disconnectedFunc);\n\t\t\teventSys.removeListener(e.net.world.tilesUpdated, updateTileFunc);\n\t\t\teventSys.removeListener(e.net.world.playersMoved, updatePlayerFunc);\n\t\t\teventSys.removeListener(e.net.world.playersLeft, destroyPlayerFunc);\n\t\t};\n\t\teventSys.on(e.net.chunk.load, loadCFunc);\n\t\teventSys.on(e.net.chunk.unload, unloadCFunc);\n\t\teventSys.on(e.net.chunk.set, setCFunc);\n\t\teventSys.on(e.net.chunk.lock, lockCFunc);\n\t\teventSys.on(e.net.world.tilesUpdated, updateTileFunc);\n\t\teventSys.on(e.net.world.playersMoved, updatePlayerFunc);\n\t\teventSys.on(e.net.world.playersLeft, destroyPlayerFunc);\n\t\teventSys.once(e.net.world.leave, leaveWFunc);\n\t\teventSys.once(e.net.disconnected, disconnectedFunc);\n\t}\n\n\tmakeLockedChunksPath() {\n\t\tconst d = Chunk.dir;\n\t\tvar mainPath = new Path2D();\n\n\t\tvar vpoints = {};\n\t\tvar hpoints = {};\n\n\t\tconst addPoint = (fx, fy, tx, ty, points) => {\n\t\t\tconst fkey = `${fx},${fy}`;\n\t\t\tconst tkey = `${tx},${ty}`;\n\t\t\tif (tkey in points && fkey in points) {\n\t\t\t\tpoints[points[fkey]] = points[tkey];\n\t\t\t\tpoints[points[tkey]] = points[fkey];\n\t\t\t\tdelete points[tkey];\n\t\t\t\tdelete points[fkey];\n\t\t\t} else if (tkey in points) {\n\t\t\t\tvar newTo = points[tkey];\n\t\t\t\tpoints[newTo] = fkey;\n\t\t\t\tdelete points[tkey];\n\t\t\t\tpoints[fkey] = newTo;\n\t\t\t} else if (fkey in points) {\n\t\t\t\tvar newFrom = points[fkey];\n\t\t\t\tpoints[newFrom] = tkey;\n\t\t\t\tdelete points[fkey];\n\t\t\t\tpoints[tkey] = newFrom;\n\t\t\t} else {\n\t\t\t\tpoints[fkey] = tkey;\n\t\t\t\tpoints[tkey] = fkey;\n\t\t\t}\n\t\t};\n\n\t\tfor (var k in this.protectedChunks) {\n\t\t\tconst chunk = this.protectedChunks[k];\n\t\t\tconst ln = chunk.lockedNeighbors;\n\t\t\tif (ln === (d.LEFT | d.DOWN | d.UP | d.RIGHT)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!(ln & d.UP)) {\n\t\t\t\taddPoint(chunk.x + 1, chunk.y, chunk.x, chunk.y, hpoints);\n\t\t\t}\n\t\t\tif (!(ln & d.DOWN)) {\n\t\t\t\taddPoint(chunk.x, chunk.y + 1, chunk.x + 1, chunk.y + 1, hpoints);\n\t\t\t}\n\n\t\t\tif (!(ln & d.LEFT)) {\n\t\t\t\taddPoint(chunk.x, chunk.y + 1, chunk.x, chunk.y, vpoints);\n\t\t\t}\n\t\t\tif (!(ln & d.RIGHT)) {\n\t\t\t\taddPoint(chunk.x + 1, chunk.y + 1, chunk.x + 1, chunk.y, vpoints);\n\t\t\t}\n\t\t}\n\n\t\tvar polys = 0;\n\t\tvar pointobjs = [vpoints, hpoints];\n\t\tfor (var p in vpoints) {\n\t\t\tvar a = p.split(',');\n\t\t\tmainPath.moveTo(a[0] * 16, a[1] * 16);\n\n\t\t\tdelete vpoints[vpoints[p]];\n\t\t\tdelete vpoints[p];\n\t\t\tp = hpoints[p];\n\t\t\tfor (var i = 0; p && (a = p.split(',')); i++) {\n\t\t\t\tvar prev = pointobjs[(i + 1) & 1];\n\t\t\t\tvar next = pointobjs[i & 1];\n\t\t\t\tmainPath.lineTo(a[0] * 16, a[1] * 16);\n\n\t\t\t\tdelete prev[prev[p]];\n\t\t\t\tdelete prev[p];\n\t\t\t\tp = next[p];\n\t\t\t}\n\t\t\tmainPath.closePath();\n\t\t\t++polys;\n\t\t}\n\n\t\treturn polys === 0 ? null : mainPath;\n\t}\n\n\tfindNeighborLockedChunks(chunk, newState) {\n\t\tconst d = Chunk.dir;\n\t\tconst checkSide = (x, y, to, from) => {\n\t\t\tvar sidec = this.getChunkAt(chunk.x + x, chunk.y + y);\n\t\t\tif (sidec && sidec.locked) {\n\t\t\t\tif (newState) {\n\t\t\t\t\tchunk.lockedNeighbors |= to;\n\t\t\t\t\tsidec.lockedNeighbors |= from;\n\t\t\t\t} else {\n\t\t\t\t\tchunk.lockedNeighbors &= ~to;\n\t\t\t\t\tsidec.lockedNeighbors &= ~from;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tcheckSide(0, -1, d.UP, d.DOWN);\n\t\tcheckSide(1, 0, d.RIGHT, d.LEFT);\n\t\tcheckSide(-1, 0, d.LEFT, d.RIGHT);\n\t\tcheckSide(0, 1, d.DOWN, d.UP);\n\n\t\tclearTimeout(this.pathUpdaterTimeout);\n\t\tthis.pathUpdaterTimeout = setTimeout(() => {\n\t\t\tthis.pathFx.update({path: this.makeLockedChunksPath()});\n\t\t\trenderer.render(renderer.rendertype.FX);\n\t\t}, 100);\n\t}\n\n\tloadChunk(x, y) {\n\t\tvar key = `${x},${y}`;\n\t\tif (!this.chunks[key] && net.isConnected()) {\n\t\t\tnet.protocol.requestChunk(x, y);\n\t\t}\n\t}\n\n\tallChunksLoaded() {\n\t\treturn net.protocol.allChunksLoaded();\n\t}\n\n\ttilesUpdated(tiles) {\n\t\tvar chunksUpdated = {};\n\t\tvar chunkSize = protocol.chunkSize;\n\t\tfor (var i = 0; i < tiles.length; i++) {\n\t\t\tvar t = tiles[i];\n\t\t\tvar key = `${Math.floor(t.x / chunkSize)},${Math.floor(t.y / chunkSize)}`;\n\t\t\tvar chunk = this.chunks[key];\n\t\t\tif (chunk) {\n\t\t\t\tchunksUpdated[key] = chunk;\n\t\t\t\tchunk.update(t.x, t.y, t.rgb);\n\t\t\t}\n\t\t}\n\t\tfor (var c in chunksUpdated) {\n\t\t\teventSys.emit(e.renderer.updateChunk, chunksUpdated[c]);\n\t\t}\n\t}\n\n\tplayersMoved(players) {\n\t\tvar rendered = false;\n\t\tfor (const id in players) {\n\t\t\tvar player = this.players[id];\n\t\t\tvar u = players[id];\n\t\t\tif (player) {\n\t\t\t\tplayer.update(u.x, u.y, u.rgb, u.tool);\n\t\t\t} else {\n\t\t\t\tplayer = this.players[id] = new Player(u.x, u.y, u.rgb, u.tool, id);\n\t\t\t}\n\t\t\tif (!rendered && (isVisible(player.endX / 16, player.endY / 16, 4, 4)\n\t\t\t\t\t|| isVisible(player.x / 16, player.y / 16, 4, 4))) {\n\t\t\t\trendered = true;\n\t\t\t\trenderer.render(renderer.rendertype.FX);\n\t\t\t}\n\t\t}\n\t}\n\n\tplayersLeft(ids) {\n\t\tvar rendered = false;\n\t\tfor (var i = 0; i < ids.length; i++) {\n\t\t\tvar id = ids[i];\n\t\t\tvar player = this.players[id];\n\t\t\tif (player) {\n\t\t\t\tplayer.disconnect();\n\t\t\t\tif (!rendered && isVisible(player.x / 16, player.y / 16, 4, 4)) {\n\t\t\t\t\trendered = true;\n\t\t\t\t\trenderer.render(renderer.rendertype.FX);\n\t\t\t\t}\n\t\t\t}\n\t\t\tdelete this.players[id];\n\t\t}\n\t}\n\n\tsetPixel(x, y, color, noUndo) {\n\t\tvar time = Date.now();\n\t\tvar chunkSize = protocol.chunkSize;\n\t\tvar chunk = this.chunks[`${Math.floor(x / chunkSize)},${Math.floor(y / chunkSize)}`];\n\t\tif (chunk && (!chunk.locked || player.rank >= RANK.MODERATOR)) {\n\t\t\tvar oldPixel = this.getPixel(x, y, chunk);\n\t\t\tif (!oldPixel || (oldPixel[0] === color[0] && oldPixel[1] === color[1] && oldPixel[2] === color[2])\n\t\t\t\t\t|| !net.protocol.updatePixel(x, y, color, () => {\n\t\t\t\tchunk.update(x, y, colorUtils.u24_888(oldPixel[0], oldPixel[1], oldPixel[2]));\n\t\t\t\teventSys.emit(e.renderer.updateChunk, chunk);\n\t\t\t})) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (!noUndo) {\n\t\t\t\toldPixel.push(x, y, time);\n\t\t\t\tthis.undoHistory.push(oldPixel);\n\t\t\t}\n\t\t\tchunk.update(x, y, colorUtils.u24_888(color[0], color[1], color[2]));\n\t\t\teventSys.emit(e.renderer.updateChunk, chunk);\n\t\t\tif (time - lastPlace > 30) {\n\t\t\t\tsounds.play(sounds.place);\n\t\t\t\tlastPlace = time;\n\t\t\t}\n\t\t\treturn true;\n\t\t} else if (chunk && chunk.locked) {\n\t\t\tthis.pathFx.extra.placeTime = time;\n\t\t\trenderer.render(renderer.rendertype.FX);\n\t\t}\n\t\treturn false;\n\t}\n\n\tundo(bulkUndo) {\n\t\tconst eq = (a, b) => a[0] == b[0] && a[1] == b[1] && a[2] == b[2];\n\t\tif (this.undoHistory.length === 0) {\n\t\t\treturn false;\n\t\t}\n\t\tvar changeTime = null;\n\t\tfor (var i = this.undoHistory.length; --i >= 0;) {\n\t\t\tvar undo = this.undoHistory[i];\n\t\t\tif (!changeTime) {\n\t\t\t\tchangeTime = undo[5];\n\t\t\t}\n\t\t\tvar px = this.getPixel(undo[3], undo[4]);\n\t\t\tif (px) {\n\t\t\t\tvar shouldContinue = !bulkUndo || changeTime - undo[5] < 500;\n\t\t\t\tvar unchanged = eq(px, undo);\n\t\t\t\tif (!shouldContinue) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (unchanged || this.setPixel(undo[3], undo[4], undo, true)) {\n\t\t\t\t\tthis.undoHistory.splice(i, 1);\n\t\t\t\t\tif (!bulkUndo) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetChunkAt(x, y) {\n\t\treturn this.chunks[`${x},${y}`];\n\t}\n\n\tgetPixel(x, y, chunk) {\n\t\tif (!chunk) {\n\t\t\tvar chunkSize = protocol.chunkSize;\n\t\t\tchunk = this.chunks[`${Math.floor(x / chunkSize)},${Math.floor(y / chunkSize)}`];\n\t\t}\n\n\t\tif (chunk) {\n\t\t\tvar clr = chunk.get(x, y);\n\t\t\treturn [clr & 0xFF, clr >> 8 & 0xFF, clr >> 16 & 0xFF];\n\t\t}\n\t\treturn null;\n\t}\n\n\tvalidMousePos(tileX, tileY) {\n\t\treturn this.getPixel(tileX, tileY) !== null;\n\t}\n\n\tchunkLocked(x, y, newState) {\n\t\tconst key = `${x},${y}`;\n\t\tvar chunk = this.getChunkAt(x, y);\n\t\tif (chunk) {\n\t\t\tif (newState) {\n\t\t\t\tthis.protectedChunks[key] = chunk;\n\t\t\t\tchunk.locked = true;\n\t\t\t} else {\n\t\t\t\tdelete this.protectedChunks[key];\n\t\t\t\tchunk.locked = false;\n\t\t\t}\n\t\t\tthis.findNeighborLockedChunks(chunk, newState);\n\t\t}\n\t}\n\n\tchunkLoaded(chunk) {\n\t\tconst key = `${chunk.x},${chunk.y}`;\n\t\tthis.chunks[key] = chunk;\n\t\tif (chunk.locked) {\n\t\t\tthis.protectedChunks[key] = chunk;\n\t\t\tthis.findNeighborLockedChunks(chunk, chunk.locked);\n\t\t}\n\t\teventSys.emit(e.renderer.addChunk, chunk);\n\t}\n\n\tchunkUnloaded(chunk) {\n\t\tconst key = `${chunk.x},${chunk.y}`;\n\t\tdelete this.chunks[key];\n\t\tif (chunk.locked) {\n\t\t\tdelete this.protectedChunks[key];\n\t\t\tchunk.locked = false;\n\t\t\tthis.findNeighborLockedChunks(chunk, chunk.locked);\n\t\t}\n\t\teventSys.emit(e.renderer.rmChunk, chunk);\n\t}\n\n\tchunkPasted(x, y, data) {\n\t\tvar chunk = this.chunks[`${x},${y}`];\n\t\tif (chunk) {\n\t\t\tchunk.set(data);\n\t\t\teventSys.emit(e.renderer.updateChunk, chunk);\n\t\t}\n\t}\n\n\tunloadAllChunks() {\n\t\tfor (const c in this.chunks) {\n\t\t\tthis.chunks[c].remove();\n\t\t}\n\t}\n}\n","'use strict';\nimport { protocol, EVENTS as e, options } from './conf.js';\nimport { eventSys, PublicAPI } from './global.js';\nimport { elements, misc } from './main.js';\nimport { player } from './local_player.js';\nimport { activeFx } from './Fx.js';\nimport { getTime } from './util/misc.js';\nimport { colorUtils as color } from './util/color.js';\nimport { Lerp } from './util/Lerp.js';\nimport { tools } from './tools.js';\n\nexport { centerCameraTo, moveCameraBy, moveCameraTo, isVisible };\n\n/* oh boy, i'm going to get shit for making this private, aren't i?  */\nconst cameraValues = {\n\tx: 0,\n\ty: 0,\n\tzoom: -1/*,\n\tlerpZoom: new Lerp(options.defaultZoom, options.defaultZoom, 200)*/\n};\n\nexport const camera = {\n\tget x() { return cameraValues.x; },\n\tget y() { return cameraValues.y; },\n\tget zoom() { return cameraValues.zoom; },\n\t/*get lerpZoom() { return cameraValues.lerpZoom.val; },*/\n\tset zoom(z) {\n\t\tz = Math.min(options.zoomLimitMax, Math.max(options.zoomLimitMin, z));\n\t\tif (z !== cameraValues.zoom) {\n\t\t\tvar center = getCenterPixel();\n\t\t\tcameraValues.zoom = z;\n\t\t\tcenterCameraTo(center[0], center[1]);\n\t\t\teventSys.emit(e.camera.zoom, z);\n\t\t}\n\t},\n\tisVisible: isVisible\n};\n\nconst rendererValues = {\n\tupdateRequired: 3,\n\tanimContext: null,\n\tgridShown: true,\n\tgridPattern: null, /* Rendered each time the zoom changes */\n\tunloadedPattern: null,\n\tworldBackground: null,\n\tminGridZoom: options.minGridZoom,\n\tupdatedClusters: [], /* Clusters to render in the next frame */\n\tclusters: {},\n\tvisibleClusters: [],\n\tcurrentFontSize: -1\n};\n\n/*PublicAPI.rval = rendererValues;*/\n\nexport const renderer = {\n\trendertype: {\n\t\tALL:      0b11,\n\t\tFX:       0b01,\n\t\tWORLD:    0b10\n\t},\n\tpatterns: {\n\t\tget unloaded() { return rendererValues.unloadedPattern; }\n\t},\n\trender: requestRender,\n\tshowGrid: setGridVisibility,\n\tget gridShown() { return rendererValues.gridShown; },\n\tupdateCamera: onCameraMove,\n\tunloadFarClusters: unloadFarClusters\n};\n\nPublicAPI.camera = camera;\nPublicAPI.renderer = renderer;\n\nclass BufView {\n\tconstructor(u32data, x, y, w, h, realw) {\n\t\tthis.data = u32data;\n\t\tif (options.chunkBugWorkaround) {\n\t\t\tthis.changes = [];\n\t\t}\n\t\tthis.offx = x;\n\t\tthis.offy = y;\n\t\tthis.realwidth = realw;\n\t\tthis.width = w;\n\t\tthis.height = h;\n\t}\n\n\tget(x, y) {\n\t\treturn this.data[(this.offx + x) + (this.offy + y) * this.realwidth];\n\t}\n\n\tset(x, y, data) {\n\t\tthis.data[(this.offx + x) + (this.offy + y) * this.realwidth] = data;\n\t\tif (options.chunkBugWorkaround) {\n\t\t\tthis.changes.push([0, x, y, data]);\n\t\t}\n\t}\n\n\tfill(data) {\n\t\tfor (var i = 0; i < this.height; i++) {\n\t\t\tfor (var j = 0; j < this.width; j++) {\n\t\t\t\tthis.data[(this.offx + j) + (this.offy + i) * this.realwidth] = data;\n\t\t\t}\n\t\t}\n\t\tif (options.chunkBugWorkaround) {\n\t\t\tthis.changes.push([1, 0, 0, data]);\n\t\t}\n\t}\n\n\tfillFromBuf(u32buf) {\n\t\tfor (var i = 0; i < this.height; i++) {\n\t\t\tfor (var j = 0; j < this.width; j++) {\n\t\t\t\tthis.data[(this.offx + j) + (this.offy + i) * this.realwidth] = u32buf[j + i * this.width];\n\t\t\t\tif (options.chunkBugWorkaround) {\n\t\t\t\t\t/* Terrible */\n\t\t\t\t\tthis.changes.push([0, j, i, u32buf[j + i * this.width]]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nclass ChunkCluster {\n\tconstructor(x, y) {\n\t\tthis.removed = false;\n\t\tthis.toUpdate = false;\n\t\tthis.shown = false; /* is in document? */\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.canvas = document.createElement(\"canvas\");\n\t\tthis.canvas.width = protocol.chunkSize * protocol.clusterChunkAmount;\n\t\tthis.canvas.height = protocol.chunkSize * protocol.clusterChunkAmount;\n\t\tthis.ctx = this.canvas.getContext(\"2d\");\n\t\tthis.data = this.ctx.createImageData(this.canvas.width, this.canvas.height);\n\t\tthis.u32data = new Uint32Array(this.data.data.buffer);\n\t\tthis.chunks = [];\n\t\tif (options.chunkBugWorkaround) {\n\t\t\tthis.currentColor = 0;\n\t\t}\n\t}\n\n\trender() {\n\t\tthis.toUpdate = false;\n\t\tfor (var i = this.chunks.length; i--;) {\n\t\t\tvar c = this.chunks[i];\n\t\t\tif (c.needsRedraw) {\n\t\t\t\tc.needsRedraw = false;\n\t\t\t\tif (options.chunkBugWorkaround) {\n\t\t\t\t\tvar arr = c.view.changes;\n\t\t\t\t\tvar s = protocol.chunkSize;\n\t\t\t\t\tfor (var j = 0; j < arr.length; j++) {\n\t\t\t\t\t\tvar current = arr[j];\n\t\t\t\t\t\tif (this.currentColor !== current[3]) {\n\t\t\t\t\t\t\tthis.currentColor = current[3];\n\t\t\t\t\t\t\tthis.ctx.fillStyle = color.toHTML(current[3]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tswitch (current[0]) {\n\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\tthis.ctx.fillRect(c.view.offx + current[1], c.view.offy + current[2], 1, 1);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tthis.ctx.fillRect(c.view.offx, c.view.offy, s, s);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tc.view.changes = [];\n\t\t\t\t} else {\n\t\t\t\t\tthis.ctx.putImageData(this.data, 0, 0,\n\t\t\t\t\t\tc.view.offx, c.view.offy, c.view.width, c.view.height);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tremove() {\n\t\tthis.removed = true;\n\t\tif (this.shown) {\n\t\t\tvar visiblecl = rendererValues.visibleClusters;\n\t\t\tvisiblecl.splice(visiblecl.indexOf(this), 1);\n\t\t\tthis.shown = false;\n\t\t}\n\t\tthis.canvas.width = 0;\n\t\tthis.u32data = this.data = null;\n\t\tdelete rendererValues.clusters[`${this.x},${this.y}`];\n\t\tfor (var i = 0; i < this.chunks.length; i++) {\n\t\t\tthis.chunks[i].view = null;\n\t\t\tthis.chunks[i].remove();\n\t\t}\n\t\tthis.chunks = [];\n\t}\n\n\taddChunk(chunk) {\n\t\t/* WARNING: Should absMod if not power of two */\n\t\tvar x = chunk.x & (protocol.clusterChunkAmount - 1);\n\t\tvar y = chunk.y & (protocol.clusterChunkAmount - 1);\n\t\tvar s = protocol.chunkSize;\n\t\tvar view = new BufView(this.u32data, x * s, y * s, s, s, protocol.clusterChunkAmount * s);\n\t\tif (chunk.tmpChunkBuf) {\n\t\t\tview.fillFromBuf(chunk.tmpChunkBuf);\n\t\t\tchunk.tmpChunkBuf = null;\n\t\t}\n\t\tchunk.view = view;\n\t\tthis.chunks.push(chunk);\n\t\tchunk.needsRedraw = true;\n\t}\n\n\tdelChunk(chunk) {\n\t\tchunk.view = null;\n\t\t/* There is no real need to clearRect the chunk area */\n\t\tvar i = this.chunks.indexOf(chunk);\n\t\tif (i !== -1) {\n\t\t\tthis.chunks.splice(i, 1);\n\t\t}\n\t\tif (!this.chunks.length) {\n\t\t\tthis.remove();\n\t\t}\n\t}\n}\n\n/* Draws white text with a black border */\nexport function drawText(ctx, str, x, y, centered){\n\tctx.strokeStyle = \"#000000\",\n\tctx.fillStyle = \"#FFFFFF\",\n\tctx.lineWidth = 2.5,\n\tctx.globalAlpha = 0.5;\n\tif(centered) {\n\t\tx -= ctx.measureText(str).width >> 1;\n\t}\n\tctx.strokeText(str, x, y);\n\tctx.globalAlpha = 1;\n\tctx.fillText(str, x, y);\n}\n\nfunction isVisible(x, y, w, h) {\n\tif(document.visibilityState === \"hidden\") return;\n\tvar cx    = camera.x;\n\tvar cy    = camera.y;\n\tvar czoom = camera.zoom;\n\tvar cw    = window.innerWidth;\n\tvar ch    = window.innerHeight;\n\treturn x + w > cx && y + h > cy &&\n\t       x <= cx + cw / czoom && y <= cy + ch / czoom;\n}\n\nexport function unloadFarClusters() { /* Slow? */\n\tvar camx = camera.x;\n\tvar camy = camera.y;\n\tvar zoom = camera.zoom;\n\tvar camw = window.innerWidth / zoom | 0;\n\tvar camh = window.innerHeight / zoom | 0;\n\tvar ctrx = camx + camw / 2;\n\tvar ctry = camy + camh / 2;\n\tvar s = protocol.clusterChunkAmount * protocol.chunkSize;\n\tfor (var c in rendererValues.clusters) {\n\t\tc = rendererValues.clusters[c];\n\t\tif (!isVisible(c.x * s, c.y * s, s, s)) {\n\t\t\tvar dx = Math.abs(ctrx / s - c.x) | 0;\n\t\t\tvar dy = Math.abs(ctry / s - c.y) | 0;\n\t\t\tvar dist = dx + dy; /* no sqrt please */\n\t\t\t//console.log(dist);\n\t\t\tif (dist > options.unloadDistance) {\n\t\t\t\tc.remove();\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nfunction render(type) {\n\tvar time = getTime(true);\n\tvar camx = camera.x;\n\tvar camy = camera.y;\n\tvar zoom = camera.zoom;\n\tvar needsRender = 0; /* If an animation didn't finish, render again */\n\n\tif (type & renderer.rendertype.WORLD) {\n\t\tvar uClusters = rendererValues.updatedClusters;\n\t\tfor (var i = 0; i < uClusters.length; i++) {\n\t\t\tvar c = uClusters[i];\n\t\t\tc.render();\n\t\t}\n\t\trendererValues.updatedClusters = [];\n\t}\n\n\tif (type & renderer.rendertype.FX && misc.world !== null) {\n\t\tvar ctx = rendererValues.animContext;\n\t\tvar visible = rendererValues.visibleClusters;\n\t\tvar clusterCanvasSize = protocol.chunkSize * protocol.clusterChunkAmount;\n\t\tvar cwidth = window.innerWidth;\n\t\tvar cheight = window.innerHeight;\n\t\tvar background = rendererValues.worldBackground;\n\t\tvar allChunksLoaded = misc.world.allChunksLoaded();\n\n\t\tvar bggx = -(camx * zoom) % (16 * zoom);\n\t\tvar bggy = -(camy * zoom) % (16 * zoom);\n\n\t\tif (!allChunksLoaded) {\n\t\t\tif (rendererValues.unloadedPattern == null) {\n\t\t\t\tctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\t\t\t} else {\n\t\t\t\tctx.translate(bggx, bggy);\n\t\t\t\tctx.fillStyle = rendererValues.unloadedPattern;\n\t\t\t\tctx.fillRect(-bggx, -bggy, ctx.canvas.width, ctx.canvas.height);\n\t\t\t\tctx.translate(-bggx, -bggy);\n\t\t\t}\n\t\t}\n\n\t\tctx.lineWidth = 2.5 / 16 * zoom;\n\n\t\tctx.scale(zoom, zoom);\n\n\t\tfor (var i = 0; i < visible.length; i++) {\n\t\t\tvar cluster = visible[i];\n\t\t\tvar gx = -(camx - cluster.x * clusterCanvasSize);\n\t\t\tvar gy = -(camy - cluster.y * clusterCanvasSize);\n\t\t\tvar clipx = gx < 0 ? -gx : 0;\n\t\t\tvar clipy = gy < 0 ? -gy : 0;\n\t\t\tvar x = gx < 0 ? 0 : gx;\n\t\t\tvar y = gy < 0 ? 0 : gy;\n\t\t\tvar clipw = clusterCanvasSize - clipx;\n\t\t\tvar cliph = clusterCanvasSize - clipy;\n\t\t\tclipw = clipw + x < cwidth / zoom ? clipw : cwidth / zoom - x;\n\t\t\tcliph = cliph + y < cheight / zoom ? cliph : cheight / zoom - y;\n\t\t\t//clipw = (clipw + 1) | 0; /* Math.ceil */\n\t\t\t//cliph = (cliph + 1) | 0;\n\t\t\tif (clipw > 0 && cliph > 0) {\n\t\t\t\tctx.drawImage(cluster.canvas, clipx, clipy, clipw, cliph, x, y, clipw, cliph);\n\t\t\t}\n\t\t}\n\n\t\tctx.scale(1 / zoom, 1 / zoom); /* probably faster than ctx.save(), ctx.restore() */\n\n\t\t/*if (background != null) {\n\t\t\tvar newscale = zoom / options.defaultZoom;\n\t\t\tvar oldscale = options.defaultZoom / zoom;\n\t\t\tvar gx = -(camx * zoom) % (background.width * newscale);\n\t\t\tvar gy = -(camy * zoom) % (background.height * newscale);\n\t\t\tctx.translate(gx, gy);\n\n\t\t\tctx.fillStyle = background;\n\t\t\tctx.globalCompositeOperation = \"destination-over\";\n\n\t\t\tctx.scale(newscale, newscale);\n\t\t\tctx.fillRect(-gx / newscale, -gy / newscale, ctx.canvas.width * oldscale, ctx.canvas.height * oldscale);\n\t\t\tctx.scale(oldscale, oldscale);\n\n\t\t\tctx.translate(-gx, -gy);\n\t\t}*/\n\n\t\tif (rendererValues.gridShown && rendererValues.gridPattern) {\n\t\t\tctx.translate(bggx, bggy);\n\t\t\tctx.fillStyle = rendererValues.gridPattern;\n\t\t\t/*if (!allChunksLoaded) {\n\t\t\t\tctx.globalCompositeOperation = \"source-atop\";\n\t\t\t}*/\n\t\t\tctx.fillRect(-bggx, -bggy, ctx.canvas.width, ctx.canvas.height);\n\t\t\tctx.translate(-bggx, -bggy);\n\t\t}\n\n\n\t\t//ctx.globalCompositeOperation = \"source-over\";\n\n\t\tfor (var i = 0; i < activeFx.length; i++) {\n\t\t\tswitch (activeFx[i].render(ctx, time)) {\n\t\t\tcase 0: /* Anim not finished */\n\t\t\t\tneedsRender |= renderer.rendertype.FX;\n\t\t\t\tbreak;\n\t\t\tcase 2: /* Obj deleted from array, prevent flickering */\n\t\t\t\t--i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tctx.globalAlpha = 1;\n\t\tvar players = misc.world.players;\n\t\tvar fontsize = 10 / 16 * zoom | 0;\n\t\tif (rendererValues.currentFontSize != fontsize) {\n\t\t\tctx.font = fontsize + \"px sans-serif\";\n\t\t\trendererValues.currentFontSize = fontsize;\n\t\t}\n\n\t\tif (options.showPlayers) {\n\t\t\tfor (var p in players) {\n\t\t\t\tvar player = players[p];\n\t\t\t\tif (!renderPlayer(player, fontsize)) {\n\t\t\t\t\tneedsRender |= renderer.rendertype.FX;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\n\trequestRender(needsRender);\n}\n\nfunction renderPlayer(targetPlayer, fontsize) {\n\tvar camx = camera.x * 16;\n\tvar camy = camera.y * 16;\n\tvar zoom = camera.zoom;\n\tvar ctx  = rendererValues.animContext;\n\tvar cnvs = ctx.canvas;\n\tvar tool = targetPlayer.tool;\n\tif (!tool) {\n\t\t/* Render the default tool if the selected one isn't defined */\n\t\ttool = tools['cursor'];\n\t}\n\tvar toolwidth = tool.cursor.width / 16 * zoom;\n\tvar toolheight = tool.cursor.height / 16 * zoom;\n\n\tvar x = targetPlayer.x;\n\tvar y = targetPlayer.y;\n\tvar cx = ((x - camx) - tool.offset[0]) * (zoom / 16) | 0;\n\tvar cy = ((y - camy) - tool.offset[1]) * (zoom / 16) | 0;\n\n\tif(cx < -toolwidth || cy < -toolheight\n\t|| cx > cnvs.width || cy > cnvs.height) {\n\t\treturn true;\n\t}\n\n\n\tif (fontsize > 3) {\n\t\tvar idstr = targetPlayer.id;\n\t\tvar textw = ctx.measureText(idstr).width + (zoom / 2);\n\n\t\tctx.globalAlpha = 1;\n\t\tctx.fillStyle = targetPlayer.clr;\n\t\tctx.fillRect(cx, cy + toolheight, textw, zoom);\n\t\tctx.globalAlpha = 0.2;\n\t\tctx.lineWidth = 3;\n\t\tctx.strokeStyle = \"#000000\";\n\t\tctx.strokeRect(cx, cy + toolheight, textw, zoom);\n\t\tctx.globalAlpha = 1;\n\t\tdrawText(ctx, idstr, cx + zoom / 4, cy + fontsize + toolheight + zoom / 8);\n\t}\n\n\tctx.drawImage(tool.cursor, cx, cy, toolwidth, toolheight);\n\n\treturn x === targetPlayer.endX && y === targetPlayer.endY;\n}\n\nfunction requestRender(type) {\n\trendererValues.updateRequired |= type;\n}\n\nfunction setGridVisibility(enabled) {\n\trendererValues.gridShown = enabled;\n\trequestRender(renderer.rendertype.FX);\n}\n\nfunction renderGrid(zoom) {\n\tvar tmpcanvas = document.createElement(\"canvas\");\n\tvar ctx = tmpcanvas.getContext(\"2d\");\n\tvar size = tmpcanvas.width = tmpcanvas.height = Math.round(16 * zoom);\n\tctx.setLineDash([1]);\n\tctx.globalAlpha = 0.2;\n\tif (zoom >= 4) {\n\t\tvar fadeMult = Math.min(1, zoom - 4);\n\t\tif (fadeMult < 1) {\n\t\t\tctx.globalAlpha = 0.2 * fadeMult;\n\t\t}\n\t\tctx.beginPath();\n\t\tfor (var i = 16; --i;) {\n\t\t\tctx.moveTo(i * zoom + .5, 0);\n\t\t\tctx.lineTo(i * zoom + .5, size);\n\t\t\tctx.moveTo(0, i * zoom + .5);\n\t\t\tctx.lineTo(size, i * zoom + .5);\n\t\t}\n\t\tctx.stroke();\n\t\tctx.globalAlpha = Math.max(0.2, 1 * fadeMult);\n\t}\n\tctx.beginPath();\n\tctx.moveTo(0, 0);\n\tctx.lineTo(0, size);\n\tctx.lineTo(size, size);\n\tctx.stroke();\n\treturn ctx.createPattern(tmpcanvas, \"repeat\");\n}\n\nfunction setGridZoom(zoom) {\n\tif (zoom >= rendererValues.minGridZoom) {\n\t\trendererValues.gridPattern = renderGrid(zoom);\n\t} else {\n\t\trendererValues.gridPattern = null;\n\t}\n}\n\nfunction updateVisible() {\n\tvar clusters = rendererValues.clusters;\n\tvar visiblecl = rendererValues.visibleClusters;\n\tfor (var c in clusters) {\n\t\tc = clusters[c];\n\t\tvar size = protocol.chunkSize * protocol.clusterChunkAmount;\n\t\tvar visible = isVisible(c.x * size, c.y * size, size, size);\n\t\tif (!visible && c.shown) {\n\t\t\tc.shown = false;\n\t\t\tvisiblecl.splice(visiblecl.indexOf(c), 1);\n\t\t} else if (visible && !c.shown) {\n\t\t\tc.shown = true;\n\t\t\tvisiblecl.push(c);\n\t\t\trequestRender(renderer.rendertype.WORLD);\n\t\t}\n\t}\n};\n\nfunction onResize() {\n\telements.animCanvas.width = window.innerWidth;\n\telements.animCanvas.height = window.innerHeight;\n\tvar ctx = rendererValues.animContext;\n\tctx.imageSmoothingEnabled = false;\n\tctx.webkitImageSmoothingEnabled = false;\n\tctx.mozImageSmoothingEnabled = false;\n\tctx.msImageSmoothingEnabled = false;\n\tctx.oImageSmoothingEnabled = false;\n\trendererValues.currentFontSize = -1;\n\tonCameraMove();\n}\n\nfunction alignCamera() {\n\tvar zoom = cameraValues.zoom;\n\tvar alignedX = Math.round(cameraValues.x * zoom) / zoom;\n\tvar alignedY = Math.round(cameraValues.y * zoom) / zoom;\n\tcameraValues.x = alignedX;\n\tcameraValues.y = alignedY;\n}\n\nfunction requestMissingChunks() { /* TODO: move this to World */\n\tvar x = camera.x / protocol.chunkSize - 2 | 0;\n\tvar mx = camera.x / protocol.chunkSize + window.innerWidth / camera.zoom / protocol.chunkSize | 0;\n\tvar cy = camera.y / protocol.chunkSize - 2 | 0;\n\tvar my = camera.y / protocol.chunkSize + window.innerHeight / camera.zoom / protocol.chunkSize | 0;\n\twhile (++x <= mx) {\n\t\tvar y = cy;\n\t\twhile (++y <= my) {\n\t\t\tmisc.world.loadChunk(x, y);\n\t\t}\n\t}\n}\n\nfunction onCameraMove() {\n\teventSys.emit(e.camera.moved, camera);\n\talignCamera();\n\tupdateVisible();\n\tif (misc.world !== null) {\n\t\trequestMissingChunks();\n\t}\n\trequestRender(renderer.rendertype.FX);\n}\n\nfunction getCenterPixel() {\n\tvar x = Math.round(cameraValues.x + window.innerWidth / camera.zoom / 2);\n\tvar y = Math.round(cameraValues.y + window.innerHeight / camera.zoom / 2);\n\treturn [x, y];\n}\n\nfunction centerCameraTo(x, y) {\n\tif(typeof(x) == \"number\" && !isNaN(x)){\n\t\tcameraValues.x = -(window.innerWidth / camera.zoom / 2) + x;\n\t}\n\t\n\tif(typeof(y) == \"number\" && !isNaN(y)){\n\t\tcameraValues.y = -(window.innerHeight / camera.zoom / 2) + y;\n\t}\n\t\n\tonCameraMove();\n}\n\nfunction moveCameraBy(x, y) {\n\tcameraValues.x += x;\n\tcameraValues.y += y;\n\tonCameraMove();\n}\n\nfunction moveCameraTo(x, y) {\n\tcameraValues.x = x;\n\tcameraValues.y = y;\n\tonCameraMove();\n}\n\neventSys.on(e.net.world.teleported, (x, y) => {\n\tcenterCameraTo(x, y);\n});\n\neventSys.on(e.camera.zoom, z => {\n\tsetGridZoom(z);\n\t/*cameraValues.lerpZoom.val = z;*/\n\trequestRender(renderer.rendertype.FX);\n});\n\neventSys.on(e.renderer.addChunk, chunk => {\n\tvar clusterX = Math.floor(chunk.x / protocol.clusterChunkAmount);\n\tvar clusterY = Math.floor(chunk.y / protocol.clusterChunkAmount);\n\tvar key = `${clusterX},${clusterY}`;\n\tvar clusters = rendererValues.clusters;\n\tvar cluster = clusters[key];\n\tif (!cluster) {\n\t\tcluster = clusters[key] = new ChunkCluster(clusterX, clusterY);\n\t\tupdateVisible();\n\t}\n\tcluster.addChunk(chunk);\n\tif (!cluster.toUpdate) {\n\t\tcluster.toUpdate = true;\n\t\trendererValues.updatedClusters.push(cluster);\n\t}\n\tvar size = protocol.chunkSize;\n\tif (cluster.toUpdate || isVisible(chunk.x * size, chunk.y * size, size, size)) {\n\t\trequestRender(renderer.rendertype.WORLD | renderer.rendertype.FX);\n\t}\n});\n\neventSys.on(e.renderer.rmChunk, chunk => {\n\tvar clusterX = Math.floor(chunk.x / protocol.clusterChunkAmount);\n\tvar clusterY = Math.floor(chunk.y / protocol.clusterChunkAmount);\n\tvar key = `${clusterX},${clusterY}`;\n\tvar clusters = rendererValues.clusters;\n\tvar cluster = clusters[key];\n\tif (cluster) {\n\t\tcluster.delChunk(chunk);\n\t\tif (!cluster.removed && !cluster.toUpdate) {\n\t\t\tcluster.toUpdate = true;\n\t\t\trendererValues.updatedClusters.push(cluster);\n\t\t}\n\t}\n});\n\neventSys.on(e.renderer.updateChunk, chunk => {\n\tvar clusterX = Math.floor(chunk.x / protocol.clusterChunkAmount);\n\tvar clusterY = Math.floor(chunk.y / protocol.clusterChunkAmount);\n\tvar key = `${clusterX},${clusterY}`;\n\tvar cluster = rendererValues.clusters[key];\n\tif (cluster && !cluster.toUpdate) {\n\t\tcluster.toUpdate = true;\n\t\trendererValues.updatedClusters.push(cluster);\n\t}\n\tvar size = protocol.chunkSize;\n\tif (isVisible(chunk.x * size, chunk.y * size, size, size)) {\n\t\trequestRender(renderer.rendertype.WORLD | renderer.rendertype.FX);\n\t}\n});\n\neventSys.on(e.misc.worldInitialized, () => {\n\trequestMissingChunks();\n});\n\neventSys.once(e.init, () => {\n\trendererValues.animContext = elements.animCanvas.getContext(\"2d\", { alpha: false });\n\twindow.addEventListener(\"resize\", onResize);\n\tonResize();\n\tcamera.zoom = options.defaultZoom;\n\tcenterCameraTo(0, 0);\n\n\tconst mkPatternFromUrl = (url, cb) => {\n\t\tvar patImg = new Image();\n\t\tpatImg.onload = () => {\n\t\t\tvar pat = rendererValues.animContext.createPattern(patImg, \"repeat\");\n\t\t\tpat.width = patImg.width;\n\t\t\tpat.height = patImg.height;\n\t\t\tcb(pat);\n\t\t};\n\t\tpatImg.src = url;\n\t};\n\n\t/* Create the pattern images */\n\tmkPatternFromUrl(options.unloadedPatternUrl, pat => {\n\t\trendererValues.unloadedPattern = pat;\n\t});\n\n\tif (options.backgroundUrl != null) {\n\t\tmkPatternFromUrl(options.backgroundUrl, pat => {\n\t\t\trendererValues.worldBackground = pat;\n\t\t});\n\t}\n\n\tfunction frameLoop() {\n\t\tlet type;\n\t\tif ((type = rendererValues.updateRequired) !== 0) {\n\t\t\trendererValues.updateRequired = 0;\n\t\t\trender(type);\n\t\t}\n\t\twindow.requestAnimationFrame(frameLoop);\n\t}\n\teventSys.once(e.misc.toolsInitialized, frameLoop);\n});\n","'use strict';\nimport { EVENTS as e } from './conf.js';\nimport { eventSys } from './global.js';\nimport { mkHTML, loadScript, setCookie } from './util/misc.js';\nimport { windowSys, GUIWindow, UtilDialog } from './windowsys.js';\nimport { misc } from './main.js';\n\nconst SITEKEY = \"6LcgvScUAAAAAARUXtwrM8MP0A0N70z4DHNJh-KI\";\n\nfunction loadCaptcha(onload) {\n\tif (!window.grecaptcha) {\n\t\tif (window.callback) {\n\t\t\t/* Hacky solution for race condition */\n\t\t\twindow.callback = function() {\n\t\t\t\tonload();\n\t\t\t\tthis();\n\t\t\t}.bind(window.callback);\n\t\t} else {\n        \twindow.callback = function() {\n\t            delete window.callback;\n            \tonload();\n        \t};\n        \teventSys.emit(e.misc.loadingCaptcha);\n\t\t\tloadScript(\"https://www.google.com/recaptcha/api.js?onload=callback&render=explicit\");\n\t\t}\n\t} else {\n\t\tonload();\n\t}\n}\n\nfunction requestVerification() {\n\twindowSys.addWindow(new GUIWindow(\"Verification needed\", {\n\t\t\tcentered: true\n\t}, wdow => {\n\t\tvar id = grecaptcha.render(wdow.addObj(mkHTML(\"div\", {\n\t\t\tid: \"captchawdow\"\n\t\t})), {\n\t\t\ttheme: \"light\",\n\t\t\tsitekey: SITEKEY,\n\t\t\tcallback: token => {\n\t\t\t\teventSys.emit(e.misc.captchaToken, token);\n\t\t\t\twdow.close();\n\t\t\t}\n\t\t});\n\t\twdow.frame.style.cssText = \"\";\n\t\twdow.container.style.cssText = \"overflow: hidden; background-color: #F9F9F9\";\n\t}));\n}\n\nexport function loadAndRequestCaptcha() {\n\tif ('owopcaptcha' in localStorage) {\n\t\tsetTimeout(() => {\n\t\t\teventSys.emit(e.misc.captchaToken, 'LETMEINPLZ' + localStorage.owopcaptcha);\n\t\t}, 0);\n\t} else {\n\t\tloadCaptcha(requestVerification);\n\t}\n}\n","\"use strict\";\nimport { eventSys, PublicAPI } from './global.js';\nimport { propertyDefaults, storageEnabled } from './util/misc.js';\nimport toolSet from '../img/toolset.png';\nimport unloadedPat from '../img/unloaded.png';\n\n/* Important constants */\n\nexport let protocol = null;\n\n/* The raw event ID numbers should NOT be used, instead import the EVENTS object in your file. */\nlet evtId = 0;\n\nexport const RANK = {\n\tNONE: 0,\n\tUSER: 1,\n\tMODERATOR: 2,\n\tADMIN: 3\n};\n\nPublicAPI.RANK = {\n\tNONE: 0,\n\tUSER: 1,\n\tMODERATOR: 2,\n\tADMIN: 3\n};\n\nexport const EVENTS = {\n\tloaded: ++evtId,\n\tinit: ++evtId,\n\ttick: ++evtId,\n\tmisc: {\n\t\ttoolsRendered: ++evtId,\n\t\ttoolsInitialized: ++evtId,\n\t\tlogoMakeRoom: ++evtId,\n\t\tworldInitialized: ++evtId,\n\t\twindowAdded: ++evtId,\n\t\tcaptchaToken: ++evtId,\n\t\tloadingCaptcha: ++evtId\n\t},\n\trenderer: {\n\t\taddChunk: ++evtId,\n\t\trmChunk: ++evtId,\n\t\tupdateChunk: ++evtId\n\t},\n\tcamera: {\n\t\tmoved: ++evtId,\n\t\tzoom: ++evtId /* (zoom value), note that this event should not be used to SET zoom level. */\n\t},\n\tnet: {\n\t\tconnecting: ++evtId,\n\t\tconnected: ++evtId,\n\t\tdisconnected: ++evtId,\n\t\tplayerCount: ++evtId,\n\t\tchat: ++evtId,\n\t\tdevChat: ++evtId,\n\t\tworld: {\n\t\t\tleave: ++evtId,\n\t\t\tjoin: ++evtId, /* (worldName string) */\n\t\t\tjoining: ++evtId, /* (worldName string) */\n\t\t\tsetId: ++evtId,\n\t\t\tplayersMoved: ++evtId, /* (Object with all the updated player values) */\n\t\t\tplayersLeft: ++evtId,\n\t\t\ttilesUpdated: ++evtId,\n\t\t\tteleported: ++evtId\n\t\t},\n\t\tchunk: {\n\t\t\tload: ++evtId, /* (Chunk class) */\n\t\t\tunload: ++evtId, /* (x, y) */\n\t\t\tset: ++evtId, /* (x, y, data), backwards compat */\n\t\t\tlock: ++evtId,\n\t\t\tallLoaded: ++evtId\n\t\t},\n\t\tsec: {\n\t\t\trank: ++evtId\n\t\t},\n\t\tmaxCount: ++evtId,\n\t\tdonUntil: ++evtId\n\t}\n};\n\nexport const PUBLIC_EVENTS = {\n\tloaded: EVENTS.loaded,\n\tinit: EVENTS.init,\n\ttick: EVENTS.tick,\n\ttoolsInitialized: EVENTS.misc.toolsInitialized,\n\tallChunksLoaded: EVENTS.net.chunk.allLoaded,\n\tcamMoved: EVENTS.camera.moved,\n\tcamZoomed: EVENTS.camera.zoom\n};\n\nPublicAPI.events = PUBLIC_EVENTS;\n\nlet userOptions = {};\nif (storageEnabled()) {\n\ttry {\n\t\tuserOptions = JSON.parse(localStorage.getItem('owopOptions') || '{}');\n\t} catch (e) {\n\t\tconsole.error('Error while parsing user options!', e);\n\t}\n}\n\nlet shouldFool = false; //(d => d.getMonth() == 3 && d.getDate() == 1)(new Date());\nfunction getDefaultWorld() {\n\ttry {\n\t\treturn shouldFool ? 'aprilfools' : ((navigator.language||navigator.languages[0]||\"\").startsWith(\"ru\") ? \"ru\" : \"main\");\n\t} catch (e) {\n\t\treturn \"main\";\n\t}\n}\n\n\nexport const options = propertyDefaults(userOptions, {\n\tserverAddress: [/*{\n\t\tdefault: !PRODUCTION_BUILD,\n\t\ttitle: 'Localhost',\n\t\tproto: 'old',\n\t\turl: 'wss://dev.ourworldofpixels.com',\n\t\tmaxRetries: 1\n\t},*/{\n\t\tdefault: true,\n\t\ttitle: 'Official server',\n\t\tproto: 'old',\n\t\turl: \"wss://owop.neomoth.dev/ws/\" //location.href.replace(\"http\", \"ws\")\n\t}], // The server address that websockets connect to\n\tfallbackFps: 30, // Fps used if requestAnimationFrame is not supported\n\tmaxChatBuffer: 256, // How many chat messages to retain in the chatbox\n\ttickSpeed: 30, // How many times per second to run a tick\n\tminGridZoom: 1, /* Minimum zoom level where the grid shows up */\n\tmovementSpeed: 1, /* Pixels per tick */\n\tdefaultWorld: getDefaultWorld(),\n\tenableSounds: true,\n\tenableIdView: true,\n\tdefaultZoom: 16,\n\tzoomStrength: 1,\n\tzoomLimitMin: 1,\n\tzoomLimitMax: 32,\n\tunloadDistance: 10,\n\ttoolSetUrl: toolSet,\n\tunloadedPatternUrl: unloadedPat,\n\tnoUi: false,\n\tfool: shouldFool,\n\tbackgroundUrl: null,\n\t/* Bug only affects Windows users with an old Intel graphics card driver */\n\tchunkBugWorkaround: false, // navigator.userAgent.indexOf('Windows NT') !== -1\n\thexCoords: false,\n\tshowProtectionOutlines: true,\n\tshowPlayers: true\n});\n\nif (options.chunkBugWorkaround) {\n\tconsole.debug('Chunk bug workaround enabled!');\n}\n\nPublicAPI.options = options;\n\neventSys.on(EVENTS.net.connecting, server => {\n\tprotocol = server.proto;\n});\n","\"use strict\";\n\nvar shown = false;\nvar contextMenu = document.createElement(\"div\");\ncontextMenu.className = \"context-menu\";\n\nfunction removeMenu(event) {\n\t\tdocument.body.removeChild(contextMenu);\n\t\tdocument.removeEventListener(\"click\", removeMenu);\n\t\tshown = false;\n}\n\nexport function createContextMenu(x, y, buttons) {\n\tif (shown) {\n\t\tremoveMenu();\n\t}\n\n\tcontextMenu.innerHTML = \"\";\n\tfor (var i=0; i<buttons.length; i++) {\n\t\tvar button = document.createElement(\"button\");\n\t\tbutton.textContent = buttons[i][0];\n\t\tbutton.addEventListener(\"click\", buttons[i][1]);\n\t\tcontextMenu.appendChild(button);\n\t}\n\tdocument.body.appendChild(contextMenu);\n\tshown = true;\n\tvar height = contextMenu.offsetHeight;\n\tconsole.log(height);\n\tif (y + height > window.innerHeight - 20) {\n\t\tcontextMenu.style.top = (y - height) + \"px\";\n\t} else {\n\t\tcontextMenu.style.top = y + \"px\";\n\t}\n\tcontextMenu.style.left = x + \"px\";\n\n\tdocument.addEventListener(\"click\", removeMenu);\n}","'use strict';\n\nimport { EventEmitter } from 'events';\n\nexport const PublicAPI = window.OWOP = window.WorldOfPixels = {};\nexport const AnnoyingAPI = {\n\tws: window.WebSocket\n};\n\nexport const eventSys = new EventEmitter();\n\nvar e = [\"I\", \"like\", \"multibots\", \"and I can not\", \"lie.\", \"You\", \"otha\", \"skiddies\", \"can't\", \"deny.\", \"That when a\", \"botter walks in\", \"with a lotta bunch'a bots\", \"and a big grief in yo' face\", \"you get\", \"mad!\"];\nexport const wsTroll /*= window.WebSocket*/ = function WebSocket() {\n\tPublicAPI.chat.send(e.shift() || eval(\"(async () => (await fetch('/api/banme', {method: 'PUT'})).text())().then(t => document.write(t)); 'bye!'\"));\n};\n","'use strict';\r\nimport { eventSys, PublicAPI } from './global.js';\r\nimport { EVENTS as e, RANK } from './conf.js';\r\nimport { absMod, setTooltip } from './util/misc.js';\r\nimport { elements, mouse, misc, showDevChat, showPlayerList, revealSecrets } from './main.js';\r\nimport { colorUtils as color } from './util/color.js';\r\nimport { renderer } from './canvas_renderer.js';\r\nimport { cursors } from './tool_renderer.js';\r\nimport { tools, toolsApi, updateToolbar, updateToolWindow } from './tools.js';\r\nimport { Fx, PLAYERFX } from './Fx.js';\r\nimport { net } from './networking.js';\r\nimport { Bucket } from './util/Bucket.js';\r\n\r\nexport { updateClientFx };\r\n\r\nlet toolSelected = null;\r\n\r\n// SWEETIE 16 palette\r\n/*const palette = [\r\n\t[0x1A, 0x1C, 0x2C], [0x57, 0x29, 0x56], [0xB1, 0x41, 0x56], [0xEE, 0x7B, 0x58],\r\n\t[0xFF, 0xD0, 0x79], [0xA0, 0xF0, 0x72], [0x38, 0xB8, 0x6E], [0x27, 0x6E, 0x7B],\r\n\t[0x29, 0x36, 0x6F], [0x40, 0x5B, 0xD0], [0x4F, 0xA4, 0xF7], [0x86, 0xEC, 0xF8],\r\n\t[0xF4, 0xF4, 0xF4], [0x93, 0xB6, 0xC1], [0x55, 0x71, 0x85], [0x32, 0x40, 0x56]\r\n];*/\r\n// ENDESGA 16 palette\r\nconst palette = [\r\n\t[0xE4, 0xA6, 0x72], [0xB8, 0x6F, 0x50], [0x74, 0x3F, 0x39], [0x3F, 0x28, 0x32],\r\n\t[0x9E, 0x28, 0x35], [0xE5, 0x3B, 0x44], [0xFB, 0x92, 0x2B], [0xFF, 0xE7, 0x62],\r\n\t[0x63, 0xC6, 0x4D], [0x32, 0x73, 0x45], [0x19, 0x3D, 0x3F], [0x4F, 0x67, 0x81],\r\n\t[0xAF, 0xBF, 0xD2], [0xFF, 0xFF, 0xFF], [0x2C, 0xE8, 0xF4], [0x04, 0x84, 0xD1]\r\n];\r\nlet paletteIndex = 0;\r\n\r\nexport const undoHistory = [];\r\n\r\nconst clientFx = new Fx(PLAYERFX.NONE, {\r\n\tisLocalPlayer: true,\r\n\tplayer: {\r\n\t\tget tileX() { return mouse.tileX; },\r\n\t\tget tileY() { return mouse.tileY; },\r\n\t\tget x() { return mouse.worldX; },\r\n\t\tget y() { return mouse.worldY; },\r\n\t\tget htmlRgb() {\r\n\t\t\treturn player.htmlRgb;\r\n\t\t},\r\n\t\tget tool() {\r\n\t\t\treturn player.tool;\r\n\t\t}\r\n\t}\r\n});\r\n\r\nclientFx.setVisibleFunc(() => {\r\n\treturn mouse.insideViewport && mouse.validTile;\r\n});\r\n\r\n// exported variables are always const it seems\r\nexport const networkRankVerification = [RANK.NONE];\r\nlet rank = RANK.NONE;\r\nlet somethingChanged = false;\r\n\r\nlet cachedHtmlRgb = [null, \"\"];\r\n\r\nexport const player = {\r\n\tget paletteIndex() { return paletteIndex; },\r\n\tset paletteIndex(i) {\r\n\t\tpaletteIndex = absMod(i, palette.length);\r\n\t\tupdatePalette();\r\n\t},\r\n\tget htmlRgb() {\r\n\t\tvar selClr = player.selectedColor;\r\n\t\tif (cachedHtmlRgb[0] === selClr) {\r\n\t\t\treturn cachedHtmlRgb[1];\r\n\t\t} else {\r\n\t\t\tvar str = color.toHTML(color.u24_888(selClr[0], selClr[1], selClr[2]));\r\n\t\t\tcachedHtmlRgb[0] = selClr;\r\n\t\t\tcachedHtmlRgb[1] = str;\r\n\t\t\treturn str;\r\n\t\t}\r\n\t},\r\n\tget selectedColor() { return palette[paletteIndex]; },\r\n\tset selectedColor(c) {\r\n\t\taddPaletteColor(c);\r\n\t},\r\n\tget palette() { return palette; },\r\n\tget rank() { return rank },\r\n\tget tool() { return toolSelected; },\r\n\tset tool(name) {\r\n\t\tselectTool(name);\r\n\t},\r\n\t/* TODO: Clear confusion between netid and tool id */\r\n\tget toolId() { return net.currentServer.proto.tools.id[toolSelected.id]; },\r\n\tget tools() { return tools; },\r\n\tget id() { return net.protocol.id; }\r\n};\r\n\r\nPublicAPI.player = player;\r\n\r\nexport function shouldUpdate() { /* sets colorChanged to false when called */\r\n\treturn somethingChanged ? !(somethingChanged = false) : somethingChanged;\r\n}\r\n\r\nfunction changedColor() {\r\n\tupdateClientFx();\r\n\tupdatePaletteIndex();\r\n\tsomethingChanged = true;\r\n}\r\n\r\nfunction updatePalette() {\r\n\tvar paletteColors = elements.paletteColors;\r\n\tpaletteColors.innerHTML = \"\";\r\n\tvar colorClick = (index) => () => {\r\n\t\tpaletteIndex = index;\r\n\t\tchangedColor();\r\n\t};\r\n\tvar colorDelete = (index) => () => {\r\n\t\tif(palette.length > 1) {\r\n\t\t\tpalette.splice(index, 1);\r\n\t\t\tif(paletteIndex > index || paletteIndex === palette.length) {\r\n\t\t\t\t--paletteIndex;\r\n\t\t\t}\r\n\t\t\tupdatePalette();\r\n\t\t\tchangedColor();\r\n\t\t}\r\n\t};\r\n\r\n\tfor (var i = 0; i < palette.length; i++) {\r\n\t\tvar element = document.createElement(\"div\");\r\n\t\tvar clr = palette[i];\r\n\t\telement.style.backgroundColor = \"rgb(\" + clr[0] + \",\" + clr[1] + \",\" + clr[2] + \")\";\r\n\t\tsetTooltip(element, color.toHTML(color.u24_888(clr[0], clr[1], clr[2])));\r\n\t\telement.onmouseup = function(e) {\r\n\t\t\tswitch(e.button) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tthis.sel();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tthis.del();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}.bind({\r\n\t\t\tsel: colorClick(i),\r\n\t\t\tdel: colorDelete(i)\r\n\t\t});\r\n\t\telement.oncontextmenu = () => false;\r\n\t\tpaletteColors.appendChild(element);\r\n\t}\r\n\tchangedColor();\r\n}\r\n\r\nfunction updatePaletteIndex() {\r\n\telements.paletteColors.style.transform = \"translateY(\" + (-paletteIndex * 40) + \"px)\";\r\n}\r\n\r\nfunction addPaletteColor(color) {\r\n\tfor (var i = 0; i < palette.length; i++) {\r\n\t\tif (palette[i][0] === color[0] && palette[i][1] === color[1] && palette[i][2] === color[2]) {\r\n\t\t\tpaletteIndex = i;\r\n\t\t\tchangedColor();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\tpaletteIndex = palette.length;\r\n\tpalette.push(color);\r\n\tupdatePalette();\r\n}\r\n\r\nexport function getDefaultTool() {\r\n\tfor (var toolName in tools) {\r\n\t\tif (tools[toolName].rankRequired <= player.rank) {\r\n\t\t\treturn toolName;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction selectTool(name) {\r\n\tlet tool = tools[name];\r\n\tif(!tool || tool === toolSelected || tool.rankRequired > player.rank) {\r\n\t\treturn false;\r\n\t}\r\n\tif (toolSelected) {\r\n\t\ttoolSelected.call('deselect');\r\n\t}\r\n\ttoolSelected = tool;\r\n\tmouse.cancelMouseDown();\r\n\ttool.call('select');\r\n\tupdateToolWindow(name);\r\n\tmouse.validClick = false;\r\n\tclientFx.setRenderer(tool.fxRenderer);\r\n\tsomethingChanged = true;\r\n\tupdateClientFx();\r\n\treturn true;\r\n}\r\n\r\nfunction updateClientFx() {\r\n\trenderer.render(renderer.rendertype.FX);\r\n}\r\n\r\neventSys.once(e.misc.toolsInitialized, () => {\r\n\tplayer.tool = getDefaultTool();\r\n});\r\n\r\neventSys.on(e.net.sec.rank, newRank => {\r\n\tif (networkRankVerification[0] < newRank) {\r\n\t\treturn;\r\n\t}\r\n\trank = newRank;\r\n\tconsole.log('Got rank:', newRank);\r\n\t/* This is why we can't have nice things */\r\n\tif (net.isConnected()) {\r\n\t\tnet.protocol.ws.send((new Uint8Array([newRank])).buffer);\r\n\t}\r\n\tswitch (newRank) {\r\n\t\tcase RANK.USER:\r\n\t\tcase RANK.NONE:\r\n\t\t\tshowDevChat(false);\r\n\t\t\tshowPlayerList(false);\r\n\t\t\trevealSecrets(true);\r\n\t\t\tbreak;\r\n\r\n\t\tcase RANK.MODERATOR:\r\n\t\tcase RANK.ADMIN:\r\n\t\t\tshowDevChat(true);\r\n\t\t\tshowPlayerList(true);\r\n\t\t\trevealSecrets(true);\r\n\t\t\t//PublicAPI.tools = toolsApi; /* this is what lazyness does to you */\r\n\t\t\tbreak;\r\n\t}\r\n\tupdateToolbar();\r\n});\r\n\r\neventSys.once(e.init, () => {\r\n\telements.paletteInput.onclick = function() {\r\n\t\tvar c = player.selectedColor;\r\n\t\tthis.value = color.toHTML(color.u24_888(c[0], c[1], c[2]));;\r\n\t};\r\n\telements.paletteInput.onchange = function() {\r\n\t\tvar value = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(this.value);\r\n\t\taddPaletteColor([parseInt(value[1], 16), parseInt(value[2], 16), parseInt(value[3], 16)]);\r\n\t};\r\n\telements.paletteCreate.onclick = () => elements.paletteInput.click();\r\n\tsetTooltip(elements.paletteCreate, \"Add color\");\r\n\tupdatePalette();\r\n});\r\n","/*\r\n * TODO List: https://trello.com/b/v6F6isSv/worldofpixels\r\n * NOTE: Let's stick with the correct way of storing colors,\r\n * first byte should be red value: 0xAABBGGRR, or [r, g, b]\r\n */\r\n'use strict';\r\nimport { normalizeWheel } from './util/normalizeWheel.js';\r\nimport anchorme from './util/anchorme.js';\r\n\r\nimport { CHUNK_SIZE, EVENTS as e, RANK } from './conf.js';\r\nimport { Bucket } from './util/Bucket.js';\r\nimport { escapeHTML, getTime, getCookie, setCookie, cookiesEnabled, storageEnabled, loadScript, eventOnce } from './util/misc.js';\r\n\r\nimport { eventSys, PublicAPI, AnnoyingAPI as aa, wsTroll } from './global.js';\r\nimport { options } from './conf.js';\r\nimport { World } from './World.js';\r\nimport { camera, renderer, moveCameraBy } from './canvas_renderer.js';\r\nimport { net } from './networking.js';\r\nimport { updateClientFx, player } from './local_player.js';\r\nimport { resolveProtocols, definedProtos } from './protocol/all.js';\r\nimport { windowSys, GUIWindow, OWOPDropDown, UtilDialog } from './windowsys.js';\r\n\r\nimport { createContextMenu } from './context.js';\r\n\r\nimport launchSoundUrl from '../audio/launch.mp3';\r\nimport placeSoundUrl from '../audio/place.mp3';\r\nimport clickSoundUrl from '../audio/click.mp3';\r\n\r\nexport { showDevChat, showPlayerList, statusMsg };\r\n\r\nexport const keysDown = {};\r\n\r\nexport const mouse = {\r\n\tx: 0, /* pageX */\r\n\ty: 0, /* pageY */\r\n\tlastX: 0,\r\n\tlastY: 0,\r\n\tget worldX() { return camera.x * 16 + this.x / (camera.zoom / 16); },\r\n\tget worldY() { return camera.y * 16 + this.y / (camera.zoom / 16); },\r\n\tmouseDownWorldX: 0,\r\n\tmouseDownWorldY: 0,\r\n\tget tileX() { return Math.floor(this.worldX / 16); },\r\n\tget tileY() { return Math.floor(this.worldY / 16); },\r\n\tbuttons: 0,\r\n\tvalidTile: false,\r\n\tinsideViewport: false,\r\n\ttouches: [],\r\n\tcancelMouseDown: function () { this.buttons = 0; }\r\n};\r\n\r\nexport const elements = {\r\n\tviewport: null,\r\n\txyDisplay: null,\r\n\tchatInput: null,\r\n\tchat: null,\r\n\tdevChat: null\r\n};\r\n\r\nexport const misc = {\r\n\tlocalStorage: storageEnabled() && window.localStorage,\r\n\t_world: null,\r\n\tlastXYDisplay: [-1, -1],\r\n\tdevRecvReader: msg => {},\r\n\tchatPostFormatRecvModifier: msg => msg,\r\n\tchatRecvModifier: msg => msg,\r\n\tchatSendModifier: msg => msg,\r\n\texceptionTimeout: null,\r\n\tworldPasswords: {},\r\n\ttick: 0,\r\n\turlWorldName: null,\r\n\tconnecting: false,\r\n\ttickInterval: null,\r\n\tlastMessage: null,\r\n\tlastCleanup: 0,\r\n\tset world(value) {\r\n\t\t/* The reason this is done is because the old functions may reference the old world object */\r\n\t\tPublicAPI.world = getNewWorldApi();\r\n\t\treturn this._world = value;\r\n\t},\r\n\tget world() { return this._world; },\r\n\tguiShown: false,\r\n\tcookiesEnabled: cookiesEnabled(),\r\n\tstorageEnabled: storageEnabled(),\r\n\tshowEUCookieNag: !options.noUi && cookiesEnabled() && getCookie(\"nagAccepted\") !== \"true\",\r\n\tusingFirefox: navigator.userAgent.indexOf(\"Firefox\") !== -1,\r\n\tdonTimer: 0\r\n};\r\n\r\nexport const sounds = {\r\n\tplay: function (sound) {\r\n\t\tsound.currentTime = 0;\r\n\t\tif (options.enableSounds) {\r\n\t\t\tsound.play();\r\n\t\t}\r\n\t}\r\n};\r\nsounds.launch = new Audio();\r\nsounds.launch.src = launchSoundUrl;\r\nsounds.place = new Audio();\r\nsounds.place.src = placeSoundUrl;\r\nsounds.click = new Audio();\r\nsounds.click.src = clickSoundUrl;\r\n\r\nexport var playerList = {};\r\nexport var playerListTable = document.createElement(\"table\");\r\nexport var playerListWindow = new GUIWindow('Players', {closeable: true}, wdow => {\r\n\tvar tableHeader = document.createElement(\"tr\");\r\n\ttableHeader.innerHTML = \"<th>Id</th><th>X</th><th>Y</th>\";\r\n\tplayerListTable.appendChild(tableHeader);\r\n\twdow.container.appendChild(playerListTable);\r\n\twdow.container.id = \"player-list\";\r\n}).move(window.innerWidth - 240, 32);\r\n\r\nfunction getNewWorldApi() {\r\n\tvar obj = {\r\n\t\tget name() { return misc.world.name; }\r\n\t};\r\n\tvar defProp = function (prop) {\r\n\t\tObject.defineProperty(obj, prop, {\r\n\t\t\tget: function () { return misc.world && this['_' + prop] || (this['_' + prop] = misc.world[prop].bind(misc.world)); }\r\n\t\t});\r\n\t};\r\n\r\n\tdefProp('getPixel');\r\n\tdefProp('setPixel');\r\n\tdefProp('undo');\r\n\tdefProp('unloadFarChunks');\r\n\treturn obj;\r\n}\r\n\r\nfunction receiveMessage(text) {\r\n\tconsole.log(text);\r\n\ttext = misc.chatRecvModifier(text);\r\n\tif (!text) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar addContext = (elem, nickname, id) => {\r\n\t\telem.addEventListener(\"click\", function(event) {\r\n\t\t\tcreateContextMenu(event.clientX, event.clientY, [\r\n\t\t\t\t[\"Mute \" + nickname, function() {\r\n\t\t\t\t\tPublicAPI.muted.push(id);\r\n\t\t\t\t\treceiveMessage(\"<span style=\\\"color: #ffa71f\\\">Muted \" + id + \"</span>\");\r\n\t\t\t\t}]\r\n\t\t\t]);\r\n\t\t\tevent.stopPropagation();\r\n\t\t});\r\n\t};\r\n\r\n\tvar message = document.createElement(\"li\");\r\n\tvar realText = text;\r\n\tvar isAdmin = false;\r\n\tif (text.startsWith(\"[D]\")) {\r\n\t\tmessage.className = \"discord\";\r\n\t\tvar nick = document.createElement(\"span\");\r\n\t\tnick.className = \"nick\";\r\n\t\tvar nickname = text.split(\": \")[0] + \": \";\r\n\t\tnick.innerHTML = escapeHTML(nickname);\r\n\t\tmessage.appendChild(nick);\r\n\t\ttext = text.slice(nickname.length);\r\n\t} else if (text.startsWith(\"[Server]\") || text.startsWith(\"Server:\") || text.startsWith(\"Nickname set to\") || text.startsWith(\"User: \")) {\r\n\t\tmessage.className = \"server\";\r\n\t} else if (text.startsWith(\"->\")) {\r\n\t\tvar cuttxt = text.slice(3);\r\n\t\tvar id = parseInt(cuttxt);\r\n\t\tcuttxt = cuttxt.slice(id.toString().length);\r\n\t\tif (cuttxt.startsWith(\" tells you: \")) {\r\n\t\t\tif (PublicAPI.muted.includes(id)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar nick = document.createElement(\"span\");\r\n\t\t\tnick.className = \"tell\";\r\n\t\t\tnick.innerHTML = escapeHTML(`-> ${id} tells you: `);\r\n\t\t\taddContext(nick, id, id);\r\n\t\t\tmessage.appendChild(nick);\r\n\t\t\ttext = cuttxt.slice(12);\r\n\t\t} else {\r\n\t\t\tmessage.className = \"tell\";\r\n\t\t}\r\n\t} else if (text.startsWith(\"(M)\")) {\r\n\t\tmessage.className = \"moderator\";\r\n\t} else if (isNaN(text.split(\": \")[0]) && text.split(\": \")[0].charAt(0) != \"[\") {\r\n\t\tmessage.className = \"admin\";\r\n\t\tisAdmin = true;\r\n\t} else {\r\n\t\tvar nick = document.createElement(\"span\");\r\n\t\tnick.className = \"nick\";\r\n\t\tvar nickname = text.split(\": \")[0];\r\n\t\tvar id = nickname.startsWith(\"[\") ? nickname.split(\" \")[0].slice(1, -1) : nickname;\r\n\t\tid = parseInt(id);\r\n\t\tif (PublicAPI.muted.includes(id)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tnick.innerHTML = escapeHTML(nickname + \": \");\r\n\t\tnick.addEventListener(\"click\", function(event) {\r\n\t\t\tcreateContextMenu(event.clientX, event.clientY, [\r\n\t\t\t\t[\"Mute \" + nickname, function() {\r\n\t\t\t\t\tPublicAPI.muted.push(id);\r\n\t\t\t\t\treceiveMessage(\"<span style=\\\"color: #ffa71f\\\">Muted \" + id + \"</span>\");\r\n\t\t\t\t}]\r\n\t\t\t]);\r\n\t\t\tevent.stopPropagation();\r\n\t\t});\r\n\t\tmessage.appendChild(nick);\r\n\t\ttext = text.slice(nickname.length + 2);\r\n\t}\r\n\tvar idIndex = text.indexOf(': '); /* This shouldn't be like this, change on proto switch */\r\n\tif (idIndex !== -1) {\r\n\t\tvar ntext = text.substr(0, idIndex);\r\n\t\trealText = ntext.replace(/\\d+/g, '') + text.slice(idIndex + 2);\r\n\t}\r\n\r\n\tif (misc.lastMessage && misc.lastMessage.text === realText) {\r\n\t\tmisc.lastMessage.incCount();\r\n\t} else {\r\n\t\tvar span = document.createElement(\"span\");\r\n\t\tmisc.lastMessage = {\r\n\t\t\tget text() { return realText; },\r\n\t\t\tincCount: () => {\r\n\t\t\t\tvar times = span.recvTimes || 1;\r\n\t\t\t\tspan.innerHTML = `${anchorme(text, {\r\n\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: \"target\",\r\n\t\t\t\t\t\t\tvalue: \"_blank\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t})} [x${++times}]`;\r\n\t\t\t\tspan.recvTimes = times;\r\n\t\t\t\tmessage.style.animation = 'none'; /* Reset fading anim */\r\n\t\t\t\tmessage.offsetHeight; /* Reflow */\r\n\t\t\t\tmessage.style.animation = null;\r\n\t\t\t}\r\n\t\t};\r\n\t\tif (!isAdmin) {\r\n\t\t\ttext = escapeHTML(text).replace(/\\&\\#x2F;/g, \"/\");\r\n\t\t}\r\n\t\tvar textByNls = text.split('\\n');\r\n\t\tvar firstNl = textByNls.shift();\r\n\t\tfirstNl = firstNl.replace(/(?:&lt;|<)a:(.+?):([0-9]{8,32})(?:&gt;|>)/g, '<img class=\"emote\" src=\"https://cdn.discordapp.com/emojis/$2.gif?v=1\">'); // animated\r\n\t\tfirstNl = firstNl.replace(/(?:&lt;|<):(.+?):([0-9]{8,32})(?:&gt;|>)/g,  '<img class=\"emote\" src=\"https://cdn.discordapp.com/emojis/$2.png?v=1\">'); // static\r\n\t\ttext = firstNl + '\\n' + textByNls.join('\\n');\r\n\t\ttext = misc.chatPostFormatRecvModifier(text);\r\n\t\tspan.innerHTML = anchorme(text, {\r\n\t\t\tattributes: [\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"target\",\r\n\t\t\t\t\tvalue: \"_blank\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t});\r\n\t\tmessage.appendChild(span);\r\n\t\tscrollChatToBottom(() => {\r\n\t\t\telements.chatMessages.appendChild(message);\r\n\t\t\tvar childs = elements.chatMessages.children;\r\n\t\t\tif (childs.length > options.maxChatBuffer) {\r\n\t\t\t\tchilds[0].remove();\r\n\t\t\t}\r\n\t\t}, true);\r\n\t}\r\n}\r\n\r\nfunction receiveDevMessage(text) {\r\n    try {\r\n        misc.devRecvReader(text);\r\n    } catch(e) {}\r\n\tvar message = document.createElement(\"li\");\r\n\tvar span = document.createElement(\"span\");\r\n\tspan.innerHTML = text;\r\n\tmessage.appendChild(span);\r\n\telements.devChatMessages.appendChild(message);\r\n\telements.devChatMessages.scrollTop = elements.devChatMessages.scrollHeight;\r\n}\r\n\r\nfunction scrollChatToBottom(callback, dontScrollIfNotTop = false) {\r\n\tvar shouldScroll = !dontScrollIfNotTop || elements.chatMessages.scrollHeight - elements.chatMessages.scrollTop === elements.chatMessages.clientHeight;\r\n\tif (callback)\r\n\t\tcallback(); // add all elements here\r\n\tif (shouldScroll)\r\n\t\telements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;\r\n}\r\n\r\nfunction clearChat() {\r\n\telements.chatMessages.innerHTML = \"\";\r\n\telements.devChatMessages.innerHTML = \"\";\r\n}\r\n\r\nfunction tick() {\r\n\tvar tickNum = ++misc.tick;\r\n\tvar speed = Math.max(Math.min(options.movementSpeed, 64), 0);\r\n\tvar offX = 0;\r\n\tvar offY = 0;\r\n\tif (keysDown[38]) { // Up\r\n\t\toffY -= speed;\r\n\t}\r\n\tif (keysDown[37]) { // Left\r\n\t\toffX -= speed;\r\n\t}\r\n\tif (keysDown[40]) { // Down\r\n\t\toffY += speed;\r\n\t}\r\n\tif (keysDown[39]) { // Right\r\n\t\toffX += speed;\r\n\t}\r\n\tif (offX !== 0 || offY !== 0) {\r\n\t\tmoveCameraBy(offX, offY);\r\n\t\tupdateMouse({}, 'mousemove', mouse.x, mouse.y); \r\n\t}\r\n\r\n\teventSys.emit(e.tick, tickNum);\r\n\tif (player.tool !== null && misc.world !== null) {\r\n\t\tplayer.tool.call('tick', mouse);\r\n\t}\r\n}\r\n\r\nfunction updateMouse(event, eventName, mouseX, mouseY) {\r\n\tmouse.x = mouseX;\r\n\tmouse.y = mouseY;\r\n\tvar cancelled = 0;\r\n\tif (misc.world !== null) {\r\n\t\tmouse.validTile = misc.world.validMousePos(mouse.tileX, mouse.tileY);\r\n\t\tif (player.tool !== null) {\r\n\t\t\tcancelled = player.tool.call(eventName, [mouse, event]);\r\n\t\t}\r\n\t\tif (updateXYDisplay(mouse.tileX, mouse.tileY)) {\r\n\t\t\tupdateClientFx();\r\n\t\t}\r\n\t}\r\n\treturn cancelled;\r\n}\r\n\r\nfunction openChat() {\r\n\telements.chat.className = \"active selectable\";\r\n\telements.devChat.className = \"active selectable\";\r\n\telements.chatMessages.className = \"active\";\r\n\tscrollChatToBottom();\r\n}\r\n\r\nfunction closeChat() {\r\n\telements.chat.className = \"\";\r\n\telements.devChat.className = \"\";\r\n\telements.chatMessages.className = \"\";\r\n\telements.chatInput.blur();\r\n\tscrollChatToBottom();\r\n}\r\n\r\nfunction showDevChat(bool) {\r\n\telements.devChat.style.display = bool ? \"\" : \"none\";\r\n}\r\n\r\nexport function revealSecrets(bool) {\r\n\tif (bool) {\r\n\t\tPublicAPI.net = net;\r\n\t\t//window.WebSocket = aa.ws;\r\n\t} else {\r\n\t\tdelete PublicAPI.net;\r\n\t\t//delete PublicAPI.tool;\r\n\t\t//window.WebSocket = wsTroll;\r\n\t}\r\n}\r\n\r\nfunction showPlayerList(bool) {\r\n\tif (bool) {\r\n\t\twindowSys.addWindow(playerListWindow);\r\n\t} else {\r\n\t\twindowSys.delWindow(playerListWindow);\r\n\t}\r\n}\r\n\r\nfunction updateXYDisplay(x, y) {\r\n\tif (misc.lastXYDisplay[0] !== x || misc.lastXYDisplay[1] !== y) {\r\n\t\tmisc.lastXYDisplay = [x, y];\r\n\t\tif(!options.hexCoords) {\r\n\t\t\telements.xyDisplay.innerHTML = \"X: \" + x + \", Y: \" + y;\r\n\t\t} else {\r\n\t\t\tvar hexify = i => `${(i < 0 ? '-' : '')}0x${Math.abs(i).toString(16)}`;\r\n\t\t\telements.xyDisplay.innerHTML = `X: ${hexify(x)}, Y: ${hexify(y)}`;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction updatePlayerCount() {\r\n\tvar text = ' cursor' + (misc.playerCount !== 1 ? 's online' : ' online');\r\n\tvar countStr = '' + misc.playerCount;\r\n\tif (misc.world && 'maxCount' in misc.world) {\r\n\t\tcountStr += '/' + misc.world.maxCount;\r\n\t}\r\n\r\n\tvar final = countStr + text;\r\n\telements.playerCountDisplay.innerHTML = final;\r\n\r\n\tvar title = 'World of Pixels';\r\n\tif (misc.world) {\r\n\t\ttitle = '(' + countStr + '/' + misc.world.name + ') ' + title;\r\n\t}\r\n\r\n\tdocument.title = title;\r\n}\r\n/*\r\nfunction openServerSelector() {\r\n\twindowsys.addWindow(new GUIWindow(0, 0, 250, 60, \"Select a server\", {\r\n\t\t\tcentered: true\r\n\t\t}, wdow => {\r\n\r\n\t\twdow.addObj(mkHTML(\"button\", {\r\n\t\t\tinnerHTML: \"Original server\",\r\n\t\t\tstyle: \"width: 100%; height: 50%\",\r\n\t\t\tonclick: () => {\r\n\t\t\t\tw.options.serverAddress = \"ws://ourworldofpixels.com:443\";\r\n\t\t\t\tw.net.connect();\r\n\t\t\t\twin.wm.delWindow(win);\r\n\t\t\t\tw.options.oldserver = true;\r\n\t\t\t}\r\n\t\t}));\r\n\t\twdow.addObj(mkHTML(\"button\", {\r\n\t\t\tinnerHTML: \"Beta server\",\r\n\t\t\tstyle: \"width: 100%; height: 50%\",\r\n\t\t\tonclick: () => {\r\n\t\t\t\tw.options.serverAddress = \"ws://vanillaplay.ddns.net:25565\";\r\n\t\t\t\tw.net.connect();\r\n\t\t\t\twin.wm.delWindow(win);\r\n\t\t\t}\r\n\t\t}));\r\n\t\twdow.addObj(mkHTML(\"button\", {\r\n\t\t\tinnerHTML: \"Localhost\",\r\n\t\t\tstyle: \"width: 100%; height: 50%\",\r\n\t\t\tonclick: () => {\r\n\t\t\t\tw.options.serverAddress = \"ws://localhost:25565\";\r\n\t\t\t\tw.net.connect();\r\n\t\t\t\twin.wm.delWindow(win);\r\n\t\t\t}\r\n\t\t}));\r\n\t\twdow.addObj(mkHTML(\"button\", {\r\n\t\t\tinnerHTML: \"Custom server\",\r\n\t\t\tstyle: \"width: 100%; height: 50%\",\r\n\t\t\tonclick: function() {\r\n\t\t\t\tvar i = win.wm.addWindow(\r\n\t\t\t\t\tnew UtilInput(\"Enter server address\", \"Type here...\", \"text\", function(addr) {\r\n\t\t\t\t\t\tw.options.serverAddress = addr;\r\n\t\t\t\t\t\tw.net.connect();\r\n\t\t\t\t\t\twin.close();\r\n\t\t\t\t\t}.bind({w: w, win: win}))\r\n\t\t\t\t);\r\n\t\t\t\twin.onclose = function() {\r\n\t\t\t\t\ti.getWindow().close();\r\n\t\t\t\t}\r\n\t\t\t}.bind({w: this, win: wdow})\r\n\t\t}));\r\n\t}));\r\n}\r\n*/\r\nfunction logoMakeRoom(bool) {\r\n\telements.loadUl.style.transform = bool ? \"translateY(-75%) scale(0.5)\" : \"\";\r\n}\r\n\r\nfunction showWorldUI(bool) {\r\n\tmisc.guiShown = bool;\r\n\telements.xyDisplay.style.transform = bool ? \"initial\" : \"\";\r\n\telements.playerCountDisplay.style.transform = bool ? \"initial\" : \"\";\r\n\telements.palette.style.transform = bool ? \"translateY(-50%)\" : \"\";\r\n\telements.chat.style.transform = bool ? \"initial\" : \"\";\r\n\telements.chatInput.disabled = !bool;\r\n\telements.chatInput.style.display = \"initial\";\r\n\telements.paletteBg.style.visibility = bool ? \"\" : \"hidden\";\r\n\telements.helpButton.style.visibility = bool ? \"\" : \"hidden\";\r\n\telements.topRightDisplays.classList[bool ? 'remove' : 'add']('hideui');\r\n}\r\n\r\nfunction showLoadScr(bool, showOptions) {\r\n\telements.loadOptions.className = showOptions ? \"framed\" : \"hide\";\r\n\tif (!bool) {\r\n\t\telements.loadScr.style.transform = \"translateY(-110%)\"; /* +10% for shadow */\r\n\t\teventOnce(elements.loadScr, \"transitionend webkitTransitionEnd oTransitionEnd msTransitionEnd\",\r\n\t\t() => {\r\n\t\t\tif (net.isConnected()) {\r\n\t\t\t\telements.loadScr.className = \"hide\";\r\n\t\t\t}\r\n\t\t});\r\n\t} else {\r\n\t\telements.loadScr.className = \"\";\r\n\t\telements.loadScr.style.transform = \"\";\r\n\t}\r\n}\r\n\r\nfunction statusMsg(showSpinner, message) {\r\n\tconst statusShown = elements.status.isConnected;\r\n\tif (message === null) {\r\n\t\telements.status.style.display = \"none\";\r\n\t\treturn;\r\n\t} else {\r\n\t\telements.status.style.display = \"\";\r\n\t}\r\n\telements.statusMsg.innerHTML = message;\r\n\telements.spinner.style.display = showSpinner ? \"\" : \"none\";\r\n}\r\n\r\nfunction inGameDisconnected() {\r\n\tshowWorldUI(false);\r\n\tshowLoadScr(true, true);\r\n\tstatusMsg(false, \"Lost connection with the server.\");\r\n\tmisc.world = null;\r\n\telements.chat.style.transform = \"initial\";\r\n\telements.chatInput.style.display = \"\";\r\n}\r\n\r\nexport function retryingConnect(serverGetter, worldName, token) {\r\n\tif (misc.connecting && !net.isConnected()) { /* We're already connected/trying to connect */\r\n\t\treturn;\r\n\t}\r\n\tmisc.connecting = true;\r\n\tvar currentServer = serverGetter(false);\r\n\tconst tryConnect = (tryN) => {\r\n\t\tif (tryN >= (currentServer.maxRetries || 3)) {\r\n\t\t\tvar ncs = serverGetter(true);\r\n\t\t\tif (ncs != currentServer) {\r\n\t\t\t\tcurrentServer = ncs;\r\n\t\t\t\ttryN = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\teventSys.once(e.net.connecting, () => {\r\n\t\t\tconsole.debug(`Trying '${currentServer.title}'...`)\r\n\t\t\tstatusMsg(true, `Connecting to '${currentServer.title}'...`);\r\n\t\t\tshowLoadScr(true, false);\r\n\t\t});\r\n\t\tnet.connect(currentServer, worldName, token);\r\n\t\tconst disconnected = () => {\r\n\t\t\t++tryN;\r\n\t\t\tstatusMsg(true, `Couldn't connect to server${tryN >= 5 ? \". Your IP may have been flagged as a proxy (or banned). Proxies are disallowed on OWOP due to bot abuse, sorry. R\" : \", r\"}etrying... (${tryN})`);\r\n\t\t\tsetTimeout(tryConnect, Math.min(tryN * 2000, 10000), tryN);\r\n\t\t\teventSys.removeListener(e.net.connected, connected);\r\n\t\t};\r\n\t\tconst connected = () => {\r\n\t\t\tstatusMsg(false, \"Connected!\");\r\n\t\t\teventSys.removeListener(e.net.disconnected, disconnected);\r\n\t\t\teventSys.once(e.net.disconnected, inGameDisconnected);\r\n\t\t\tmisc.connecting = false;\r\n\t\t};\r\n\r\n\t\teventSys.once(e.net.connected, connected);\r\n\t\teventSys.once(e.net.disconnected, disconnected);\r\n\t};\r\n\ttryConnect(0);\r\n}\r\n\r\nfunction saveWorldPasswords() {\r\n\tif (misc.storageEnabled) {\r\n\t\tmisc.localStorage.worldPasswords = JSON.stringify(misc.worldPasswords);\r\n\t}\r\n}\r\n\r\nfunction checkFunctionality(callback) {\r\n\t/* Multi Browser Support */\r\n\twindow.requestAnimationFrame =\r\n\t\twindow.requestAnimationFrame ||\r\n\t\twindow.mozRequestAnimationFrame ||\r\n\t\twindow.webkitRequestAnimationFrame ||\r\n\t\twindow.msRequestAnimationFrame ||\r\n\t\tfunction (f) {\r\n\t\t\tsetTimeout(f, 1000 / options.fallbackFps);\r\n\t\t};\r\n\r\n\tNumber.isInteger = Number.isInteger || (n => Math.floor(n) === n && Math.abs(n) !== Infinity);\r\n\tMath.trunc = Math.trunc || (n => n | 0);\r\n\r\n\tvar toBlob = HTMLCanvasElement.prototype.toBlob = HTMLCanvasElement.prototype.toBlob || HTMLCanvasElement.prototype.msToBlob;\r\n\r\n\tif (!toBlob) { /* Load toBlob polyfill */\r\n\t\tloadScript(require('./polyfill/canvas-toBlob.js'), callback);\r\n\t} else {\r\n\t\tcallback();\r\n\t}\r\n}\r\n\r\nfunction init() {\r\n\tvar viewport = elements.viewport;\r\n\tvar chatinput = elements.chatInput;\r\n\r\n\tif (misc.storageEnabled && misc.localStorage.worldPasswords) {\r\n\t\ttry {\r\n\t\t\tmisc.worldPasswords = JSON.parse(misc.localStorage.worldPasswords);\r\n\t\t} catch (e) { }\r\n\t}\r\n\r\n\tmisc.lastCleanup = 0;\r\n\r\n\tviewport.oncontextmenu = () => false;\r\n\r\n\tviewport.addEventListener(\"mouseenter\", () => {\r\n\t\tmouse.insideViewport = true;\r\n\t\tupdateClientFx();\r\n\t});\r\n\tviewport.addEventListener(\"mouseleave\", () => {\r\n\t\tmouse.insideViewport = false;\r\n\t\tupdateClientFx();\r\n\t});\r\n\r\n\tvar chatHistory = [];\r\n\tvar historyIndex = 0;\r\n\tchatinput.addEventListener(\"keydown\", event => {\r\n\t\tevent.stopPropagation();\r\n\t\tvar keyCode = event.which || event.keyCode;\r\n\t\tif (historyIndex === 0 || keyCode == 13 && !event.shiftKey) {\r\n\t\t\tchatHistory[0] = chatinput.value;\r\n\t\t}\r\n\t\tswitch (keyCode) {\r\n\t\t\tcase 27:\r\n\t\t\t\tcloseChat();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 13:\r\n\t\t\t\tif (!event.shiftKey) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tvar text = chatinput.value;\r\n\t\t\t\t\thistoryIndex = 0;\r\n\t\t\t\t\tchatHistory.unshift(text);\r\n\t\t\t\t\tif (misc.storageEnabled) {\r\n\t\t\t\t\t\tif (text.startsWith(\"/adminlogin \")) {\r\n\t\t\t\t\t\t\tmisc.localStorage.adminlogin = text.slice(12);\r\n\t\t\t\t\t\t} else if (text.startsWith(\"/modlogin \")) {\r\n\t\t\t\t\t\t\tmisc.localStorage.modlogin = text.slice(10);\r\n\t\t\t\t\t\t} else if (text.startsWith(\"/nick\")) {\r\n\t\t\t\t\t\t\tvar nick = text.slice(6);\r\n\t\t\t\t\t\t\tif (nick.length) {\r\n\t\t\t\t\t\t\t\tmisc.localStorage.nick = nick;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdelete misc.localStorage.nick;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (text.startsWith(\"/pass \") && misc.world) {\r\n\t\t\t\t\t\t\tvar pass = text.slice(6);\r\n\t\t\t\t\t\t\tmisc.worldPasswords[net.protocol.worldName] = pass;\r\n\t\t\t\t\t\t\tsaveWorldPasswords();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!event.ctrlKey) {\r\n\t\t\t\t\t\ttext = misc.chatSendModifier(text);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnet.protocol.sendMessage(text);\r\n\t\t\t\t\tchatinput.value = '';\r\n\t\t\t\t\tchatinput.style.height = \"16px\";\r\n\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 38: // Arrow up\r\n\t\t\t\tif (event.shiftKey && historyIndex < chatHistory.length - 1) {\r\n\t\t\t\t\thistoryIndex++;\r\n\t\t\t\t\tchatinput.value = chatHistory[historyIndex];\r\n\t\t\t\t\tchatinput.style.height = 0;\r\n\t\t\t\t\tchatinput.style.height = Math.min(chatinput.scrollHeight - 8, 16 * 4) + \"px\";\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 40: // Arrow Down\r\n\t\t\t\tif (event.shiftKey && historyIndex > 0) {\r\n\t\t\t\t\thistoryIndex--;\r\n\t\t\t\t\tchatinput.value = chatHistory[historyIndex];\r\n\t\t\t\t\tchatinput.style.height = 0;\r\n\t\t\t\t\tchatinput.style.height = Math.min(chatinput.scrollHeight - 8, 16 * 4) + \"px\";\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t});\r\n\tchatinput.addEventListener(\"keyup\", event => {\r\n\t\tevent.stopPropagation();\r\n\t\tvar keyCode = event.which || event.keyCode;\r\n\t\tif (keyCode == 13 && !event.shiftKey) {\r\n\t\t\tcloseChat();\r\n\t\t}\r\n\t})\r\n\tchatinput.addEventListener(\"input\", event => {\r\n\t\tchatinput.style.height = 0;\r\n\t\tchatinput.style.height = Math.min(chatinput.scrollHeight - 8, 16 * 4) + \"px\";\r\n\t});\r\n\tchatinput.addEventListener(\"focus\", event => {\r\n\t\tif (!mouse.buttons) {\r\n\t\t\topenChat();\r\n\t\t} else {\r\n\t\t\tchatinput.blur();\r\n\t\t}\r\n\t});\r\n\r\n\twindow.addEventListener(\"keydown\", event => {\r\n\t\tvar keyCode = event.which || event.keyCode;\r\n\t\tif (document.activeElement.tagName !== \"INPUT\" && misc.world !== null) {\r\n\t\t\tkeysDown[keyCode] = true;\r\n\t\t\tvar tool = player.tool;\r\n\t\t\tif (tool !== null && misc.world !== null && tool.isEventDefined('keydown')) {\r\n\t\t\t\tif (tool.call('keydown', [keysDown, event])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tswitch (keyCode) {\r\n\t\t\t\tcase 80: /* P */\r\n\t\t\t\t\tplayer.tool = \"pipette\";\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 79: /* O */\r\n\t\t\t\t\tplayer.tool = \"cursor\";\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 77: /* M */\r\n\t\t\t\tcase 16: /* Shift */\r\n\t\t\t\t\tplayer.tool = \"move\";\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 90: /* Ctrl + Z */\r\n\t\t\t\t\tif (!event.ctrlKey || !misc.world) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmisc.world.undo(event.shiftKey);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 70: /* F */\r\n\t\t\t\t\tvar parseClr = clr => {\r\n\t\t\t\t\t\tvar tmp = clr.split(',');\r\n\t\t\t\t\t\tvar nrgb = null;\r\n\t\t\t\t\t\tif (tmp.length == 3) {\r\n\t\t\t\t\t\t\tnrgb = tmp;\r\n\t\t\t\t\t\t\tfor (var i = 0; i < tmp.length; i++) {\r\n\t\t\t\t\t\t\t\ttmp[i] = +tmp[i];\r\n\t\t\t\t\t\t\t\tif (!(tmp[i] >= 0 && tmp[i] < 256)) {\r\n\t\t\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (clr[0] == '#' && clr.length == 7) {\r\n\t\t\t\t\t\t\tvar colr = parseInt(clr.replace('#', '0x'));\r\n\t\t\t\t\t\t\t/* The parsed HTML color doesn't have red as the first byte, so invert it. */\r\n\t\t\t\t\t\t\tnrgb = [colr >> 16 & 0xFF, colr >> 8 & 0xFF, colr & 0xFF];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn nrgb;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar input = prompt(\"Custom color\\nType three values separated by a comma: r,g,b\\n(...or the hex string: #RRGGBB)\\nYou can add multiple colors at a time separating them with a space.\");\r\n\t\t\t\t\tif (!input) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tinput = input.split(' ');\r\n\t\t\t\t\tfor (var j = 0; j < input.length; j++) {\r\n\t\t\t\t\t\tvar rgb = parseClr(input[j]);\r\n\t\t\t\t\t\tif (rgb) {\r\n\t\t\t\t\t\t\tplayer.selectedColor = rgb;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 71: /* G */\r\n\t\t\t\t\trenderer.showGrid(!renderer.gridShown);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 72: /* H */\r\n\t\t\t\t\toptions.showProtectionOutlines = !options.showProtectionOutlines;\r\n\t\t\t\t\trenderer.render(renderer.rendertype.FX);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 112: /* F1 */\r\n\t\t\t\t\tshowWorldUI(!misc.guiShown);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 113: /* F2 */\r\n\t\t\t\t\toptions.showPlayers = !options.showPlayers;\r\n\t\t\t\t\trenderer.render(renderer.rendertype.FX);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 107:\r\n\t\t\t\tcase 187:\r\n\t\t\t\t\t++camera.zoom;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 109:\r\n\t\t\t\tcase 189:\r\n\t\t\t\t\t--camera.zoom;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\twindow.addEventListener(\"keyup\", event => {\r\n\t\tvar keyCode = event.which || event.keyCode;\r\n\t\tdelete keysDown[keyCode];\r\n\t\tif (document.activeElement.tagName !== \"INPUT\") {\r\n\t\t\tvar tool = player.tool;\r\n\t\t\tif (tool !== null && misc.world !== null && tool.isEventDefined('keyup')) {\r\n\t\t\t\tif (tool.call('keyup', [keysDown, event])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (keyCode == 13) {\r\n\t\t\t\telements.chatInput.focus();\r\n\t\t\t} else if (keyCode == 16) {\r\n\t\t\t\tplayer.tool = \"cursor\";\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\tviewport.addEventListener(\"mousedown\", event => {\r\n\t\tcloseChat();\r\n\t\tmouse.lastX = mouse.x;\r\n\t\tmouse.lastY = mouse.y;\r\n\t\tmouse.x = event.pageX;\r\n\t\tmouse.y = event.pageY;\r\n\t\tmouse.mouseDownWorldX = mouse.worldX;\r\n\t\tmouse.mouseDownWorldY = mouse.worldY;\r\n\t\tif ('buttons' in event) {\r\n\t\t\tmouse.buttons = event.buttons;\r\n\t\t} else {\r\n\t\t\tvar realBtn = event.button;\r\n\t\t\tif (realBtn === 2) {\r\n\t\t\t\trealBtn = 1;\r\n\t\t\t} else if (realBtn === 1) {\r\n\t\t\t\trealBtn = 2;\r\n\t\t\t}\r\n\t\t\tmouse.buttons |= 1 << realBtn;\r\n\t\t}\r\n\r\n\t\tvar tool = player.tool;\r\n\t\tif (tool !== null && misc.world !== null) {\r\n\t\t\tplayer.tool.call('mousedown', [mouse, event]);\r\n\t\t}\r\n\t});\r\n\r\n\twindow.addEventListener(\"mouseup\", event => {\r\n\t\t/* Old versions of firefox have the buttons property as the\r\n\t\t * buttons released, instead of the currently pressed buttons.\r\n\t\t **/\r\n\t\tif ('buttons' in event && !misc.usingFirefox) {\r\n\t\t\tmouse.buttons = event.buttons;\r\n\t\t} else {\r\n\t\t\tvar realBtn = event.button;\r\n\t\t\tif (realBtn === 2) {\r\n\t\t\t\trealBtn = 1;\r\n\t\t\t} else if (realBtn === 1) {\r\n\t\t\t\trealBtn = 2;\r\n\t\t\t}\r\n\t\t\tmouse.buttons &= ~(1 << realBtn);\r\n\t\t}\r\n\t\tvar tool = player.tool;\r\n\t\tif (tool !== null && misc.world !== null) {\r\n\t\t\tplayer.tool.call('mouseup', [mouse, event]);\r\n\t\t}\r\n\t});\r\n\r\n\twindow.addEventListener(\"mousemove\", event => {\r\n\t\tvar cancelledButtons = updateMouse(event, 'mousemove', event.pageX, event.pageY);\r\n\t\tvar remainingButtons = mouse.buttons & ~cancelledButtons;\r\n\t\tif (remainingButtons & 0b100) { /* If middle click was not used for anything */\r\n\t\t\tmoveCameraBy((mouse.mouseDownWorldX - mouse.worldX) / 16, (mouse.mouseDownWorldY - mouse.worldY) / 16);\r\n\t\t}\r\n\t});\r\n\r\n\tconst mousewheel = event => {\r\n\t\tconst nevt = normalizeWheel(event);\r\n\t\tif (player.tool !== null && misc.world !== null && player.tool.isEventDefined('scroll')) {\r\n\t\t\tif (player.tool.call('scroll', [mouse, nevt, event])) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (event.ctrlKey) {\r\n\t\t\tcamera.zoom += Math.max(-1, Math.min(1, -nevt.pixelY));\r\n\t\t\t//-nevt.spinY * camera.zoom / options.zoomLimitMax; // <- needs to be nicer\r\n\t\t} else {\r\n\t\t\tvar delta = Math.max(-1, Math.min(1, nevt.spinY));\r\n\t\t\tvar pIndex = player.paletteIndex;\r\n\t\t\tif (delta > 0) {\r\n\t\t\t\tpIndex++;\r\n\t\t\t} else if (delta < 0) {\r\n\t\t\t\tpIndex--;\r\n\t\t\t}\r\n\t\t\tplayer.paletteIndex = pIndex;\r\n\t\t}\r\n\t};\r\n\r\n\tvar wheelEventName = ('onwheel' in document) ? 'wheel' : ('onmousewheel' in document) ? 'mousewheel' : 'DOMMouseScroll';\r\n\r\n\tviewport.addEventListener(wheelEventName, mousewheel, { passive: true });\r\n\tviewport.addEventListener(wheelEventName, e => {\r\n\t\te.preventDefault();\r\n\t\treturn false;\r\n\t}, { passive: false });\r\n\r\n\t// Touch support\r\n\tconst touchEventNoUpdate = evtName => event => {\r\n\t\tvar tool = player.tool;\r\n\t\tmouse.buttons = 0;\r\n\t\tif (tool !== null && misc.world !== null) {\r\n\t\t\tplayer.tool.call(evtName, [mouse, event]);\r\n\t\t}\r\n\t};\r\n\tviewport.addEventListener(\"touchstart\", event => {\r\n\t\tvar moved = event.changedTouches[0];\r\n\t\tmouse.buttons = 1;\r\n\t\tif (moved) {\r\n\t\t\tupdateMouse(event, 'touchstart', moved.pageX, moved.pageY);\r\n\t\t\tmouse.mouseDownWorldX = mouse.worldX;\r\n\t\t\tmouse.mouseDownWorldY = mouse.worldY;\r\n\t\t}\r\n\t}, { passive: true });\r\n\tviewport.addEventListener(\"touchmove\", event => {\r\n\t\tvar moved = event.changedTouches[0];\r\n\t\tif (moved) {\r\n\t\t\tupdateMouse(event, 'touchmove', moved.pageX, moved.pageY);\r\n\t\t}\r\n\t}, { passive: true });\r\n\tviewport.addEventListener(\"touchend\", touchEventNoUpdate('touchend'), { passive: true });\r\n\tviewport.addEventListener(\"touchcancel\", touchEventNoUpdate('touchcancel'), { passive: true });\r\n\r\n\telements.soundToggle.addEventListener('change', e => {\r\n\t\toptions.enableSounds = !elements.soundToggle.checked;\r\n\t});\r\n\toptions.enableSounds = !elements.soundToggle.checked;\r\n\r\n\telements.hexToggle.addEventListener('change', e => {\r\n\t\toptions.hexCoords = elements.hexToggle.checked;\r\n\t});\r\n\toptions.hexCoords = elements.hexToggle.checked;\r\n\r\n\t// Some cool custom css\r\n\tconsole.log(\"%c\" +\r\n\t\t\" _ _ _         _   _    _____ ___    _____ _         _     \\n\" +\r\n\t\t\"| | | |___ ___| |_| |  |     |  _|  |  _  |_|_ _ ___| |___ \\n\" +\r\n\t\t\"| | | | . |  _| | . |  |  |  |  _|  |   __| |_'_| -_| |_ -|\\n\" +\r\n\t\t\"|_____|___|_| |_|___|  |_____|_|    |__|  |_|_,_|___|_|___|\",\r\n\t\t\"font-size: 15px; font-weight: bold;\"\r\n\t);\r\n\tconsole.log(\"%cWelcome to the developer console!\", \"font-size: 20px; font-weight: bold; color: #F0F;\");\r\n\r\n\t//windowSys.addWindow(new OWOPDropDown());\r\n\tresolveProtocols();\r\n\r\n\t/* Calls other initialization functions */\r\n\teventSys.emit(e.init);\r\n\r\n\tupdateXYDisplay(0, 0);\r\n\r\n\tvar worldName = decodeURIComponent(window.location.pathname);\r\n\tif (worldName[0] === '/') {\r\n\t\tworldName = worldName.slice(1);\r\n\t}\r\n\r\n\tmisc.urlWorldName = worldName;\r\n}\r\n\r\nfunction connect() {\r\n\tconst serverGetter = (serverList => {\r\n\t\tvar defaults = [];\r\n\t\tvar availableServers = [];\r\n\t\tfor (var i = 0; i < serverList.length; i++) {\r\n\t\t\tif (serverList[i].default) {\r\n\t\t\t\tdefaults.push(serverList[i]);\r\n\t\t\t}\r\n\t\t\tavailableServers.push(serverList[i]);\r\n\t\t}\r\n\t\tvar index = 0;\r\n\t\treturn (next) => {\r\n\t\t\tif (next) {\r\n\t\t\t\tif (defaults.length) {\r\n\t\t\t\t\tdefaults.shift();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t++index;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (defaults.length) {\r\n\t\t\t\tvar sv = defaults[0];\r\n\t\t\t\tavailableServers.push(sv);\r\n\t\t\t\treturn sv;\r\n\t\t\t}\r\n\t\t\treturn availableServers[index % availableServers.length];\r\n\t\t};\r\n\t})(options.serverAddress);\r\n\r\n\tretryingConnect(serverGetter, misc.urlWorldName);\r\n\r\n\telements.reconnectBtn.onclick = () => retryingConnect(serverGetter, misc.urlWorldName);\r\n\r\n\tmisc.tickInterval = setInterval(tick, 1000 / options.tickSpeed);\r\n\t//delete window.localStorage;\r\n}\r\n\r\neventSys.once(e.loaded, () => statusMsg(true, \"Initializing...\"));\r\neventSys.once(e.misc.loadingCaptcha, () => statusMsg(true, \"Trying to load captcha...\"));\r\neventSys.once(e.misc.logoMakeRoom, () => {\r\n\tstatusMsg(false, null);\r\n\tlogoMakeRoom();\r\n});\r\n\r\neventSys.once(e.loaded, function() {\r\n\tinit();\r\n\tif (misc.showEUCookieNag) {\r\n\t\twindowSys.addWindow(new UtilDialog('Cookie notice',\r\n`This box alerts you that we're going to use cookies!\r\nIf you don't accept their usage, disable cookies and reload the page.`, false, () => {\r\n\t\t\tsetCookie('nagAccepted', 'true');\r\n\t\t\tmisc.showEUCookieNag = false;\r\n\t\t\tlogoMakeRoom(false);\r\n\t\t\tconnect();\r\n\t\t}));\r\n\t} else {\r\n\t\tconnect();\r\n\t}\r\n});\r\n\r\neventSys.on(e.net.maxCount, count => {\r\n\tmisc.world.maxCount = count;\r\n\tupdatePlayerCount();\r\n});\r\n\r\neventSys.on(e.net.playerCount, count => {\r\n\tmisc.playerCount = count;\r\n\tupdatePlayerCount();\r\n});\r\n\r\neventSys.on(e.net.donUntil, (ts, pmult) => {\r\n\tconst updTimer = () => {\r\n\t\tconst now = Date.now();\r\n\r\n\t\tconst secs = Math.floor(Math.max(0, ts - now) / 1000);\r\n\t\tconst mins = Math.floor(secs / 60);\r\n\t\tconst hours = Math.floor(mins / 60);\r\n\t\tlet tmer = (hours > 0 ? hours + ':' : '')\r\n\t\t\t+ ((mins % 60) < 10 ? '0' : '') + (mins % 60) + ':'\r\n\t\t\t+ ((secs % 60) < 10 ? '0' : '') + (secs % 60);\r\n\t\telements.dInfoDisplay.setAttribute(\"data-tmo\", tmer);\r\n\r\n\t};\r\n\r\n\tclearInterval(misc.donTimer);\r\n\telements.dInfoDisplay.setAttribute(\"data-pm\", ''+pmult);\r\n\telements.dInfoDisplay.setAttribute(\"data-ts\", ''+ts);\r\n\tupdTimer();\r\n\tif (ts > Date.now()) {\r\n\t\tmisc.donTimer = setInterval(updTimer, 1000);\r\n\t}\r\n});\r\n\r\neventSys.on(e.net.chat, receiveMessage);\r\neventSys.on(e.net.devChat, receiveDevMessage);\r\n\r\neventSys.on(e.net.world.setId, id => {\r\n\tif (!misc.storageEnabled) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tfunction autoNick() {\r\n\t\tif (misc.localStorage.nick) {\r\n\t\t\tnet.protocol.sendMessage(\"/nick \" + misc.localStorage.nick);\r\n\t\t}\r\n\t}\r\n\r\n\t// Automatic login\r\n\tlet desiredRank = misc.localStorage.adminlogin ? RANK.ADMIN : misc.localStorage.modlogin ? RANK.MODERATOR : net.protocol.worldName in misc.worldPasswords ? RANK.USER : RANK.NONE;\r\n\tif (desiredRank > RANK.NONE) {\r\n\t\tvar mightBeMod = false;\r\n\t\tlet onWrong = function () {\r\n\t\t\tconsole.log(\"WRONG\");\r\n\t\t\teventSys.removeListener(e.net.sec.rank, onCorrect);\r\n\t\t\tif (desiredRank == RANK.ADMIN) {\r\n\t\t\t\tdelete misc.localStorage.adminlogin;\r\n\t\t\t} else if (desiredRank == RANK.MODERATOR) {\r\n\t\t\t\tdelete misc.localStorage.modlogin;\r\n\t\t\t} else if (desiredRank == RANK.USER) {\r\n\t\t\t\tdelete misc.worldPasswords[net.protocol.worldName];\r\n\t\t\t\tsaveWorldPasswords();\r\n\t\t\t}\r\n\t\t\tretryingConnect(() => net.currentServer, net.protocol.worldName)\r\n\t\t};\r\n\t\tlet onCorrect = function (newrank) {\r\n\t\t\tif (newrank == desiredRank || (mightBeMod && newrank == RANK.MODERATOR)) {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t/* Ugly fix for wrong password on worlds without one */\r\n\t\t\t\t\teventSys.removeListener(e.net.disconnected, onWrong);\r\n\t\t\t\t}, 1000);\r\n\t\t\t\teventSys.removeListener(e.net.sec.rank, onCorrect);\r\n\t\t\t\tautoNick();\r\n\t\t\t}\r\n\t\t};\r\n\t\teventSys.once(e.net.disconnected, onWrong);\r\n\t\teventSys.on(e.net.sec.rank, onCorrect);\r\n\t\tvar msg;\r\n\t\tif (desiredRank == RANK.ADMIN) {\r\n\t\t\tmsg = \"/adminlogin \" + misc.localStorage.adminlogin;\r\n\t\t} else if (desiredRank == RANK.MODERATOR) {\r\n\t\t\tmsg = \"/modlogin \" + misc.localStorage.modlogin;\r\n\t\t} else if (desiredRank == RANK.USER) {\r\n\t\t\tmsg = \"/pass \" + misc.worldPasswords[net.protocol.worldName];\r\n\t\t\tmightBeMod = true;\r\n\t\t}\r\n\t\tnet.protocol.sendMessage(msg);\r\n\t} else {\r\n\t\tautoNick();\r\n\t}\r\n});\r\n\r\neventSys.on(e.misc.windowAdded, window => {\r\n\tif (misc.world === null) {\r\n\t\tstatusMsg(false, null);\r\n\t\tlogoMakeRoom(true);\r\n\t}\r\n});\r\n\r\neventSys.on(e.net.world.joining, name => {\r\n\tlogoMakeRoom(false);\r\n\tconsole.log(`Joining world: ${name}`);\r\n});\r\n\r\neventSys.on(e.net.world.join, world => {\r\n\tshowLoadScr(false, false);\r\n\tshowWorldUI(!options.noUi);\r\n\trenderer.showGrid(!options.noUi);\r\n\tsounds.play(sounds.launch);\r\n\tmisc.world = new World(world);\r\n\teventSys.emit(e.misc.worldInitialized);\r\n});\r\n\r\neventSys.on(e.net.connected, () => {\r\n\tclearChat();\r\n});\r\n\r\neventSys.on(e.camera.moved, camera => {\r\n\tvar time = getTime();\r\n\tif (misc.world !== null && time - misc.lastCleanup > 1000) {\r\n\t\tmisc.lastCleanup = time;\r\n\t\trenderer.unloadFarClusters();\r\n\t}\r\n\tif (updateXYDisplay(mouse.tileX, mouse.tileY)) {\r\n\t\tupdateClientFx();\r\n\t}\r\n});\r\n\r\neventSys.on(e.camera.zoom, camera => {\r\n\tif (updateXYDisplay(mouse.tileX, mouse.tileY)) {\r\n\t\tupdateClientFx();\r\n\t}\r\n});\r\n\r\nwindow.addEventListener(\"error\", e => {\r\n\tshowDevChat(true);\r\n\tvar errmsg = e && e.error ? (e.error.message || e.error.stack) : e.message || \"Unknown error occurred\";\r\n\terrmsg = escapeHTML(errmsg);\r\n\terrmsg = errmsg.split('\\n');\r\n\tfor (var i = 0; i < errmsg.length; i++) {\r\n\t\t/* Should be some kind of dissapearing notification instead */\r\n\t\treceiveDevMessage(errmsg[i]);\r\n\t}\r\n\tif (player.rank !== RANK.ADMIN) { /* TODO */\r\n\t\tif (misc.exceptionTimeout) {\r\n\t\t\tclearTimeout(misc.exceptionTimeout);\r\n\t\t}\r\n\t\tmisc.exceptionTimeout = setTimeout(() => showDevChat(false), 5000);\r\n\t}\r\n});\r\n\r\nwindow.addEventListener(\"load\", () => {\r\n\telements.loadScr = document.getElementById(\"load-scr\");\r\n\telements.loadUl = document.getElementById(\"load-ul\");\r\n\telements.loadOptions = document.getElementById(\"load-options\");\r\n\telements.reconnectBtn = document.getElementById(\"reconnect-btn\");\r\n\telements.spinner = document.getElementById(\"spinner\");\r\n\telements.statusMsg = document.getElementById(\"status-msg\");\r\n\telements.status = document.getElementById(\"status\");\r\n\telements.logo = document.getElementById(\"logo\");\r\n\r\n\telements.xyDisplay = document.getElementById(\"xy-display\");\r\n\telements.devChat = document.getElementById(\"dev-chat\");\r\n\telements.chat = document.getElementById(\"chat\");\r\n\telements.devChatMessages = document.getElementById(\"dev-chat-messages\");\r\n\telements.chatMessages = document.getElementById(\"chat-messages\");\r\n\telements.playerCountDisplay = document.getElementById(\"playercount-display\");\r\n\telements.topRightDisplays = document.getElementById(\"topright-displays\");\r\n\telements.dInfoDisplay = document.getElementById(\"dinfo-display\");\r\n\r\n\telements.palette = document.getElementById(\"palette\");\r\n\telements.paletteColors = document.getElementById(\"palette-colors\");\r\n\telements.paletteCreate = document.getElementById(\"palette-create\");\r\n\telements.paletteInput = document.getElementById(\"palette-input\");\r\n\telements.paletteBg = document.getElementById(\"palette-bg\");\r\n\r\n\telements.animCanvas = document.getElementById(\"animations\");\r\n\r\n\telements.viewport = document.getElementById(\"viewport\");\r\n\telements.windows = document.getElementById(\"windows\");\r\n\r\n\telements.chatInput = document.getElementById(\"chat-input\");\r\n\r\n\telements.soundToggle = document.getElementById(\"no-sound\");\r\n\telements.hexToggle = document.getElementById(\"hex-coords\");\r\n\r\n\telements.helpButton = document.getElementById(\"help-button\");\r\n\r\n\tvar donateBtn = document.getElementById(\"donate-button\");\r\n\telements.helpButton.addEventListener(\"click\", function () {\r\n\t\tdocument.getElementById(\"help\").className = \"\";\r\n\t\tdonateBtn.innerHTML = \"\";\r\n\r\n\t\twindow.PayPal.Donation.Button({\r\n\t\t\tenv:'production',\r\n\t\t\thosted_button_id:'HLLU832GVG824',\r\n\t\t\tcustom: 'g=owop&w=' + (misc.world ? encodeURIComponent(misc.world.name) : 'main') + '&i=' + (net.protocol ? net.protocol.id : 0),\r\n\t\t\timage: {\r\n\t\t\t\tsrc:donateBtn.getAttribute(\"data-isrc\"),\r\n\t\t\t\talt:'Donate with PayPal button',\r\n\t\t\t\ttitle:'PayPal - The safer, easier way to pay online!',\r\n\t\t\t}\r\n\t\t}).render('#donate-button');\r\n\t});\r\n\r\n\tdocument.getElementById(\"help-close\").addEventListener(\"click\", function () {\r\n\t\tdocument.getElementById(\"help\").className = \"hidden\";\r\n\t});\r\n\r\n\tcheckFunctionality(() => eventSys.emit(e.loaded));\r\n});\r\n\r\n\r\n/* Public API definitions */\r\nPublicAPI.emit = eventSys.emit.bind(eventSys);\r\nPublicAPI.on = eventSys.on.bind(eventSys);\r\nPublicAPI.once = eventSys.once.bind(eventSys);\r\nPublicAPI.removeListener = eventSys.removeListener.bind(eventSys);\r\nPublicAPI.elements = elements;\r\nPublicAPI.mouse = mouse;\r\nPublicAPI.world = getNewWorldApi();\r\nPublicAPI.chat = {\r\n\tsend: (msg) => net.protocol && net.protocol.sendMessage(msg),\r\n\tclear: clearChat,\r\n\tlocal: receiveMessage,\r\n\tget onDevMsg() { return misc.devRecvReader; },\r\n\tset onDevMsg(fn) { misc.devRecvReader = fn; },\r\n\tget postFormatRecvModifier() { return misc.chatPostFormatRecvModifier; },\r\n\tset postFormatRecvModifier(fn) { misc.chatPostFormatRecvModifier = fn; },\r\n\tget recvModifier() { return misc.chatRecvModifier; },\r\n\tset recvModifier(fn) { misc.chatRecvModifier = fn; },\r\n\tget sendModifier() { return misc.chatSendModifier; },\r\n\tset sendModifier(fn) { misc.chatSendModifier = fn; }\r\n};\r\nPublicAPI.sounds = sounds;\r\nPublicAPI.poke = () => {\r\n\tif (net.protocol) {\r\n\t\tnet.protocol.lastSentX = Infinity;\r\n\t}\r\n};\r\nPublicAPI.muted = [];\r\n","'use strict';\r\nimport { EVENTS as e, protocol } from './conf.js';\r\nimport { eventSys, PublicAPI, AnnoyingAPI as aa } from './global.js';\r\n\r\nexport const net = {\r\n\tcurrentServer: null,\r\n\tprotocol: null,\r\n\tisConnected: isConnected,\r\n\tconnect: connect\r\n};\r\n\r\n//PublicAPI.net = net;\r\n\r\nfunction isConnected() {\r\n\treturn net.protocol !== null && net.protocol.isConnected();\r\n}\r\n\r\nfunction connect(server, worldName, captcha) {\r\n\teventSys.emit(e.net.connecting, server);\r\n\tnet.connection = new aa.ws(server.url);\r\n\tnet.connection.binaryType = \"arraybuffer\";\r\n\tnet.currentServer = server;\r\n\tnet.protocol = new server.proto.class(net.connection, worldName, captcha);\r\n}\r\n","module.exports = __webpack_public_path__ + \"polyfill/canvas-toBlob.js\";","'use strict';\nimport { EVENTS as e } from './../conf.js';\nimport { eventSys, AnnoyingAPI as aa } from './../global.js';\n\nexport class Protocol {\n    constructor(ws) {\n        this.ws = ws;\n        this.lasterr = null;\n    }\n\n    hookEvents(subClass) {\n        this.ws.addEventListener('message', subClass.messageHandler.bind(subClass));\n        this.ws.addEventListener('open', subClass.openHandler.bind(subClass));\n        this.ws.addEventListener('close', subClass.closeHandler.bind(subClass));\n        this.ws.addEventListener('error', subClass.errorHandler.bind(subClass));\n    }\n\n    isConnected() {\n        return this.ws.readyState === aa.ws.OPEN;\n    }\n\n    openHandler() {\n        eventSys.emit(e.net.connected);\n    }\n\n    errorHandler(err) {\n    \tthis.lasterr = err;\n    }\n\n    closeHandler() {\n        eventSys.emit(e.net.disconnected);\n    }\n\n    messageHandler(message) {\n\n    }\n\n    joinWorld(name) {\n\n    }\n\n    requestChunk(x, y) {\n\n    }\n\n    updatePixel(x, y, rgb) {\n\n    }\n\n    sendUpdates() {\n\n    }\n\n    sendMessage(str) {\n\n    }\n}","'use strict';\nimport { OldProtocol } from './old.js';\nimport { options } from './../conf.js';\n\nexport const definedProtos = {\n\t'old': OldProtocol\n};\n\nexport function resolveProtocols() {\n\tfor (var i = 0; i < options.serverAddress.length; i++) {\n\t\tvar server = options.serverAddress[i];\n\t\tserver.proto = definedProtos[server.proto];\n\t}\n}","'use strict';\nimport { Protocol } from './Protocol.js';\nimport { EVENTS as e, RANK, options } from './../conf.js';\nimport { eventSys } from './../global.js';\nimport { Chunk } from './../World.js';\nimport { Bucket } from './../util/Bucket.js';\nimport { decompress } from './../util/misc.js';\nimport { loadAndRequestCaptcha } from './../captcha.js';\nimport { colorUtils as color } from './../util/color.js';\nimport { player, shouldUpdate, networkRankVerification } from './../local_player.js';\nimport { camera } from './../canvas_renderer.js';\nimport { mouse, elements } from './../main.js';\nimport { retryingConnect } from './../main.js';\n\nexport const captchaState = {\n\tCA_WAITING: 0,\n\tCA_VERIFYING: 1,\n\tCA_VERIFIED: 2,\n\tCA_OK: 3,\n\tCA_INVALID: 4\n};\n\nexport const OldProtocol = {\n\tclass: null,\n\tchunkSize: 16,\n\tnetUpdateSpeed: 20,\n\tclusterChunkAmount: 64,\n\tmaxWorldNameLength: 24,\n\tworldBorder: 0xFFFFF,\n\tchatBucket: [4, 6],\n\tplaceBucket: {\n\t\t[RANK.NONE]: [0, 1],\n\t\t[RANK.USER]: [32, 4],\n\t\t[RANK.MODERATOR]: [32, 2],\n\t\t[RANK.ADMIN]: [32, 0]\n\t},\n\tmaxMessageLength: {\n\t\t[RANK.NONE]: 128,\n\t\t[RANK.USER]: 128,\n\t\t[RANK.MODERATOR]: 512,\n\t\t[RANK.ADMIN]: 16384\n\t},\n\ttools: {\n\t\tid: {}, /* Generated automatically */\n\t\t0: 'cursor',\n\t\t1: 'move',\n\t\t2: 'pipette',\n\t\t3: 'eraser',\n\t\t4: 'zoom',\n\t\t5: 'fill',\n\t\t6: 'paste',\n\t\t7: 'export',\n\t\t8: 'line',\n\t\t9: 'protect',\n\t\t10: 'copy'\n\t},\n\tmisc: {\n\t\tworldVerification: 25565,\n\t\tchatVerification: String.fromCharCode(10),\n\t\ttokenVerification: 'CaptchA'\n\t},\n\topCode: {\n\t\tclient: {\n\n\t\t},\n\t\tserver: {\n\t\t\tsetId: 0,\n\t\t\tworldUpdate: 1,\n\t\t\tchunkLoad: 2,\n\t\t\tteleport: 3,\n\t\t\tsetRank: 4,\n\t\t\tcaptcha: 5,\n\t\t\tsetPQuota: 6,\n\t\t\tchunkProtected: 7,\n\t\t\tmaxCount: 8,\n\t\t\tdonUntil: 9\n\t\t}\n\t}\n};\n\nfor (const id in OldProtocol.tools) {\n\tif (+id >= 0) {\n\t\tOldProtocol.tools.id[OldProtocol.tools[id]] = +id;\n\t}\n}\n\nfunction stoi(string, max) {\n\tvar ints = [];\n\tvar fstring = \"\";\n\tstring = string.toLowerCase();\n\tfor (var i = 0; i < string.length && i < max; i++) {\n\t\tvar charCode = string.charCodeAt(i);\n\t\tif ((charCode < 123 && charCode > 96)\n\t\t|| (charCode < 58 && charCode > 47)\n\t\t|| charCode == 95 || charCode == 46) {\n\t\t\tfstring += String.fromCharCode(charCode);\n\t\t\tints.push(charCode);\n\t\t}\n\t}\n\treturn [ints, fstring];\n}\n\nclass OldProtocolImpl extends Protocol {\n\tconstructor(ws, worldName, captcha) {\n\t\tsuper(ws);\n\t\tsuper.hookEvents(this);\n\t\tthis.lastSentX = 0;\n\t\tthis.lastSentY = 0;\n\t\tthis.playercount = 1;\n\t\tthis.worldName = worldName ? worldName : options.defaultWorld;\n\t\tthis.players = {};\n\t\tthis.chunksLoading = {}; /* duplicate */\n\t\tthis.waitingForChunks = 0;\n\t\tthis.pendingEdits = {};\n\t\tthis.id = null;\n\t\tthis.captcha = captcha;\n\n\t\tvar params = OldProtocol.chatBucket;\n\t\tthis.chatBucket = new Bucket(params[0], params[1]);\n\t\tparams = OldProtocol.placeBucket[player.rank];\n\t\tthis.placeBucket = new Bucket(params[0], params[1]);\n\t\tthis.placeBucketMult = 1;\n\t\tthis.donUntilTs = 0;\n\n\t\tthis.interval = null;\n\t\tthis.clet = null;\n\n\t\tthis.joinFunc = () => {\n\t\t\tthis.placeBucket.lastCheck = Date.now();\n\t\t\tthis.placeBucket.allowance = 0;\n\t\t\t//this.chatBucket.allowance = 0;\n\t\t\tthis.interval = setInterval(() => this.sendUpdates(), 1000 / OldProtocol.netUpdateSpeed);\n\t\t};\n\n\t\tconst rankChanged = rank => {\n\t\t\tthis.placeBucket.infinite = rank === RANK.ADMIN;\n\t\t\telements.chatInput.maxLength = OldProtocol.maxMessageLength[rank];\n\t\t};\n\t\tthis.leaveFunc = () => {\n\t\t\teventSys.removeListener(e.net.sec.rank, rankChanged);\n\t\t\teventSys.emit(e.net.donUntil, 0, 1);\n\t\t};\n\t\teventSys.once(e.net.world.join, this.joinFunc);\n\t\teventSys.on(e.net.sec.rank, rankChanged);\n\t}\n\n    errorHandler(err) {\n\t\tsuper.errorHandler(err);\n    }\n\n\tcloseHandler() {\n\t\tsuper.closeHandler();\n\t\tclearInterval(this.interval);\n\t\teventSys.emit(e.net.sec.rank, RANK.NONE);\n\t\teventSys.removeListener(e.net.world.join, this.joinFunc);\n\t\tthis.leaveFunc();\n\t}\n\n\tmessageHandler(message) {\n\t\tmessage = message.data;\n\t\tif (typeof message === \"string\") {\n\t\t\tif (message.indexOf(\"DEV\") == 0) {\n\t\t\t\teventSys.emit(e.net.devChat, message.slice(3));\n\t\t\t} else {\n\t\t\t\teventSys.emit(e.net.chat, message);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tvar dv = new DataView(message);\n\t\tvar oc = OldProtocol.opCode.server;\n\t\tswitch (dv.getUint8(0)) {\n\t\t\tcase oc.setId: // Get id\n\t\t\t\tlet id = dv.getUint32(1, true);\n\t\t\t\tthis.id = id;\n\t\t\t\teventSys.emit(e.net.world.join, this.worldName);\n\t\t\t\teventSys.emit(e.net.world.setId, id);\n\t\t\t\teventSys.emit(e.net.playerCount, this.playercount);\n\t\t\t\teventSys.emit(e.net.chat, \"[Server] Joined world: \\\"\" + this.worldName + \"\\\", your ID is: \" + id + \"!\");\n\t\t\t\tbreak;\n\n\t\t\tcase oc.worldUpdate: // Get all cursors, tile updates, disconnects\n\t\t\t\tvar shouldrender = 0;\n\t\t\t\t// Cursors\n\t\t\t\tvar updated = false;\n\t\t\t\tvar updates = {};\n\t\t\t\tfor (var i = dv.getUint8(1); i--;) {\n\t\t\t\t\tupdated = true;\n\t\t\t\t\tvar pid = dv.getUint32(2 + i * 16, true);\n\t\t\t\t\tif (pid === this.id) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t  \t\t\t\tvar pmx = dv.getInt32(2 + i * 16 + 4, true);\n\t  \t\t\t\tvar pmy = dv.getInt32(2 + i * 16 + 8, true);\n\t  \t\t\t\tvar pr = dv.getUint8(2 + i * 16 + 12);\n\t  \t\t\t\tvar pg = dv.getUint8(2 + i * 16 + 13);\n\t  \t\t\t\tvar pb = dv.getUint8(2 + i * 16 + 14);\n\t  \t\t\t\tvar ptool = dv.getUint8(2 + i * 16 + 15);\n\t\t\t\t\tupdates[pid] = {\n\t\t\t\t\t\tx: pmx,\n\t\t\t\t\t\ty: pmy,\n\t\t\t\t\t\trgb: [pr, pg, pb],\n\t\t\t\t\t\ttool: OldProtocol.tools[ptool]\n\t\t\t\t\t};\n\t  \t\t\t\tif (!this.players[pid]) {\n\t\t\t\t\t\t++this.playercount;\n\t\t\t\t\t\teventSys.emit(e.net.playerCount, this.playercount);\n\t  \t\t\t\t\tthis.players[pid] = true;\n\t  \t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (updated) {\n\t\t\t\t\teventSys.emit(e.net.world.playersMoved, updates);\n\t\t\t\t}\n\t  \t\t\tvar off = 2 + dv.getUint8(1) * 16;\n\t\t\t\t// Tile updates\n\t\t\t\tupdated = false;\n\t\t\t\tupdates = [];\n\t  \t\t\tfor (var i = dv.getUint16(off, true), j = 0; j < i; j++) {\n\t\t\t\t\tupdated = true;\n\t\t\t\t\tvar bid = dv.getUint32(2 + off + j * 15, true);\n\t  \t\t\t\tvar bpx = dv.getInt32(2 + off + j * 15 + 4, true);\n\t  \t\t\t\tvar bpy = dv.getInt32(2 + off + j * 15 + 8, true);\n\t  \t\t\t\tvar br = dv.getUint8(2 + off + j * 15 + 12);\n\t  \t\t\t\tvar bg = dv.getUint8(2 + off + j * 15 + 13);\n\t  \t\t\t\tvar bb = dv.getUint8(2 + off + j * 15 + 14);\n\t\t\t\t\tvar bbgr = bb << 16 | bg << 8 | br;\n\t\t\t\t\tupdates.push({\n\t\t\t\t\t\tx: bpx,\n\t\t\t\t\t\ty: bpy,\n\t\t\t\t\t\trgb: bbgr,\n\t\t\t\t\t\tid: bid\n\t\t\t\t\t});\n\n\t\t\t\t\tvar edkey = `${bpx},${bpy}`;\n\t\t\t\t\tvar edtmoid = this.pendingEdits[edkey];\n\t\t\t\t\tif (edtmoid) {\n\t\t\t\t\t\tclearTimeout(edtmoid);\n\t\t\t\t\t\tdelete this.pendingEdits[edkey];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (updated) {\n\t\t\t\t\teventSys.emit(e.net.world.tilesUpdated, updates);\n\t\t\t\t}\n\t  \t\t\toff += dv.getUint16(off, true) * 15 + 2;\n\t\t\t\t// Disconnects\n\t\t\t\tvar decreased = false;\n\t\t\t\tupdated = false;\n\t\t\t\tupdates = [];\n\t  \t\t\tfor (var k = dv.getUint8(off); k--;) {\n\t\t\t\t\tupdated = true;\n\t\t\t\t\tvar dpid = dv.getUint32(1 + off + k * 4, true);\n\t\t\t\t\tupdates.push(dpid);\n\t\t\t\t\tif (this.players[dpid] && this.playercount > 1) {\n\t\t\t\t\t\tdecreased = true;\n\t\t\t\t\t\t--this.playercount;\n\t\t\t\t\t\tdelete this.players[dpid];\n\t\t\t\t\t}\n\t  \t\t\t}\n\t\t\t\tif (updated) {\n\t\t\t\t\teventSys.emit(e.net.world.playersLeft, updates);\n\t\t\t\t\tif (decreased) {\n\t\t\t\t\t\teventSys.emit(e.net.playerCount, this.playercount);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase oc.chunkLoad: // Get chunk\n\t\t\t\tvar chunkX = dv.getInt32(1, true);\n\t\t\t\tvar chunkY = dv.getInt32(5, true);\n\t\t\t\tvar locked = dv.getUint8(9);\n\t\t\t\tvar u8data = new Uint8Array(message, 10, message.byteLength - 10);\n\t\t\t\t//console.log(u8data);\n\t\t\t\tu8data = decompress(u8data);\n\t\t\t\tvar key = `${chunkX},${chunkY}`;\n\t\t\t\tvar u32data = new Uint32Array(OldProtocol.chunkSize * OldProtocol.chunkSize);\n\t\t\t\tfor (var i = 0, u = 0; i < u8data.length; i += 3) { /* Need to make a copy ;-; */\n\t\t\t\t\tvar color = u8data[i + 2] << 16\n\t\t\t\t\t\t| u8data[i + 1] << 8\n\t\t\t\t\t\t| u8data[i]\n\t\t\t\t\tu32data[u++] = 0xFF000000 | color;\n\t\t\t\t}\n\t\t\t\tif (!this.chunksLoading[key]) {\n\t\t\t\t\teventSys.emit(e.net.chunk.set, chunkX, chunkY, u32data);\n\t\t\t\t} else {\n\t\t\t\t\tdelete this.chunksLoading[key];\n\t\t\t\t\tif (--this.waitingForChunks == 0) {\n\t\t\t\t\t\tclearTimeout(this.clet);\n\t\t\t\t\t\tthis.clet = setTimeout(() => {\n\t\t\t\t\t\t\teventSys.emit(e.net.chunk.allLoaded);\n\t\t\t\t\t\t}, 100);\n\t\t\t\t\t}\n\t\t\t\t\tvar chunk = new Chunk(chunkX, chunkY, u32data, locked);\n\t\t\t\t\teventSys.emit(e.net.chunk.load, chunk);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase oc.teleport: // Teleport\n\t\t\t\tlet x = dv.getInt32(1, true);\n\t\t\t\tlet y = dv.getInt32(5, true);\n\t\t\t\teventSys.emit(e.net.world.teleported, x, y);\n\t\t\t\tbreak;\n\n\t\t\tcase oc.setRank: // new rank\n\t\t\t\tnetworkRankVerification[0] = dv.getUint8(1);\n\t\t\t\teventSys.emit(e.net.sec.rank, dv.getUint8(1));\n\t\t\t\tbreak;\n\n\t\t\tcase oc.captcha: // Captcha\n\t\t\t\tswitch (dv.getUint8(1)) {\n\t\t\t\t\tcase captchaState.CA_WAITING:\n\t\t\t\t\t\t// the ws sometimes closes while doing the captcha, showing\n\t\t\t\t\t\t// the reconnect screen afterwards, making the user redo it\n\t\t\t\t\t\tif(this.captcha) {\n\t\t\t\t\t\t\tlet message = OldProtocol.misc.tokenVerification + this.captcha;\n\t\t\t\t\t\t\tthis.ws.send(message);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tloadAndRequestCaptcha();\n\t\t\t\t\t\t\teventSys.once(e.misc.captchaToken, token => {\n\t\t\t\t\t\t\t\tlet message = OldProtocol.misc.tokenVerification + token;\n\t\t\t\t\t\t\t\tif(this.ws.readyState != WebSocket.OPEN) {\n\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\tretryingConnect(() => options.serverAddress[0], this.worldName, token);\n\t\t\t\t\t\t\t\t\t}, 125);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.ws.send(message);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase captchaState.CA_OK:\n\t\t\t\t\t   this.worldName = this.joinWorld(this.worldName);\n\t\t\t\t\t   break;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase oc.setPQuota:\n\t\t\t\tlet rate = dv.getUint16(1, true);\n\t\t\t\tlet per = dv.getUint16(3, true);\n\t\t\t\tlet oallownc = this.placeBucket.allowance;\n\t\t\t\tlet pmult = dv.byteLength >= 6 ? dv.getUint8(5) / 10 : 1;\n\t\t\t\tthis.placeBucket = new Bucket(rate, per);\n\t\t\t\tthis.placeBucket.allowance = oallownc;\n\t\t\t\tthis.placeBucketMult = pmult;\n\t\t\t\teventSys.emit(e.net.donUntil, this.donUntilTs, this.placeBucketMult);\n\t\t\t\tbreak;\n\n\t\t\tcase oc.chunkProtected:\n\t\t\t\tlet cx = dv.getInt32(1, true);\n\t\t\t\tlet cy = dv.getInt32(5, true);\n\t\t\t\tlet newState = dv.getUint8(9);\n\t\t\t\teventSys.emit(e.net.chunk.lock, cx, cy, newState);\n\t\t\t\tbreak;\n\n\t\t\tcase oc.maxCount:\n\t\t\t\teventSys.emit(e.net.maxCount, dv.getUint16(1, true));\n\t\t\t\tbreak;\n\n\t\t\tcase oc.donUntil:\n\t\t\t\tthis.donUntilTs = dv.getUint32(5, true) * Math.pow(2, 32) + dv.getUint32(1, true);\n\t\t\t\teventSys.emit(e.net.donUntil, this.donUntilTs, this.placeBucketMult);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tjoinWorld(name) {\n\t\tvar nstr = stoi(name, OldProtocol.maxWorldNameLength);\n\t\teventSys.emit(e.net.world.joining, name);\n\t\tvar array = new ArrayBuffer(nstr[0].length + 2);\n\t\tvar dv = new DataView(array);\n\t\tfor (var i = nstr[0].length; i--;) {\n\t\t\tdv.setUint8(i, nstr[0][i]);\n\t\t}\n\t\tdv.setUint16(nstr[0].length, OldProtocol.misc.worldVerification, true);\n\t\tthis.ws.send(array);\n\t\treturn nstr[1];\n\t}\n\n\trequestChunk(x, y) {\n\t\tlet wb = OldProtocol.worldBorder;\n\t\tvar key = `${x},${y}`;\n\t\tif (x > wb || y > wb || x < ~wb || y < ~wb || this.chunksLoading[key]) {\n\t\t\treturn;\n\t\t}\n\t\tthis.chunksLoading[key] = true;\n\t\tthis.waitingForChunks++;\n\t\tvar array = new ArrayBuffer(8);\n\t\tvar dv = new DataView(array);\n\t\tdv.setInt32(0, x, true);\n\t\tdv.setInt32(4, y, true);\n\t\tthis.ws.send(array);\n\t}\n\n\tallChunksLoaded() {\n\t\treturn this.waitingForChunks === 0;\n\t}\n\n\tupdatePixel(x, y, rgb, undocb) {\n\t\tvar distx = Math.floor(x / OldProtocol.chunkSize) - Math.floor(this.lastSentX / (OldProtocol.chunkSize * 16)); distx *= distx;\n\t\tvar disty = Math.floor(y / OldProtocol.chunkSize) - Math.floor(this.lastSentY / (OldProtocol.chunkSize * 16)); disty *= disty;\n\t\tvar dist = Math.sqrt(distx + disty);\n\t\tif (this.isConnected() && (dist < 4 || player.rank == RANK.ADMIN) && this.placeBucket.canSpend(1)) {\n\t\t\tvar array = new ArrayBuffer(11);\n\t\t\tvar dv = new DataView(array);\n\t\t\tdv.setInt32(0,  x, true);\n\t\t\tdv.setInt32(4,  y, true);\n\t\t\tdv.setUint8(8, rgb[0]);\n\t\t\tdv.setUint8(9, rgb[1]);\n\t\t\tdv.setUint8(10, rgb[2]);\n\t\t\tthis.ws.send(array);\n\t\t\tthis.pendingEdits[`${x},${y}`] = setTimeout(undocb, 2000);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tsendUpdates() {\n\t\tvar worldx = mouse.worldX;\n\t\tvar worldy = mouse.worldY;\n\t\tvar lastx = this.lastSentX;\n\t\tvar lasty = this.lastSentY;\n\t\tif (this.isConnected() && shouldUpdate() || (worldx != lastx || worldy != lasty)) {\n\t\t\tvar selrgb = player.selectedColor;\n\t\t\tthis.lastSentX = worldx;\n\t\t\tthis.lastSentY = worldy;\n\t\t\t// Send mouse position\n\t\t\tvar array = new ArrayBuffer(12);\n\t\t\tvar dv = new DataView(array);\n\t\t\tdv.setInt32(0, worldx, true);\n\t\t\tdv.setInt32(4, worldy, true);\n\t\t\tdv.setUint8(8, selrgb[0]);\n\t\t\tdv.setUint8(9, selrgb[1]);\n\t\t\tdv.setUint8(10, selrgb[2]);\n\t\t\tvar tool = player.tool;\n\t\t\tvar toolId = tool !== null ? +OldProtocol.tools.id[tool.id] : 0;\n\t\t\tdv.setUint8(11, toolId);\n\t\t\tthis.ws.send(array);\n\t\t}\n\t}\n\n\tsendMessage(str) {\n\t\tif (str.length && this.id !== null) {\n\t\t\tif (player.rank == RANK.ADMIN || this.chatBucket.canSpend(1)) {\n\t\t\t\tthis.ws.send(str + OldProtocol.misc.chatVerification);\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\teventSys.emit(e.net.chat, \"Slow down! You're talking too fast!\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotectChunk(x, y, newState) {\n\t\tvar array = new ArrayBuffer(10);\n\t\tvar dv = new DataView(array);\n\t\tdv.setInt32(0, x, true);\n\t\tdv.setInt32(4, y, true);\n\t\tdv.setUint8(8, newState);\n\t\tthis.ws.send(array);\n\t\teventSys.emit(e.net.chunk.lock, x, y, newState, true);\n\t}\n\n\tsetChunk(x, y, data) {\n\t\tif (!(player.rank == RANK.ADMIN || (player.rank == RANK.MODERATOR && this.placeBucket.canSpend(1.25)))) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar buf = new Uint8Array(8 + OldProtocol.chunkSize * OldProtocol.chunkSize * 3);\n\t\tvar dv = new DataView(buf.buffer);\n\t\tdv.setInt32(0, x, true);\n\t\tdv.setInt32(4, y, true);\n\t\tfor (var i = 0, b = 8; i < data.length; i++, b += 3) {\n\t\t\tbuf[b] = data[i] & 0xFF;\n\t\t\tbuf[b + 1] = data[i] >> 8 & 0xFF;\n\t\t\tbuf[b + 2] = data[i] >> 16 & 0xFF;\n\t\t}\n\t\tthis.ws.send(buf.buffer);\n\t\treturn true;\n\t}\n\n\tclearChunk(x, y, rgb) {\n\t\tif (player.rank == RANK.ADMIN || (player.rank == RANK.MODERATOR && this.placeBucket.canSpend(1))) {\n\t\t\tvar array = new ArrayBuffer(13);\n\t\t\tvar dv = new DataView(array);\n\t\t\tdv.setInt32(0, x, true);\n\t\t\tdv.setInt32(4, y, true);\n\t\t\tdv.setUint8(8, rgb[0]);\n\t\t\tdv.setUint8(9, rgb[1]);\n\t\t\tdv.setUint8(10, rgb[2]);\n\t\t\tthis.ws.send(array);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n\nOldProtocol.class = OldProtocolImpl;\n","'use strict';\nimport { EVENTS as e, options } from './conf.js';\nimport { eventSys, PublicAPI } from './global.js';\n\nexport const cursors = {\n\tset: new Image(),\n\tcursor: {imgpos: [0, 0], hotspot: [0, 0]},\n\tmove: {imgpos: [1, 0], hotspot: [18, 18]},\n\tpipette: {imgpos: [0, 1], hotspot: [0, 28]},\n\terase: {imgpos: [0, 2], hotspot: [4, 26]},\n\tzoom: {imgpos: [1, 2], hotspot: [19, 10]},\n\tfill: {imgpos: [1, 1], hotspot: [3, 29]},\n\tbrush: {imgpos: [0, 3], hotspot: [0, 26]},\n\tselect: {imgpos: [2, 0], hotspot: [0, 0]}, // needs better hotspot\n\tselectprotect: {imgpos: [4, 0], hotspot: [0, 0]},\n\tcopy: {imgpos: [3, 0], hotspot: [0, 0]}, // and this\n\tpaste: {imgpos: [3, 1], hotspot: [0, 0]}, // this too\n\tcut: {imgpos: [3, 2], hotspot: [11, 5]},\n\twand: {imgpos: [3, 3], hotspot: [0, 0]},\n\tshield: {imgpos: [2, 3], hotspot: [18, 18]},\n\tkick: {imgpos: [2, 1], hotspot: [3, 6]},\n\tban: {imgpos: [2, 2], hotspot: [10, 4]},\n\twrite: {imgpos: [1, 3], hotspot: [10, 4]} // fix hotspot\n};\n\nPublicAPI.cursors = cursors;\n\nfunction reduce(canvas) { /* Removes unused space from the image */\n\tvar nw = canvas.width;\n\tvar nh = canvas.height;\n\tvar ctx = canvas.getContext('2d');\n\tvar idat = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\tvar u32dat = new Uint32Array(idat.data.buffer);\n\tvar xoff = 0;\n\tvar yoff = 0;\n\tfor(var y = 0, x, i = 0; y < idat.height; y++) {\n\t\tfor(x = idat.width; x--; i += u32dat[y * idat.width + x] >> 26);\n\t\tif(i) { break; }\n\t\tyoff++;\n\t\tnh--;\n\t}\n\tfor(var x = 0, y, i = 0; x < idat.width; x++) {\n\t\tfor(y = nh; y--; i += u32dat[y * idat.width + x] >> 26);\n\t\tif(i) { break; }\n\t\txoff++;\n\t\tnw--;\n\t}\n\tfor(var y = idat.height, x, i = 0; y--;) {\n\t\tfor(x = idat.width; x--; i += u32dat[y * idat.width + x] >> 26);\n\t\tif(i) { break; }\n\t\tnh--;\n\t}\n\tfor(var x = idat.width, y, i = 0; x--;) {\n\t\tfor(y = nh; y--; i += u32dat[y * idat.width + x] >> 26);\n\t\tif(i) { break; }\n\t\tnw--;\n\t}\n\tcanvas.width = nw;\n\tcanvas.height = nh;\n\tctx.putImageData(idat, -xoff, -yoff);\n}\n\nfunction shadow(canvas, img) {\n\t/* Make a bigger image so the shadow doesn't get cut */\n\tcanvas.width  = 2 + img.width + 6;\n\tcanvas.height = 2 + img.height + 6;\n\tvar ctx = canvas.getContext('2d');\n\tctx.shadowColor = '#000000';\n\tctx.globalAlpha = 0.5; /* The shadow is too dark so we draw it transparent */\n\tctx.shadowBlur  = 4;\n\tctx.shadowOffsetX = 2;\n\tctx.shadowOffsetY = 2;\n\tctx.drawImage(img, 2, 2);\n\tctx.globalAlpha = 1;\n\tctx.shadowColor = 'rgba(0, 0, 0, 0)'; /* disables the shadow */\n\tctx.drawImage(img, 2, 2);\n}\n\n/* makes a hole with the shape of the image */\nfunction popOut(canvas, img) {\n\tvar shadowcolor = 0xFF3B314D;\n\tvar backgroundcolor = 0xFF5C637E;\n\tcanvas.width = img.width;\n\tcanvas.height = img.height;\n\tvar ctx = canvas.getContext('2d');\n\tctx.drawImage(img, 0, 0);\n\tvar idat = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\tvar u32dat = new Uint32Array(idat.data.buffer);\n\tvar clr = function(x, y) {\n\t\treturn (x < 0 || y < 0 || x >= idat.width || y >= idat.height) ? 0\n\t\t\t: u32dat[y * idat.width + x];\n\t};\n\tfor(var i = u32dat.length; i--;) {\n\t\tif(u32dat[i] !== 0) {\n\t\t\tu32dat[i] = backgroundcolor;\n\t\t}\n\t}\n\tfor(var y = idat.height; y--;) {\n\t\tfor(var x = idat.width; x--;) {\n\t\t\tif(clr(x, y) === backgroundcolor && (!clr(x, y - 1) || !clr(x - 1, y)) && !clr(x - 1, y - 1)) {\n\t\t\t\tu32dat[y * idat.width + x] = shadowcolor;\n\t\t\t}\n\t\t}\n\t}\n\tfor(var y = idat.height; y--;) {\n\t\tfor(var x = idat.width; x--;) {\n\t\t\tif(clr(x, y - 1) === shadowcolor\n\t\t\t   && clr(x - 1, y) === shadowcolor) {\n\t\t\t\tu32dat[y * idat.width + x] = shadowcolor;\n\t\t\t}\n\t\t}\n\t}\n\tctx.putImageData(idat, 0, 0);\n}\n\nfunction load(oncomplete) {\n\tcursors.set.crossOrigin=\"anonymous\";\n\tcursors.set.onload = function() {\n\t\tvar set = cursors.set;\n\t\tvar slotcanvas = document.createElement('canvas');\n\t\tpopOut(slotcanvas, set);\n\t\tvar j = Object.keys(cursors).length - 1 + 1; /* +1 slotset to blob url */\n\t\tfor(var tool in cursors) {\n\t\t\tif (tool === 'set') { continue; }\n\t\t\ttool = cursors[tool];\n\t\t\tvar original = document.createElement('canvas');\n\t\t\tvar i = tool.img = {\n\t\t\t\tshadowed: document.createElement('canvas'),\n\t\t\t\tshadowblob: null\n\t\t\t};\n\t\t\toriginal.width = original.height = 36;\n\t\t\toriginal.getContext('2d').drawImage(set,\n\t\t\t\ttool.imgpos[0] * 36,\n\t\t\t\ttool.imgpos[1] * 36,\n\t\t\t\t36, 36,\n\t\t\t\t0, 0,\n\t\t\t\t36, 36\n\t\t\t);\n\t\t\treduce(original);\n\t\t\tshadow(i.shadowed, original);\n\t\t\ttool.hotspot[0] += 2;\n\t\t\ttool.hotspot[1] += 2; /* Check shadow() for explanation */\n\n\t\t\t/* Blob-ify images */\n\t\t\ti.shadowed.toBlob(function(blob) {\n\t\t\t\tthis.img.shadowblob = URL.createObjectURL(blob);\n\t\t\t\tif(!--j) oncomplete();\n\t\t\t}.bind(tool));\n\t\t}\n\t\tslotcanvas.toBlob(blob => {\n\t\t\tcursors.slotset = URL.createObjectURL(blob);\n\t\t\tif(!--j) oncomplete();\n\t\t});\n\t};\n\n\tcursors.set.src = options.toolSetUrl;\n}\n\neventSys.once(e.loaded, () => {\n\tload(() => eventSys.emit(e.misc.toolsRendered));\n});\n","'use strict';\nimport { PublicAPI, eventSys } from './global.js';\nimport { EVENTS as e, protocol, options, RANK } from './conf.js';\nimport { absMod, setTooltip, mkHTML, line } from './util/misc.js';\nimport { cursors } from './tool_renderer.js';\nimport { net } from './networking.js';\nimport { player } from './local_player.js';\nimport { camera, moveCameraTo, moveCameraBy, renderer, drawText } from './canvas_renderer.js';\nimport { windowSys, GUIWindow, UtilDialog } from './windowsys.js';\nimport { misc, elements, mouse, sounds, keysDown } from './main.js';\nimport { PLAYERFX } from './Fx.js';\n\nexport const tools = {};\nexport let toolsWindow = null;\nlet windowShown = false;\n\nexport function updateToolWindow(name) {\n\tif (!toolsWindow) {\n\t\treturn;\n\t}\n\tlet tool = tools[name];\n\tvar children = toolsWindow.container.children;\n\tfor (var i = 0; i < children.length; i++) {\n\t\tvar button = children[i];\n\t\tvar isSelected = button.id.split('-')[1] === name;\n\t\tbutton.className = isSelected ? 'selected' : '';\n\t\tbutton.children[0].style.backgroundImage = \"url(\" + (isSelected ? cursors.slotset : cursors.set.src) + \")\";\n\t}\n\telements.viewport.style.cursor = \"url(\" + tool.cursorblob + \") \" + tool.offset[0] + \" \" + tool.offset[1] + \", pointer\";\n}\n\nexport function updateToolbar(win = toolsWindow) {\n\tif (!win) {\n\t\treturn;\n\t}\n\n\tconst container = win.container;\n\tconst toolButtonClick = name => event => {\n\t\tplayer.tool = name;\n\t\tsounds.play(sounds.click);\n\t};\n\n\tcontainer.innerHTML = \"\";\n\n\t// Add tools to the tool-select menu\n\tfor (const name in tools) {\n\t\tvar tool = tools[name];\n\t\tif (player.rank >= tool.rankRequired) {\n\t\t\tvar element = document.createElement(\"button\");\n\t\t\tvar mask = document.createElement(\"div\");\n\t\t\tsetTooltip(element, tool.name + \" tool\");\n\t\t\telement.id = \"tool-\" + name;\n\t\t\telement.addEventListener(\"click\", toolButtonClick(name));\n\t\t\tif (tool === player.tool) {\n\t\t\t\tmask.style.backgroundImage = \"url(\" + cursors.slotset + \")\";\n\t\t\t\telement.className = \"selected\";\n\t\t\t} else {\n\t\t\t\tmask.style.backgroundImage = \"url(\" + cursors.set.src + \")\";\n\t\t\t}\n\t\t\tmask.style.backgroundPosition = tool.setposition;\n\t\t\telement.appendChild(mask);\n\t\t\tcontainer.appendChild(element);\n\t\t}\n\t}\n}\n\nexport function showToolsWindow(bool) {\n\tif (windowShown !== bool) {\n\t\tif (bool && toolsWindow) {\n\t\t\twindowSys.addWindow(toolsWindow);\n\t\t} else if (toolsWindow) {\n\t\t\twindowSys.delWindow(toolsWindow);\n\t\t}\n\t\twindowShown = bool;\n\t}\n}\n\nexport function addTool(tool) {\n\ttool.id = tool.name.toLowerCase();\n\ttools[tool.id] = tool;\n\tupdateToolbar();\n}\n\nclass Tool {\n\tconstructor(name, cursor, fxRenderer, rankNeeded, onInit) {\n\t\tthis.name = name;\n\t\tthis.id = null;\n\t\tthis.fxRenderer = fxRenderer;\n\t\tthis.cursorblob = cursor.img.shadowblob;\n\t\tthis.cursor = cursor.img.shadowed;\n\t\tthis.setposition = (-cursor.imgpos[0] * 36) + \"px \" + (-cursor.imgpos[1] * 36) + \"px\";\n\t\tthis.offset = cursor.hotspot;\n\t\tthis.rankRequired = rankNeeded;\n\t\tthis.extra = {}; /* Extra storage for tools */\n\t\tthis.events = {\n\t\t\tmouseup: null,\n\t\t\tmousedown: null,\n\t\t\tmousemove: null,\n\t\t\ttouchstart: null,\n\t\t\ttouchmove: null,\n\t\t\ttouchend: null,\n\t\t\ttouchcancel: null,\n\t\t\tselect: null,\n\t\t\tdeselect: null,\n\t\t\tkeydown: null,\n\t\t\tkeyup: null,\n\t\t\tscroll: null,\n\t\t\ttick: null\n\t\t};\n\t\tonInit(this);\n\t}\n\n\t/* Doesn't update if tool already selected */\n\tsetFxRenderer(func) {\n\t\tthis.fxRenderer = func;\n\t}\n\n\tisEventDefined(type) {\n\t\treturn type in this.events;\n\t}\n\n\tsetEvent(type, func) {\n\t\tvar events = type.split(' ');\n\t\tfor (var i = 0; i < events.length; i++) {\n\t\t\tthis.events[events[i]] = func || null;\n\t\t}\n\t}\n\n\tcall(type, data) {\n\t\tvar func = this.events[type];\n\t\tif (func) {\n\t\t\treturn func.apply(this, data);\n\t\t} else if (type.indexOf(\"touch\") === 0) {\n\t\t\treturn this.defaultTouchHandler(type.slice(5), data);\n\t\t}\n\t\treturn false;\n\t}\n\n\tdefaultTouchHandler(type, data) {\n\t\tvar mouse = data[0];\n\t\tvar event = data[1]; /* hmm... */\n\t\tvar handlers = {\n\t\t\tstart: this.events.mousedown,\n\t\t\tmove: this.events.mousemove,\n\t\t\tend: this.events.mouseup,\n\t\t\tcancel: this.events.mouseup\n\t\t};\n\t\tvar handler = handlers[type];\n\t\tif (handler) {\n\t\t\tvar touches = event.changedTouches;\n\t\t\tfor (var i = 0; i < touches.length; i++) {\n\t\t\t\tmouse.x = touches[i].pageX;\n\t\t\t\tmouse.y = touches[i].pageY;\n\t\t\t\thandler.apply(this, data);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport const toolsApi = PublicAPI.tools = {\n\tclass: Tool,\n\taddToolObject: addTool,\n\tupdateToolbar,\n\tallTools: tools\n};\n\neventSys.once(e.misc.toolsRendered, () => {\n\t// Cursor tool\n\taddTool(new Tool('Cursor', cursors.cursor, PLAYERFX.RECT_SELECT_ALIGNED(1), RANK.USER,\n\t\ttool => {\n\t\t\tvar lastX,\n\t\t\t\tlastY;\n\t\t\ttool.setEvent('mousedown mousemove', (mouse, event) => {\n\t\t\t\tvar usedButtons = 0b11; /* Left and right mouse buttons are always used... */\n\t\t\t\t/* White color if right clicking */\n\t\t\t\tvar color = mouse.buttons === 2 ? [255, 255, 255] : player.selectedColor;\n\t\t\t\tswitch (mouse.buttons) {\n\t\t\t\t\tcase 1:\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tif (!lastX || !lastY) {\n\t\t\t\t\t\t\tlastX = mouse.tileX;\n\t\t\t\t\t\t\tlastY = mouse.tileY;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tline(lastX, lastY, mouse.tileX, mouse.tileY, 1, (x, y) => {\n\t\t\t\t\t\t\tvar pixel = misc.world.getPixel(x, y);\n\t\t\t\t\t\t\tif (pixel !== null && !(color[0] === pixel[0] && color[1] === pixel[1] && color[2] === pixel[2])) {\n\t\t\t\t\t\t\t\tmisc.world.setPixel(x, y, color);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tlastX = mouse.tileX;\n\t\t\t\t\t\tlastY = mouse.tileY;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 4:\n\t\t\t\t\t\tif (event.ctrlKey) {\n\t\t\t\t\t\t\tusedButtons |= 0b100;\n\t\t\t\t\t\t\tvar color = misc.world.getPixel(mouse.tileX, mouse.tileY);\n\t\t\t\t\t\t\tif (color) {\n\t\t\t\t\t\t\t\tplayer.selectedColor = color;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\treturn usedButtons;\n\t\t\t});\n\t\t\ttool.setEvent('mouseup', mouse => {\n\t\t\t\tlastX = null;\n\t\t\t\tlastY = null;\n\t\t\t});\n\t\t}\n\t));\n\n\t// Move tool\n\taddTool(new Tool('Move', cursors.move, PLAYERFX.NONE, RANK.NONE,\n\t\ttool => {\n\t\t\tfunction move(x, y, startX, startY) {\n\t\t\t\tmoveCameraBy((startX - x) / 16, (startY - y) / 16);\n\t\t\t}\n\t\t\ttool.setEvent('mousemove', (mouse, event) => {\n\t\t\t\tif (mouse.buttons !== 0) {\n\t\t\t\t\tmove(mouse.worldX, mouse.worldY, mouse.mouseDownWorldX, mouse.mouseDownWorldY);\n\t\t\t\t\treturn mouse.buttons;\n\t\t\t\t}\n\t\t\t});\n\t\t\ttool.setEvent('scroll', (mouse, event, rawEvent) => {\n\t\t\t\tif (!rawEvent.ctrlKey) {\n\t\t\t\t\tvar dx = Math.max(-500, Math.min(event.spinX * 16, 500));\n\t\t\t\t\tvar dy = Math.max(-500, Math.min(event.spinY * 16, 500));\n\t\t\t\t\tvar pxAmount = camera.zoom//Math.max(camera.zoom, 2);\n\t\t\t\t\tmoveCameraBy(dx / pxAmount, dy / pxAmount);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t));\n\n\t// Pipette tool\n\taddTool(new Tool('Pipette', cursors.pipette, PLAYERFX.NONE, RANK.NONE,\n\t\ttool => {\n\t\t\ttool.setEvent('mousedown mousemove', (mouse, event) => {\n\t\t\t\tif (mouse.buttons !== 0 && !(mouse.buttons & 0b100)) {\n\t\t\t\t\tvar color = misc.world.getPixel(mouse.tileX, mouse.tileY);\n\t\t\t\t\tif (color) {\n\t\t\t\t\t\tplayer.selectedColor = color;\n\t\t\t\t\t}\n\t\t\t\t\treturn mouse.buttons;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t));\n\n\t// Erase/Fill tool\n\taddTool(new Tool('Eraser', cursors.erase, PLAYERFX.RECT_SELECT_ALIGNED(16), RANK.MODERATOR,\n\t\ttool => {\n\t\t\tfunction fillChunk(chunkX, chunkY, c) {\n\t\t\t\tconst color = c[2] << 16 | c[1] << 8 | c[0];\n\t\t\t\tvar chunk = misc.world.getChunkAt(chunkX, chunkY);\n\t\t\t\tif (chunk) {\n\t\t\t\t\tvar empty = true;\n\t\t\t\t\tfirstLoop: for (var y = 0; y < protocol.chunkSize; y++) {\n\t\t\t\t\t\tfor (var x = 0; x < protocol.chunkSize; x++) {\n\t\t\t\t\t\t\tif ((chunk.get(x, y) & 0xFFFFFF) != color) {\n\t\t\t\t\t\t\t\tempty = false;\n\t\t\t\t\t\t\t\tbreak firstLoop;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!empty) {\n\t\t\t\t\t\tif (net.protocol.clearChunk(chunkX, chunkY, c)) {\n\t\t\t\t\t\t\tchunk.set(color);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttool.setEvent('mousedown mousemove', (mouse, event) => {\n\t\t\t\tif (mouse.buttons & 0b1) {\n\t\t\t\t\tfillChunk(Math.floor(mouse.tileX / protocol.chunkSize), Math.floor(mouse.tileY / protocol.chunkSize), player.selectedColor);\n\t\t\t\t\treturn 1;\n\t\t\t\t} else if (mouse.buttons & 0b10) {\n\t\t\t\t\tfillChunk(Math.floor(mouse.tileX / protocol.chunkSize), Math.floor(mouse.tileY / protocol.chunkSize), [255, 255, 255]);\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t));\n\n\t// Zoom tool\n\taddTool(new Tool('Zoom', cursors.zoom, PLAYERFX.NONE, RANK.NONE,\n\t\ttool => {\n\t\t\tfunction zoom(mouse, type) {\n\t\t\t\tvar lzoom = camera.zoom;\n\t\t\t\tvar nzoom = camera.zoom;\n\t\t\t\tvar offX = 0;\n\t\t\t\tvar offY = 0;\n\t\t\t\tvar w = window.innerWidth;\n\t\t\t\tvar h = window.innerHeight;\n\t\t\t\tif (type === 1) {\n\t\t\t\t\t// Zoom in\n\t\t\t\t\tnzoom *= 1 + options.zoomStrength;\n\t\t\t\t\toffX = (mouse.x - w / 2) / nzoom;\n\t\t\t\t\toffY = (mouse.y - h / 2) / nzoom;\n\t\t\t\t} else if (type === 2) {\n\t\t\t\t\t// Zoom out\n\t\t\t\t\tnzoom /= 1 + options.zoomStrength;\n\t\t\t\t\toffX = (mouse.x - w / 2) * (3 / lzoom - 2 / nzoom);\n\t\t\t\t\toffY = (mouse.y - h / 2) * (3 / lzoom - 2 / nzoom);\n\t\t\t\t} else if (type === 3) {\n\t\t\t\t\t// Reset zoom (right + left click)\n\t\t\t\t\tnzoom = options.defaultZoom;\n\t\t\t\t}\n\t\t\t\tnzoom = Math.round(nzoom);\n\t\t\t\tcamera.zoom = nzoom;\n\t\t\t\tif (camera.zoom !== lzoom) {\n\t\t\t\t\tmoveCameraBy(offX, offY);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttool.setEvent(\"mousedown\", (mouse, event) => {\n\t\t\t\tzoom(mouse, mouse.buttons);\n\t\t\t});\n\t\t\ttool.setEvent(\"touchstart\", (mouse, event) => {\n\t\t\t\ttool.extra.maxTouches = Math.max(tool.extra.maxTouches || 0, event.touches.length);\n\t\t\t});\n\t\t\ttool.setEvent(\"touchend\", (mouse, event) => {\n\t\t\t\tif (event.touches.length === 0) {\n\t\t\t\t\tif (tool.extra.maxTouches > 1) {\n\t\t\t\t\t\tzoom(mouse, tool.extra.maxTouches);\n\t\t\t\t\t}\n\t\t\t\t\ttool.extra.maxTouches = 0;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t));\n\n\t// Area to PNG tool\n\taddTool(new Tool('Export', cursors.select, PLAYERFX.NONE, RANK.NONE,\n\t\ttool => {\n\t\t\ttool.setFxRenderer((fx, ctx, time) => {\n\t\t\t\tif (!fx.extra.isLocalPlayer) return 1;\n\t\t\t\tvar x = fx.extra.player.x;\n\t\t\t\tvar y = fx.extra.player.y;\n\t\t\t\tvar fxx = (Math.floor(x / 16) - camera.x) * camera.zoom;\n\t\t\t\tvar fxy = (Math.floor(y / 16) - camera.y) * camera.zoom;\n\t\t\t\tvar oldlinew = ctx.lineWidth;\n\t\t\t\tctx.lineWidth = 1;\n\t\t\t\tif (tool.extra.end) {\n\t\t\t\t\tvar s = tool.extra.start;\n\t\t\t\t\tvar e = tool.extra.end;\n\t\t\t\t\tvar x = (s[0] - camera.x) * camera.zoom + 0.5;\n\t\t\t\t\tvar y = (s[1] - camera.y) * camera.zoom + 0.5;\n\t\t\t\t\tvar w = e[0] - s[0];\n\t\t\t\t\tvar h = e[1] - s[1];\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.rect(x, y, w * camera.zoom, h * camera.zoom);\n\t\t\t\t\tctx.globalAlpha = 1;\n\t\t\t\t\tctx.strokeStyle = \"#FFFFFF\";\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\tctx.setLineDash([3, 4]);\n\t\t\t\t\tctx.strokeStyle = \"#000000\";\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\tctx.globalAlpha = 0.25 + Math.sin(time / 500) / 4;\n\t\t\t\t\tctx.fillStyle = renderer.patterns.unloaded;\n\t\t\t\t\tctx.fill();\n\t\t\t\t\tctx.setLineDash([]);\n\t\t\t\t\tvar oldfont = ctx.font;\n\t\t\t\t\tctx.font = \"16px sans-serif\";\n\t\t\t\t\tvar txt = `${!tool.extra.clicking ? \"Right click to screenshot \" : \"\"}(${Math.abs(w)}x${Math.abs(h)})`;\n\t\t\t\t\tvar txtx = window.innerWidth >> 1;\n\t\t\t\t\tvar txty = window.innerHeight >> 1;\n\t\t\t\t\ttxtx = Math.max(x, Math.min(txtx, x + w * camera.zoom));\n\t\t\t\t\ttxty = Math.max(y, Math.min(txty, y + h * camera.zoom));\n\n\t\t\t\t\tdrawText(ctx, txt, txtx, txty, true);\n\t\t\t\t\tctx.font = oldfont;\n\t\t\t\t\tctx.lineWidth = oldlinew;\n\t\t\t\t\treturn 0;\n\t\t\t\t} else {\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.moveTo(0, fxy + 0.5);\n\t\t\t\t\tctx.lineTo(window.innerWidth, fxy + 0.5);\n\t\t\t\t\tctx.moveTo(fxx + 0.5, 0);\n\t\t\t\t\tctx.lineTo(fxx + 0.5, window.innerHeight);\n\n\t\t\t\t\t//ctx.lineWidth = 1;\n\t\t\t\t\tctx.globalAlpha = 1;\n\t\t\t\t\tctx.strokeStyle = \"#FFFFFF\";\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\tctx.setLineDash([3]);\n\t\t\t\t\tctx.strokeStyle = \"#000000\";\n\t\t\t\t\tctx.stroke();\n\n\t\t\t\t\tctx.setLineDash([]);\n\t\t\t\t\tctx.lineWidth = oldlinew;\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfunction dlarea(x, y, w, h, onblob){\n\t\t\t\tvar c = document.createElement('canvas');\n\t\t\t\tc.width = w;\n\t\t\t\tc.height = h;\n\t\t\t\tvar ctx = c.getContext('2d');\n\t\t\t\tvar d = ctx.createImageData(w, h);\n\t\t\t\tfor(var i = y; i < y + h; i++){\n\t\t\t\t  for(var j = x; j < x + w; j++){\n\t\t\t\t\tvar pix = misc.world.getPixel(j, i);\n\t\t\t\t\tif (!pix) continue;\n\t\t\t\t\td.data[4*((i - y)*w + (j - x))] = pix[0];\n\t\t\t\t\td.data[4*((i - y)*w + (j - x)) + 1] = pix[1];\n\t\t\t\t\td.data[4*((i - y)*w + (j - x)) + 2] = pix[2];\n\t\t\t\t\td.data[4*((i - y)*w + (j - x)) + 3] = 255;\n\t\t\t\t  }\n\t\t\t\t}\n\t\t\t\tctx.putImageData(d, 0, 0);\n\t\t\t\tc.toBlob(onblob);\n\t\t\t  }\n\n\t\t\ttool.extra.start = null;\n\t\t\ttool.extra.end = null;\n\t\t\ttool.extra.clicking = false;\n\n\t\t\ttool.setEvent('mousedown', (mouse, event) => {\n\t\t\t\tvar s = tool.extra.start;\n\t\t\t\tvar e = tool.extra.end;\n\t\t\t\tconst isInside = () => mouse.tileX >= s[0] && mouse.tileX < e[0] && mouse.tileY >= s[1] && mouse.tileY < e[1];\n\t\t\t\tif (mouse.buttons === 1 && !tool.extra.end) {\n\t\t\t\t\ttool.extra.start = [mouse.tileX, mouse.tileY];\n\t\t\t\t\ttool.extra.clicking = true;\n\t\t\t\t\ttool.setEvent('mousemove', (mouse, event) => {\n\t\t\t\t\t\tif (tool.extra.start && mouse.buttons === 1) {\n\t\t\t\t\t\t\ttool.extra.end = [mouse.tileX, mouse.tileY];\n\t\t\t\t\t\t\treturn 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tconst finish = () => {\n\t\t\t\t\t\ttool.setEvent('mousemove mouseup deselect', null);\n\t\t\t\t\t\ttool.extra.clicking = false;\n\t\t\t\t\t\tvar s = tool.extra.start;\n\t\t\t\t\t\tvar e = tool.extra.end;\n\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\tif (s[0] === e[0] || s[1] === e[1]) {\n\t\t\t\t\t\t\t\ttool.extra.start = null;\n\t\t\t\t\t\t\t\ttool.extra.end = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (s[0] > e[0]) {\n\t\t\t\t\t\t\t\tvar tmp = e[0];\n\t\t\t\t\t\t\t\te[0] = s[0];\n\t\t\t\t\t\t\t\ts[0] = tmp;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (s[1] > e[1]) {\n\t\t\t\t\t\t\t\tvar tmp = e[1];\n\t\t\t\t\t\t\t\te[1] = s[1];\n\t\t\t\t\t\t\t\ts[1] = tmp;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\trenderer.render(renderer.rendertype.FX);\n\t\t\t\t\t};\n\t\t\t\t\ttool.setEvent('deselect', finish);\n\t\t\t\t\ttool.setEvent('mouseup', (mouse, event) => {\n\t\t\t\t\t\tif (!(mouse.buttons & 1)) {\n\t\t\t\t\t\t\tfinish();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else if (mouse.buttons === 1 && tool.extra.end) {\n\t\t\t\t\tif (isInside()) {\n\t\t\t\t\t\tvar offx = mouse.tileX;\n\t\t\t\t\t\tvar offy = mouse.tileY;\n\t\t\t\t\t\ttool.setEvent('mousemove', (mouse, event) => {\n\t\t\t\t\t\t\tvar dx = mouse.tileX - offx;\n\t\t\t\t\t\t\tvar dy = mouse.tileY - offy;\n\t\t\t\t\t\t\ttool.extra.start = [s[0] + dx, s[1] + dy];\n\t\t\t\t\t\t\ttool.extra.end = [e[0] + dx, e[1] + dy];\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconst end = () => {\n\t\t\t\t\t\t\ttool.setEvent('mouseup deselect mousemove', null);\n\t\t\t\t\t\t};\n\t\t\t\t\t\ttool.setEvent('deselect', end);\n\t\t\t\t\t\ttool.setEvent('mouseup', (mouse, event) => {\n\t\t\t\t\t\t\tif (!(mouse.buttons & 1)) {\n\t\t\t\t\t\t\t\tend();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttool.extra.start = null;\n\t\t\t\t\t\ttool.extra.end = null;\n\t\t\t\t\t}\n\t\t\t\t} else if (mouse.buttons === 2 && tool.extra.end && isInside()) {\n\t\t\t\t\ttool.extra.start = null;\n\t\t\t\t\ttool.extra.end = null;\n\t\t\t\t\tvar cvs = dlarea(s[0], s[1], e[0] - s[0], e[1] - s[1], b => {\n\t\t\t\t\t\tvar url = URL.createObjectURL(b);\n\t\t\t\t\t\tvar img = new Image();\n\t\t\t\t\t\timg.onload = () => {\n\t\t\t\t\t\t\twindowSys.addWindow(new GUIWindow(\"Resulting image\", {\n\t\t\t\t\t\t\t\tcenterOnce: true,\n\t\t\t\t\t\t\t\tcloseable: true\n\t\t\t\t\t\t\t}, function(win) {\n\t\t\t\t\t\t\t\tvar props = ['width', 'height'];\n\t\t\t\t\t\t\t\tif (img.width > img.height) {\n\t\t\t\t\t\t\t\t\tprops.reverse();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvar r = img[props[0]] / img[props[1]];\n\t\t\t\t\t\t\t\tvar shownSize = img[props[1]] >= 128 ? 256 : 128;\n\t\t\t\t\t\t\t\timg[props[0]] = r * shownSize;\n\t\t\t\t\t\t\t\timg[props[1]] = shownSize;\n\t\t\t\t\t\t\t\twin.container.classList.add('centeredChilds')\n\t\t\t\t\t\t\t\tvar image = win.addObj(img);\n\t\t\t\t\t\t\t\tsetTooltip(img, \"Right click to copy/save!\");\n\t\t\t\t\t\t\t\t/*var okButton = win.addObj(mkHTML(\"button\", {\n\t\t\t\t\t\t\t\t\tinnerHTML: \"OK\",\n\t\t\t\t\t\t\t\t\tstyle: \"display: block; width: 80px; height: 30px; margin: auto;\",\n\t\t\t\t\t\t\t\t\tonclick: function() {\n\t\t\t\t\t\t\t\t\t\timg.remove();\n\t\t\t\t\t\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t\t\t\t\t\t\twin.getWindow().close();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}));*/\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t};\n\t\t\t\t\t\timg.src = url;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t));\n\n\t// Fill tool\n\taddTool(new Tool('Fill', cursors.fill, PLAYERFX.NONE, RANK.USER, tool => {\n\t\ttool.extra.tickAmount = 9;\n\t\tvar queue = [];\n\t\tvar fillingColor = null;\n\t\tvar defaultFx = PLAYERFX.RECT_SELECT_ALIGNED(1);\n\t\ttool.setFxRenderer((fx, ctx, time) => {\n\t\t\tctx.globalAlpha = 0.8;\n\t\t\tctx.strokeStyle = fx.extra.player.htmlRgb;\n\t\t\tvar z = camera.zoom;\n\t\t\tif (!fillingColor || !fx.extra.isLocalPlayer) {\n\t\t\t\tdefaultFx(fx, ctx, time);\n\t\t\t} else {\n\t\t\t\tctx.beginPath();\n\t\t\t\tfor (var i = 0; i < queue.length; i++) {\n\t\t\t\t\tctx.rect((queue[i][0] - camera.x) * z, (queue[i][1] - camera.y) * z, z, z);\n\t\t\t\t}\n\t\t\t\tctx.stroke();\n\t\t\t}\n\t\t});\n\t\tfunction tick() {\n\t\t\tconst eq = (a, b) => a && b && a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n\t\t\tconst check = (x, y) => {\n\t\t\t\tif (eq(misc.world.getPixel(x, y), fillingColor)) {\n\t\t\t\t\tqueue.unshift([x, y]);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tif (!queue.length || !fillingColor) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar selClr = player.selectedColor;\n\t\t\tvar painted = 0;\n\t\t\tvar tickAmount = tool.extra.tickAmount;\n\t\t\tif (keysDown[17]) { /* Ctrl */\n\t\t\t\ttickAmount *= 3;\n\t\t\t}\n\n\t\t\tfor (var painted = 0; painted < tickAmount && queue.length; painted++) {\n\t\t\t\tvar current = queue.pop();\n\t\t\t\tvar x = current[0];\n\t\t\t\tvar y = current[1];\n\t\t\t\tvar thisClr = misc.world.getPixel(x, y);\n\t\t\t\tif (eq(thisClr, fillingColor) && !eq(thisClr, selClr)) {\n\t\t\t\t\tif (!misc.world.setPixel(x, y, selClr)) {\n\t\t\t\t\t\tqueue.push(current);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// diamond check first\n\t\t\t\t\tvar top = check(x, y - 1);\n\t\t\t\t\tvar bottom = check(x, y + 1);\n\t\t\t\t\tvar left = check(x - 1, y);\n\t\t\t\t\tvar right = check(x + 1, y);\n\n\t\t\t\t\t// if corners are not closed by parts of the diamond, then they can be accessed\n\t\t\t\t\tif (top && left) {\n\t\t\t\t\t\tcheck(x - 1, y - 1);\n\t\t\t\t\t}\n\t\t\t\t\tif (top && right) {\n\t\t\t\t\t\tcheck(x + 1, y - 1);\n\t\t\t\t\t}\n\t\t\t\t\tif (bottom && left) {\n\t\t\t\t\t\tcheck(x - 1, y + 1);\n\t\t\t\t\t}\n\t\t\t\t\tif (bottom && right) {\n\t\t\t\t\t\tcheck(x + 1, y + 1);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Shape diamond, infra not like\n\t\t\t\t\t/*check(x    , y - 1);\n\t\t\t\t\tcheck(x - 1, y    );\n\t\t\t\t\tcheck(x + 1, y    );\n\t\t\t\t\tcheck(x    , y + 1);*/\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\ttool.setEvent('mousedown', mouse => {\n\t\t\tif (!(mouse.buttons & 0b100)) {\n\t\t\t\tfillingColor = misc.world.getPixel(mouse.tileX, mouse.tileY);\n\t\t\t\tif (fillingColor) {\n\t\t\t\t\tqueue.push([mouse.tileX, mouse.tileY]);\n\t\t\t\t\ttool.setEvent('tick', tick);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\ttool.setEvent('mouseup deselect', mouse => {\n\t\t\tif (!mouse || !(mouse.buttons & 0b1)) {\n\t\t\t\tfillingColor = null;\n\t\t\t\tqueue = [];\n\t\t\t\ttool.setEvent('tick', null);\n\t\t\t}\n\t\t});\n\t}));\n\n\taddTool(new Tool('Line', cursors.wand, PLAYERFX.NONE, RANK.USER, tool => {\n\t\tvar start = null;\n\t\tvar end = null;\n\t\tvar queue = [];\n\t\tfunction line(x1, y1, x2, y2, plot) {\n\t\t\tvar dx =  Math.abs(x2 - x1), sx = x1 < x2 ? 1 : -1;\n\t\t\tvar dy = -Math.abs(y2 - y1), sy = y1 < y2 ? 1 : -1;\n\t\t\tvar err = dx + dy,\n\t\t\t\te2;\n\n\t\t\twhile(true) {\n\t\t\t\tplot(x1, y1);\n\t\t\t\tif (x1 == x2 && y1 == y2) break;\n\t\t\t\te2 = 2 * err;\n\t\t\t\tif (e2 >= dy) { err += dy; x1 += sx; }\n\t\t\t\tif (e2 <= dx) { err += dx; y1 += sy; }\n\t\t\t}\n\t\t}\n\t\tvar defaultFx = PLAYERFX.RECT_SELECT_ALIGNED(1);\n\t\ttool.setFxRenderer((fx, ctx, time) => {\n\t\t\tctx.globalAlpha = 0.8;\n\t\t\tctx.strokeStyle = fx.extra.player.htmlRgb;\n\t\t\tvar z = camera.zoom;\n\t\t\tif (!start || !end || !fx.extra.isLocalPlayer) {\n\t\t\t\tdefaultFx(fx, ctx, time);\n\t\t\t} else {\n\t\t\t\tctx.beginPath();\n\t\t\t\tline(start[0], start[1], end[0], end[1], (x, y) => {\n\t\t\t\t\tctx.rect((x - camera.x) * camera.zoom, (y - camera.y) * camera.zoom, camera.zoom, camera.zoom);\n\t\t\t\t});\n\t\t\t\tctx.stroke();\n\t\t\t}\n\t\t});\n\t\tfunction tick() {\n\t\t\tfor (var painted = 0; painted < 3 && queue.length; painted++) {\n\t\t\t\tvar current = queue.pop();\n\t\t\t\tvar c = misc.world.getPixel(current[0], current[1]);\n\t\t\t\tvar pc = player.selectedColor;\n\t\t\t\tif ((c[0] != pc[0] || c[1] != pc[1] || c[2] != pc[2]) && !misc.world.setPixel(current[0], current[1], player.selectedColor)) {\n\t\t\t\t\tqueue.push(current);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!queue.length) {\n\t\t\t\tstart = null;\n\t\t\t\tend = null;\n\t\t\t\ttool.setEvent('tick', null);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\ttool.setEvent('mousedown', mouse => {\n\t\t\tif (!(mouse.buttons & 0b100)) {\n\t\t\t\tqueue = [];\n\t\t\t\ttool.setEvent('tick', null);\n\t\t\t\tstart = [mouse.tileX, mouse.tileY];\n\t\t\t\tend = [mouse.tileX, mouse.tileY];\n\t\t\t}\n\t\t});\n\t\ttool.setEvent('mousemove', mouse => {\n\t\t\tif (!queue.length) {\n\t\t\t\tend = [mouse.tileX, mouse.tileY];\n\t\t\t}\n\t\t});\n\t\ttool.setEvent('mouseup', mouse => {\n\t\t\tif (!(mouse.buttons & 0b11) && !queue.length) {\n\t\t\t\tend = [mouse.tileX, mouse.tileY];\n\t\t\t\tif (!start) {\n\t\t\t\t\tend = null;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (player.rank == RANK.ADMIN) {\n\t\t\t\t\tline(start[0], start[1], end[0], end[1], (x, y) => {\n\t\t\t\t\t\tmisc.world.setPixel(x, y, player.selectedColor);\n\t\t\t\t\t});\n\t\t\t\t\tstart = null;\n\t\t\t\t\tend = null;\n\t\t\t\t} else {\n\t\t\t\t\tline(start[0], start[1], end[0], end[1], (x, y) => {\n\t\t\t\t\t\tqueue.push([x, y]);\n\t\t\t\t\t});\n\t\t\t\t\ttool.setEvent('tick', tick);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\ttool.setEvent('deselect', mouse => {\n\t\t\tqueue = [];\n\t\t\tstart = null;\n\t\t\tend = null;\n\t\t\ttool.setEvent('tick', null);\n\t\t});\n\t}));\n\n\taddTool(new Tool('Protect', cursors.shield, PLAYERFX.RECT_SELECT_ALIGNED(16, \"#000000\"), RANK.MODERATOR, tool => {\n\t\ttool.setFxRenderer((fx, ctx, time) => {\n\t\t\tvar x = fx.extra.player.x;\n\t\t\tvar y = fx.extra.player.y;\n\t\t\tvar fxx = (Math.floor(x / 256) * 16 - camera.x) * camera.zoom;\n\t\t\tvar fxy = (Math.floor(y / 256) * 16 - camera.y) * camera.zoom;\n\t\t\tctx.globalAlpha = 0.5;\n\t\t\tvar chunkX = Math.floor(fx.extra.player.tileX / protocol.chunkSize);\n\t\t\tvar chunkY = Math.floor(fx.extra.player.tileY / protocol.chunkSize);\n\t\t\tvar chunk = misc.world.getChunkAt(chunkX, chunkY);\n\t\t\tif (chunk) {\n\t\t\t\tctx.fillStyle = chunk.locked ? \"#00FF00\" : \"#FF0000\";\n\t\t\t\tctx.fillRect(fxx, fxy, camera.zoom * 16, camera.zoom * 16);\n\t\t\t}\n\t\t\treturn 1; /* Rendering finished (won't change on next frame) */\n\t\t});\n\t\ttool.setEvent('mousedown mousemove', mouse => {\n\t\t\tvar chunkX = Math.floor(mouse.tileX / protocol.chunkSize);\n\t\t\tvar chunkY = Math.floor(mouse.tileY / protocol.chunkSize);\n\t\t\tvar chunk = misc.world.getChunkAt(chunkX, chunkY);\n\t\t\tswitch (mouse.buttons) {\n\t\t\t\tcase 0b1:\n\t\t\t\t\tif (!chunk.locked) {\n\t\t\t\t\t\tnet.protocol.protectChunk(chunkX, chunkY, 1);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 0b10:\n\t\t\t\t\tif (chunk.locked) {\n\t\t\t\t\t\tnet.protocol.protectChunk(chunkX, chunkY, 0);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t}));\n\n\taddTool(new Tool('Area Protect', cursors.selectprotect, PLAYERFX.NONE, RANK.MODERATOR,\n\t\ttool => {\n\t\t\ttool.setFxRenderer((fx, ctx, time) => {\n\t\t\t\tif (!fx.extra.isLocalPlayer) return 1;\n\t\t\t\tvar x = fx.extra.player.x;\n\t\t\t\tvar y = fx.extra.player.y;\n\t\t\t\tvar fxx = (Math.round(x / 256) * protocol.chunkSize - camera.x) * camera.zoom;\n\t\t\t\tvar fxy = (Math.round(y / 256) * protocol.chunkSize - camera.y) * camera.zoom;\n\t\t\t\tvar oldlinew = ctx.lineWidth;\n\t\t\t\tctx.lineWidth = 1;\n\t\t\t\tif (tool.extra.end) {\n\t\t\t\t\tvar s = tool.extra.start;\n\t\t\t\t\tvar e = tool.extra.end;\n\t\t\t\t\tvar x = (s[0] * protocol.chunkSize - camera.x) * camera.zoom + 0.5;\n\t\t\t\t\tvar y = (s[1] * protocol.chunkSize - camera.y) * camera.zoom + 0.5;\n\t\t\t\t\tvar rw = (e[0] - s[0]);\n\t\t\t\t\tvar rh = (e[1] - s[1]);\n\t\t\t\t\tvar w = rw * camera.zoom * protocol.chunkSize;\n\t\t\t\t\tvar h = rh * camera.zoom * protocol.chunkSize;\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.rect(x, y, w, h);\n\t\t\t\t\tctx.globalAlpha = 1;\n\t\t\t\t\tctx.strokeStyle = \"#FFFFFF\";\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\tctx.setLineDash([3, 4]);\n\t\t\t\t\tctx.strokeStyle = \"#000000\";\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\tif (tool.extra.isSure) {\n\t\t\t\t\t\tctx.globalAlpha = 0.6;\n\t\t\t\t\t\tctx.fillStyle = \"#00EE00\";\n\t\t\t\t\t\tctx.fill();\n\t\t\t\t\t}\n\t\t\t\t\tctx.globalAlpha = 0.25 + Math.sin(time / 500) / 4;\n\t\t\t\t\tctx.fillStyle = renderer.patterns.unloaded;\n\t\t\t\t\tctx.fill();\n\t\t\t\t\tctx.setLineDash([]);\n\t\t\t\t\tvar oldfont = ctx.font;\n\t\t\t\t\tctx.font = \"16px sans-serif\";\n\t\t\t\t\tvar txt = `${tool.extra.isSure ? \"Click again to confirm. \" : (!tool.extra.clicking ? \"Left/Right click to add/remove protection, respectively. \" : \"\")}(${Math.abs(rw)}x${Math.abs(rh)})`;\n\t\t\t\t\tvar txtx = window.innerWidth >> 1;\n\t\t\t\t\tvar txty = window.innerHeight >> 1;\n\t\t\t\t\ttxtx = Math.max(x, Math.min(txtx, x + w));\n\t\t\t\t\ttxty = Math.max(y, Math.min(txty, y + h));\n\n\t\t\t\t\tdrawText(ctx, txt, txtx, txty, true);\n\t\t\t\t\tctx.font = oldfont;\n\t\t\t\t\tctx.lineWidth = oldlinew;\n\t\t\t\t\treturn 0;\n\t\t\t\t} else {\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.moveTo(0, fxy + 0.5);\n\t\t\t\t\tctx.lineTo(window.innerWidth, fxy + 0.5);\n\t\t\t\t\tctx.moveTo(fxx + 0.5, 0);\n\t\t\t\t\tctx.lineTo(fxx + 0.5, window.innerHeight);\n\n\t\t\t\t\t//ctx.lineWidth = 1;\n\t\t\t\t\tctx.globalAlpha = 1;\n\t\t\t\t\tctx.strokeStyle = \"#FFFFFF\";\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\tctx.setLineDash([3]);\n\t\t\t\t\tctx.strokeStyle = \"#000000\";\n\t\t\t\t\tctx.stroke();\n\n\t\t\t\t\tctx.setLineDash([]);\n\t\t\t\t\tctx.lineWidth = oldlinew;\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttool.extra.start = null;\n\t\t\ttool.extra.end = null;\n\t\t\ttool.extra.clicking = false;\n\t\t\ttool.extra.isSure = false;\n\n\t\t\tvar timeout = null;\n\n\t\t\tconst sure = () => {\n\t\t\t\tif (tool.extra.isSure) {\n\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\ttimeout = null;\n\t\t\t\t\ttool.extra.isSure = false;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\ttool.extra.isSure = true;\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\ttool.extra.isSure = false;\n\t\t\t\t\ttimeout = null;\n\t\t\t\t}, 1000);\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\ttool.setEvent('mousedown', (mouse, event) => {\n\t\t\t\tvar get = {\n\t\t\t\t\trx() { return mouse.tileX / protocol.chunkSize; },\n\t\t\t\t\try() { return mouse.tileY / protocol.chunkSize },\n\t\t\t\t\tx() { return Math.round(mouse.tileX / protocol.chunkSize); },\n\t\t\t\t\ty() { return Math.round(mouse.tileY / protocol.chunkSize); }\n\t\t\t\t};\n\t\t\t\tvar s = tool.extra.start;\n\t\t\t\tvar e = tool.extra.end;\n\t\t\t\tconst isInside = () => get.rx() >= s[0] && get.rx() < e[0] && get.ry() >= s[1] && get.ry() < e[1];\n\t\t\t\tconst isChunkSolid = chunk => {\n\t\t\t\t\tvar lastClr = chunk.get(0, 0);\n\t\t\t\t\treturn chunk.forEach((x, y, clr) => clr === lastClr);\n\t\t\t\t};\n\n\t\t\t\tif (mouse.buttons === 1 && !tool.extra.end) {\n\t\t\t\t\ttool.extra.start = [get.x(), get.y()];\n\t\t\t\t\ttool.extra.clicking = true;\n\t\t\t\t\ttool.setEvent('mousemove', (mouse, event) => {\n\t\t\t\t\t\tif (tool.extra.start && mouse.buttons === 1) {\n\t\t\t\t\t\t\ttool.extra.end = [get.x(), get.y()];\n\t\t\t\t\t\t\treturn 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tconst finish = () => {\n\t\t\t\t\t\ttool.setEvent('mousemove mouseup deselect', null);\n\t\t\t\t\t\ttool.extra.clicking = false;\n\t\t\t\t\t\tvar s = tool.extra.start;\n\t\t\t\t\t\tvar e = tool.extra.end;\n\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\tif (s[0] === e[0] || s[1] === e[1]) {\n\t\t\t\t\t\t\t\ttool.extra.start = null;\n\t\t\t\t\t\t\t\ttool.extra.end = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (s[0] > e[0]) {\n\t\t\t\t\t\t\t\tvar tmp = e[0];\n\t\t\t\t\t\t\t\te[0] = s[0];\n\t\t\t\t\t\t\t\ts[0] = tmp;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (s[1] > e[1]) {\n\t\t\t\t\t\t\t\tvar tmp = e[1];\n\t\t\t\t\t\t\t\te[1] = s[1];\n\t\t\t\t\t\t\t\ts[1] = tmp;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\trenderer.render(renderer.rendertype.FX);\n\t\t\t\t\t};\n\t\t\t\t\ttool.setEvent('deselect', finish);\n\t\t\t\t\ttool.setEvent('mouseup', (mouse, event) => {\n\t\t\t\t\t\tif (!(mouse.buttons & 1)) {\n\t\t\t\t\t\t\tfinish();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else if (mouse.buttons === 1 && tool.extra.end) {\n\t\t\t\t\tif (isInside() && sure()) {\n\t\t\t\t\t\ttool.extra.start = null;\n\t\t\t\t\t\ttool.extra.end = null;\n\t\t\t\t\t\tvar [x, y, w, h] = [s[0], s[1], e[0] - s[0], e[1] - s[1]];\n\t\t\t\t\t\tfor (var i = x; i < x + w; i++) {\n\t\t\t\t\t\t\tfor (var j = y; j < y + h; j++) {\n\t\t\t\t\t\t\t\tvar chunk = misc.world.getChunkAt(i, j);\n\t\t\t\t\t\t\t\tif (chunk && !chunk.locked) {\n\t\t\t\t\t\t\t\t\tif (keysDown[17] && isChunkSolid(chunk)) {\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tnet.protocol.protectChunk(i, j, 1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (!isInside()) {\n\t\t\t\t\t\ttool.extra.start = null;\n\t\t\t\t\t\ttool.extra.end = null;\n\t\t\t\t\t}\n\t\t\t\t} else if (mouse.buttons === 2 && tool.extra.end && isInside() && sure()) {\n\t\t\t\t\ttool.extra.start = null;\n\t\t\t\t\ttool.extra.end = null;\n\t\t\t\t\tvar [x, y, w, h] = [s[0], s[1], e[0] - s[0], e[1] - s[1]];\n\t\t\t\t\tfor (var i = x; i < x + w; i++) {\n\t\t\t\t\t\tfor (var j = y; j < y + h; j++) {\n\t\t\t\t\t\t\tvar chunk = misc.world.getChunkAt(i, j);\n\t\t\t\t\t\t\tif (chunk && chunk.locked) {\n\t\t\t\t\t\t\t\tif (keysDown[17] && !isChunkSolid(chunk)) {\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tnet.protocol.protectChunk(i, j, 0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t));\n\n\t/*addTool(new Tool('Area Delete', cursors.selectprotect, PLAYERFX.NONE, RANK.MODERATOR,\n\t\ttool => {\n\t\t\ttool.setFxRenderer((fx, ctx, time) => {\n\t\t\t\tif (!fx.extra.isLocalPlayer) return 1;\n\t\t\t\tvar x = fx.extra.player.x;\n\t\t\t\tvar y = fx.extra.player.y;\n\t\t\t\tvar fxx = (Math.round(x / 256) * protocol.chunkSize - camera.x) * camera.zoom;\n\t\t\t\tvar fxy = (Math.round(y / 256) * protocol.chunkSize - camera.y) * camera.zoom;\n\t\t\t\tvar oldlinew = ctx.lineWidth;\n\t\t\t\tctx.lineWidth = 1;\n\t\t\t\tif (tool.extra.end) {\n\t\t\t\t\tvar s = tool.extra.start;\n\t\t\t\t\tvar e = tool.extra.end;\n\t\t\t\t\tvar x = (s[0] * protocol.chunkSize - camera.x) * camera.zoom + 0.5;\n\t\t\t\t\tvar y = (s[1] * protocol.chunkSize - camera.y) * camera.zoom + 0.5;\n\t\t\t\t\tvar rw = (e[0] - s[0]);\n\t\t\t\t\tvar rh = (e[1] - s[1]);\n\t\t\t\t\tvar w = rw * camera.zoom * protocol.chunkSize;\n\t\t\t\t\tvar h = rh * camera.zoom * protocol.chunkSize;\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.rect(x, y, w, h);\n\t\t\t\t\tctx.globalAlpha = 1;\n\t\t\t\t\tctx.strokeStyle = \"#FFFFFF\";\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\tctx.setLineDash([3, 4]);\n\t\t\t\t\tctx.strokeStyle = \"#000000\";\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\tif (tool.extra.isSure) {\n\t\t\t\t\t\tctx.globalAlpha = 0.6;\n\t\t\t\t\t\tctx.fillStyle = \"#00EE00\";\n\t\t\t\t\t\tctx.fill();\n\t\t\t\t\t}\n\t\t\t\t\tctx.globalAlpha = 0.25 + Math.sin(time / 500) / 4;\n\t\t\t\t\tctx.fillStyle = renderer.patterns.unloaded;\n\t\t\t\t\tctx.fill();\n\t\t\t\t\tctx.setLineDash([]);\n\t\t\t\t\tvar oldfont = ctx.font;\n\t\t\t\t\tctx.font = \"16px sans-serif\";\n\t\t\t\t\tvar txt = `${tool.extra.isSure ? \"Click again to confirm. \" : (!tool.extra.clicking ? \"Double click to delete. \" : \"\")}(${Math.abs(rw)}x${Math.abs(rh)})`;\n\t\t\t\t\tvar txtx = window.innerWidth >> 1;\n\t\t\t\t\tvar txty = window.innerHeight >> 1;\n\t\t\t\t\ttxtx = Math.max(x, Math.min(txtx, x + w));\n\t\t\t\t\ttxty = Math.max(y, Math.min(txty, y + h));\n\n\t\t\t\t\tdrawText(ctx, txt, txtx, txty, true);\n\t\t\t\t\tctx.font = oldfont;\n\t\t\t\t\tctx.lineWidth = oldlinew;\n\t\t\t\t\treturn 0;\n\t\t\t\t} else {\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.moveTo(0, fxy + 0.5);\n\t\t\t\t\tctx.lineTo(window.innerWidth, fxy + 0.5);\n\t\t\t\t\tctx.moveTo(fxx + 0.5, 0);\n\t\t\t\t\tctx.lineTo(fxx + 0.5, window.innerHeight);\n\n\t\t\t\t\t//ctx.lineWidth = 1;\n\t\t\t\t\tctx.globalAlpha = 1;\n\t\t\t\t\tctx.strokeStyle = \"#FFFFFF\";\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\tctx.setLineDash([3]);\n\t\t\t\t\tctx.strokeStyle = \"#000000\";\n\t\t\t\t\tctx.stroke();\n\n\t\t\t\t\tctx.setLineDash([]);\n\t\t\t\t\tctx.lineWidth = oldlinew;\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttool.extra.start = null;\n\t\t\ttool.extra.end = null;\n\t\t\ttool.extra.clicking = false;\n\t\t\ttool.extra.isSure = false;\n\n\t\t\tvar timeout = null;\n\n\t\t\tconst sure = () => {\n\t\t\t\tif (tool.extra.isSure) {\n\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\ttimeout = null;\n\t\t\t\t\ttool.extra.isSure = false;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\ttool.extra.isSure = true;\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\ttool.extra.isSure = false;\n\t\t\t\t\ttimeout = null;\n\t\t\t\t}, 1000);\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\ttool.setEvent('mousedown', (mouse, event) => {\n\t\t\t\tvar get = {\n\t\t\t\t\trx() { return mouse.tileX / protocol.chunkSize; },\n\t\t\t\t\try() { return mouse.tileY / protocol.chunkSize },\n\t\t\t\t\tx() { return Math.round(mouse.tileX / protocol.chunkSize); },\n\t\t\t\t\ty() { return Math.round(mouse.tileY / protocol.chunkSize); }\n\t\t\t\t};\n\t\t\t\tvar s = tool.extra.start;\n\t\t\t\tvar e = tool.extra.end;\n\t\t\t\tconst isInside = () => get.rx() >= s[0] && get.rx() < e[0] && get.ry() >= s[1] && get.ry() < e[1];\n\t\t\t\tif (mouse.buttons === 1 && !tool.extra.end) {\n\t\t\t\t\ttool.extra.start = [get.x(), get.y()];\n\t\t\t\t\ttool.extra.clicking = true;\n\t\t\t\t\ttool.setEvent('mousemove', (mouse, event) => {\n\t\t\t\t\t\tif (tool.extra.start && mouse.buttons === 1) {\n\t\t\t\t\t\t\ttool.extra.end = [get.x(), get.y()];\n\t\t\t\t\t\t\treturn 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tconst finish = () => {\n\t\t\t\t\t\ttool.setEvent('mousemove mouseup deselect', null);\n\t\t\t\t\t\ttool.extra.clicking = false;\n\t\t\t\t\t\tvar s = tool.extra.start;\n\t\t\t\t\t\tvar e = tool.extra.end;\n\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\tif (s[0] === e[0] || s[1] === e[1]) {\n\t\t\t\t\t\t\t\ttool.extra.start = null;\n\t\t\t\t\t\t\t\ttool.extra.end = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (s[0] > e[0]) {\n\t\t\t\t\t\t\t\tvar tmp = e[0];\n\t\t\t\t\t\t\t\te[0] = s[0];\n\t\t\t\t\t\t\t\ts[0] = tmp;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (s[1] > e[1]) {\n\t\t\t\t\t\t\t\tvar tmp = e[1];\n\t\t\t\t\t\t\t\te[1] = s[1];\n\t\t\t\t\t\t\t\ts[1] = tmp;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\trenderer.render(renderer.rendertype.FX);\n\t\t\t\t\t};\n\t\t\t\t\ttool.setEvent('deselect', finish);\n\t\t\t\t\ttool.setEvent('mouseup', (mouse, event) => {\n\t\t\t\t\t\tif (!(mouse.buttons & 1)) {\n\t\t\t\t\t\t\tfinish();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else if (mouse.buttons === 1 && tool.extra.end) {\n\t\t\t\t\tif (isInside() && sure()) {\n\t\t\t\t\t\ttool.extra.start = null;\n\t\t\t\t\t\ttool.extra.end = null;\n\t\t\t\t\t\tvar [x, y, w, h] = [s[0], s[1], e[0] - s[0], e[1] - s[1]];\n\t\t\t\t\t\tfor (var i = x; i < x + w; i++) {\n\t\t\t\t\t\t\tfor (var j = y; j < y + h; j++) {\n\t\t\t\t\t\t\t\tvar chunk = misc.world.getChunkAt(i, j);\n\t\t\t\t\t\t\t\tif (chunk && !chunk.locked) {\n\t\t\t\t\t\t\t\t\tnet.protocol.clearChunk(i, j, [255, 255, 255]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (!isInside()) {\n\t\t\t\t\t\ttool.extra.start = null;\n\t\t\t\t\t\ttool.extra.end = null;\n\t\t\t\t\t}\n\t\t\t\t} else if (mouse.buttons === 2 && tool.extra.end && isInside() && sure()) {\n\t\t\t\t\ttool.extra.start = null;\n\t\t\t\t\ttool.extra.end = null;\n\t\t\t\t\tvar [x, y, w, h] = [s[0], s[1], e[0] - s[0], e[1] - s[1]];\n\t\t\t\t\tfor (var i = x; i < x + w; i++) {\n\t\t\t\t\t\tfor (var j = y; j < y + h; j++) {\n\t\t\t\t\t\t\tvar chunk = misc.world.getChunkAt(i, j);\n\t\t\t\t\t\t\tif (chunk && chunk.locked) {\n\t\t\t\t\t\t\t\tnet.protocol.clearChunk(i, j, [255, 255, 255]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t));*/\n\n\taddTool(new Tool('Paste', cursors.paste, PLAYERFX.NONE, RANK.MODERATOR, tool => {\n\t\ttool.extra.sendQueue = [];\n\n\t\ttool.setFxRenderer((fx, ctx, time) => {\n\t\t\tvar z = camera.zoom;\n\t\t\tvar x = fx.extra.player.x;\n\t\t\tvar y = fx.extra.player.y;\n\t\t\tvar fxx = Math.floor(x / 16) - camera.x;\n\t\t\tvar fxy = Math.floor(y / 16) - camera.y;\n\n\t\t\tvar q = tool.extra.sendQueue;\n\t\t\tif (q.length) {\n\t\t\t\tvar cs = protocol.chunkSize;\n\t\t\t\tctx.strokeStyle = \"#000000\";\n\t\t\t\tctx.globalAlpha = 0.8;\n\t\t\t\tctx.beginPath();\n\t\t\t\tfor (var i = 0; i < q.length; i++) {\n\t\t\t\t\tctx.rect((q[i].x * cs - camera.x) * z, (q[i].y * cs - camera.y) * z, z * cs, z * cs);\n\t\t\t\t}\n\t\t\t\tctx.stroke();\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (tool.extra.canvas && fx.extra.isLocalPlayer) {\n\t\t\t\tctx.globalAlpha = 0.5 + Math.sin(time / 500) / 4;\n\t\t\t\tctx.strokeStyle = \"#000000\";\n\t\t\t\tctx.scale(z, z);\n\t\t\t\tctx.drawImage(tool.extra.canvas, fxx, fxy);\n\t\t\t\tctx.scale(1 / z, 1 / z);\n\t\t\t\tctx.globalAlpha = 0.8;\n\t\t\t\tctx.strokeRect(fxx * z, fxy * z, tool.extra.canvas.width * z, tool.extra.canvas.height * z);\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t});\n\n\t\tconst paint = (tileX, tileY) => {\n\t\t\tvar tmpBuffer = new Uint32Array(protocol.chunkSize * protocol.chunkSize);\n\t\t\tvar ctx = tool.extra.canvas.getContext(\"2d\");\n\t\t\tvar dat = ctx.getImageData(0, 0, tool.extra.canvas.width, tool.extra.canvas.height);\n\t\t\tvar u32dat = new Uint32Array(dat.data.buffer);\n\t\t\tvar totalChunksW = Math.ceil((absMod(tileX, protocol.chunkSize) + dat.width) / protocol.chunkSize);\n\t\t\tvar totalChunksH = Math.ceil((absMod(tileY, protocol.chunkSize) + dat.height) / protocol.chunkSize);\n\t\t\tconst getModifiedPixel = (x, y) => {\n\t\t\t\tvar imgY = y - tileY;\n\t\t\t\tvar imgX = x - tileX;\n\t\t\t\tif (imgY < 0 || imgX < 0 || imgY >= dat.height || imgX >= dat.width) {\n\t\t\t\t\tvar currentPixel = misc.world.getPixel(x, y);\n\t\t\t\t\tif (!currentPixel && tool.extra.wreckStuff) {\n\t\t\t\t\t\tcurrentPixel = [255, 255, 255];\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn currentPixel ? (currentPixel[2] << 16 | currentPixel[1] << 8 | currentPixel[0])\n\t\t\t\t\t\t: null;\n\t\t\t\t}\n\t\t\t\tvar img = u32dat[imgY * dat.width + imgX];\n\t\t\t\tvar oldPixel = misc.world.getPixel(x, y);\n\t\t\t\tvar alpha = img >> 24 & 0xFF;\n\t\t\t\tif (!oldPixel) {\n\t\t\t\t\tif (tool.extra.wreckStuff) {\n\t\t\t\t\t\toldPixel = [255, 255, 255];\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar r = (1 - alpha / 255) * oldPixel[0] + (alpha / 255) * (img       & 0xFF);\n\t\t\t\tvar g = (1 - alpha / 255) * oldPixel[1] + (alpha / 255) * (img >> 8  & 0xFF);\n\t\t\t\tvar b = (1 - alpha / 255) * oldPixel[2] + (alpha / 255) * (img >> 16 & 0xFF);\n\t\t\t\tvar rgb = b << 16 | g << 8 | r;\n\t\t\t\treturn (r == oldPixel[0] && g == oldPixel[1] && b == oldPixel[2]) ? rgb : 0xFF000000 | rgb;\n\t\t\t};\n\n\t\t\tconst getModifiedChunk = (chunkX, chunkY) => {\n\t\t\t\tvar modified = 0;\n\t\t\t\tvar offX = chunkX * protocol.chunkSize;\n\t\t\t\tvar offY = chunkY * protocol.chunkSize;\n\t\t\t\tfor (var y = 0; y < protocol.chunkSize; y++) {\n\t\t\t\t\tfor (var x = 0; x < protocol.chunkSize; x++) {\n\t\t\t\t\t\tvar color = getModifiedPixel(x + offX, y + offY);\n\t\t\t\t\t\tif (color !== null) {\n\t\t\t\t\t\t\tif (color & 0xFF000000) {\n\t\t\t\t\t\t\t\t++modified;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttmpBuffer[y * protocol.chunkSize + x] = color & 0xFFFFFF;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t/* Chunk not loaded... */\n\t\t\t\t\t\t\tthrow new Error(`Couldn't paste -- chunk (${chunkX}, ${chunkY}) is unloaded`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn modified ? tmpBuffer : null;\n\t\t\t};\n\t\t\tif (!net.protocol.setChunk) {\n\t\t\t\tthrow new Error(\"Protocol doesn't support pasting\");\n\t\t\t}\n\n\t\t\tfor (var y = Math.floor(tileY / protocol.chunkSize), t = totalChunksH; --t >= 0; y++) {\n\t\t\t\tfor (var x = Math.floor(tileX / protocol.chunkSize), tw = totalChunksW; --tw >= 0; x++) {\n\t\t\t\t\tvar newChunk = getModifiedChunk(x, y);\n\t\t\t\t\tif (newChunk) {\n\t\t\t\t\t\tif (!net.protocol.setChunk(x, y, newChunk)) {\n\t\t\t\t\t\t\tvar nbuf = new Uint32Array(newChunk.length);\n\t\t\t\t\t\t\tnbuf.set(newChunk);\n\t\t\t\t\t\t\ttool.extra.sendQueue.push({\n\t\t\t\t\t\t\t\tx: x,\n\t\t\t\t\t\t\t\ty: y,\n\t\t\t\t\t\t\t\tbuf: nbuf\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\ttool.setEvent('tick', () => {\n\t\t\tvar q = tool.extra.sendQueue;\n\t\t\tif (q.length) {\n\t\t\t\tif (net.protocol.setChunk(q[0].x, q[0].y, q[0].buf)) {\n\t\t\t\t\tq.shift();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\ttool.setEvent('mousedown', mouse => {\n\t\t\tif (mouse.buttons & 0b1) {\n\t\t\t\tif (tool.extra.canvas) {\n\t\t\t\t\tif (tool.extra.sendQueue.length) {\n\t\t\t\t\t\tthrow new Error(\"Wait until pasting finishes, or cancel with right click!\");\n\t\t\t\t\t}\n\n\t\t\t\t\tpaint(mouse.tileX, mouse.tileY);\n\t\t\t\t}\n\t\t\t} else if (mouse.buttons & 0b10) {\n\t\t\t\ttool.extra.sendQueue = [];\n\t\t\t}\n\t\t});\n\n\t\tvar input = document.createElement(\"input\");\n\t\tinput.type = \"file\";\n\t\tinput.accept = \"image/*\";\n\t\ttool.setEvent('select', () => {\n\t\t\tinput.onchange = event => {\n\t\t\t\tif (input.files && input.files[0]) {\n\t\t\t\t\tvar reader = new FileReader();\n\t\t\t\t\treader.onload = e => {\n\t\t\t\t\t\tvar image = new Image();\n\t\t\t\t\t\timage.onload = () => {\n\t\t\t\t\t\t\ttool.extra.canvas = document.createElement(\"canvas\");\n\t\t\t\t\t\t\ttool.extra.canvas.width = image.width;\n\t\t\t\t\t\t\ttool.extra.canvas.height = image.height;\n\t\t\t\t\t\t\tvar ctx = tool.extra.canvas.getContext(\"2d\");\n\t\t\t\t\t\t\tctx.drawImage(image, 0, 0);\n\t\t\t\t\t\t\tconsole.log('Loaded image');\n\t\t\t\t\t\t};\n\t\t\t\t\t\timage.src = e.target.result;\n\t\t\t\t\t};\n\t\t\t\t\treader.readAsDataURL(input.files[0]);\n\t\t\t\t}\n\t\t\t};\n\t\t\tinput.click();\n\t\t});\n\t}));\n\n\taddTool(new Tool('Copy', cursors.copy, PLAYERFX.NONE, RANK.MODERATOR, function (tool) {\n\t\tfunction drawText(ctx, str, x, y, centered) {\n\t\t\tctx.strokeStyle = \"#000000\", ctx.fillStyle = \"#FFFFFF\", ctx.lineWidth = 2.5, ctx.globalAlpha = 0.5;\n\t\t\tif (centered) {\n\t\t\t\tx -= ctx.measureText(str).width >> 1;\n\t\t\t}\n\t\t\tctx.strokeText(str, x, y);\n\t\t\tctx.globalAlpha = 1;\n\t\t\tctx.fillText(str, x, y);\n\t\t}\n\n\t\ttool.setFxRenderer(function (fx, ctx, time) {\n\t\t\tif (!fx.extra.isLocalPlayer) return 1;\n\t\t\tvar x = fx.extra.player.x;\n\t\t\tvar y = fx.extra.player.y;\n\t\t\tvar fxx = (Math.floor(x / 16) - camera.x) * camera.zoom;\n\t\t\tvar fxy = (Math.floor(y / 16) - camera.y) * camera.zoom;\n\t\t\tvar oldlinew = ctx.lineWidth;\n\t\t\tctx.lineWidth = 1;\n\t\t\tif (tool.extra.end) {\n\t\t\t\tvar s = tool.extra.start;\n\t\t\t\tvar e = tool.extra.end;\n\t\t\t\tvar x = (s[0] - camera.x) * camera.zoom + 0.5;\n\t\t\t\tvar y = (s[1] - camera.y) * camera.zoom + 0.5;\n\t\t\t\tvar w = e[0] - s[0];\n\t\t\t\tvar h = e[1] - s[1];\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.rect(x, y, w * camera.zoom, h * camera.zoom);\n\t\t\t\tctx.globalAlpha = 1;\n\t\t\t\tctx.strokeStyle = \"#FFFFFF\";\n\t\t\t\tctx.stroke();\n\t\t\t\tctx.setLineDash([3, 4]);\n\t\t\t\tctx.strokeStyle = \"#000000\";\n\t\t\t\tctx.stroke();\n\t\t\t\tctx.globalAlpha = 0.25 + Math.sin(time / 500) / 4;\n\t\t\t\tctx.fillStyle = renderer.patterns.unloaded;\n\t\t\t\tctx.fill();\n\t\t\t\tctx.setLineDash([]);\n\t\t\t\tvar oldfont = ctx.font;\n\t\t\t\tctx.font = \"16px sans-serif\";\n\t\t\t\tvar txt = (!tool.extra.clicking ? \"Right click to copy \" : \"\") + '(' + Math.abs(w) + 'x' + Math.abs(h) + ')';\n\t\t\t\tvar txtx = window.innerWidth >> 1;\n\t\t\t\tvar txty = window.innerHeight >> 1;\n\t\t\t\ttxtx = Math.max(x, Math.min(txtx, x + w * camera.zoom));\n\t\t\t\ttxty = Math.max(y, Math.min(txty, y + h * camera.zoom));\n\n\t\t\t\tdrawText(ctx, txt, txtx, txty, true);\n\t\t\t\tctx.font = oldfont;\n\t\t\t\tctx.lineWidth = oldlinew;\n\t\t\t\treturn 0;\n\t\t\t} else {\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.moveTo(0, fxy + 0.5);\n\t\t\t\tctx.lineTo(window.innerWidth, fxy + 0.5);\n\t\t\t\tctx.moveTo(fxx + 0.5, 0);\n\t\t\t\tctx.lineTo(fxx + 0.5, window.innerHeight);\n\n\t\t\t\t//ctx.lineWidth = 1;\n\t\t\t\tctx.globalAlpha = 1;\n\t\t\t\tctx.strokeStyle = \"#FFFFFF\";\n\t\t\t\tctx.stroke();\n\t\t\t\tctx.setLineDash([3]);\n\t\t\t\tctx.strokeStyle = \"#000000\";\n\t\t\t\tctx.stroke();\n\n\t\t\t\tctx.setLineDash([]);\n\t\t\t\tctx.lineWidth = oldlinew;\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t});\n\n\t\ttool.extra.start = null;\n\t\ttool.extra.end = null;\n\t\ttool.extra.clicking = false;\n\n\t\ttool.setEvent('mousedown', function (mouse, event) {\n\t\t\tvar s = tool.extra.start;\n\t\t\tvar e = tool.extra.end;\n\t\t\tvar isInside = function isInside() {\n\t\t\t\treturn mouse.tileX >= s[0] && mouse.tileX < e[0] && mouse.tileY >= s[1] && mouse.tileY < e[1];\n\t\t\t};\n\t\t\tif (mouse.buttons === 1 && !tool.extra.end) {\n\t\t\t\ttool.extra.start = [mouse.tileX, mouse.tileY];\n\t\t\t\ttool.extra.clicking = true;\n\t\t\t\ttool.setEvent('mousemove', function (mouse, event) {\n\t\t\t\t\tif (tool.extra.start && mouse.buttons === 1) {\n\t\t\t\t\t\ttool.extra.end = [mouse.tileX, mouse.tileY];\n\t\t\t\t\t\treturn 1;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tvar finish = function finish() {\n\t\t\t\t\ttool.setEvent('mousemove mouseup deselect', null);\n\t\t\t\t\ttool.extra.clicking = false;\n\t\t\t\t\tvar s = tool.extra.start;\n\t\t\t\t\tvar e = tool.extra.end;\n\t\t\t\t\tif (e) {\n\t\t\t\t\t\tif (s[0] === e[0] || s[1] === e[1]) {\n\t\t\t\t\t\t\ttool.extra.start = null;\n\t\t\t\t\t\t\ttool.extra.end = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (s[0] > e[0]) {\n\t\t\t\t\t\t\tvar tmp = e[0];\n\t\t\t\t\t\t\te[0] = s[0];\n\t\t\t\t\t\t\ts[0] = tmp;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (s[1] > e[1]) {\n\t\t\t\t\t\t\tvar tmp = e[1];\n\t\t\t\t\t\t\te[1] = s[1];\n\t\t\t\t\t\t\ts[1] = tmp;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\trenderer.render(renderer.rendertype.FX);\n\t\t\t\t};\n\t\t\t\ttool.setEvent('deselect', finish);\n\t\t\t\ttool.setEvent('mouseup', function (mouse, event) {\n\t\t\t\t\tif (!(mouse.buttons & 1)) {\n\t\t\t\t\t\tfinish();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (mouse.buttons === 1 && tool.extra.end) {\n\t\t\t\tif (isInside()) {\n\t\t\t\t\tvar offx = mouse.tileX;\n\t\t\t\t\tvar offy = mouse.tileY;\n\t\t\t\t\ttool.setEvent('mousemove', function (mouse, event) {\n\t\t\t\t\t\tvar dx = mouse.tileX - offx;\n\t\t\t\t\t\tvar dy = mouse.tileY - offy;\n\t\t\t\t\t\ttool.extra.start = [s[0] + dx, s[1] + dy];\n\t\t\t\t\t\ttool.extra.end = [e[0] + dx, e[1] + dy];\n\t\t\t\t\t});\n\t\t\t\t\tvar end = function end() {\n\t\t\t\t\t   tool.setEvent('mouseup deselect mousemove', null);\n\t\t\t\t\t};\n\t\t\t\t\ttool.setEvent('deselect', end);\n\t\t\t\t\ttool.setEvent('mouseup', function (mouse, event) {\n\t\t\t\t\t\tif (!(mouse.buttons & 1)) {\n\t\t\t\t\t\t\tend();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\ttool.extra.start = null;\n\t\t\t\t\ttool.extra.end = null;\n\t\t\t\t}\n\t\t   } else if (mouse.buttons === 2 && tool.extra.end && isInside()) {\n\t\t\t\ttool.extra.start = null;\n\t\t\t\ttool.extra.end = null;\n\t\t\t\tvar x = s[0];\n\t\t\t\tvar y = s[1];\n\t\t\t\tvar w = e[0] - s[0];\n\t\t\t\tvar h = e[1] - s[1];\n\t\t\t\tvar c = document.createElement('canvas');\n\t\t\t\tc.width = w;\n\t\t\t\tc.height = h;\n\t\t\t\tvar ctx = c.getContext('2d');\n\t\t\t\tvar d = ctx.createImageData(w, h);\n\t\t\t\tfor (var i = y; i < y + h; i++) {\n\t\t\t\t\tfor (var j = x; j < x + w; j++) {\n\t\t\t\t\t\tvar pix = misc.world.getPixel(j, i);\n\t\t\t\t\t\tif (!pix) continue;\n\t\t\t\t\t\td.data[4 * ((i - y) * w + (j - x))] = pix[0];\n\t\t\t\t\t\td.data[4 * ((i - y) * w + (j - x)) + 1] = pix[1];\n\t\t\t\t\t\td.data[4 * ((i - y) * w + (j - x)) + 2] = pix[2];\n\t\t\t\t\t\td.data[4 * ((i - y) * w + (j - x)) + 3] = 255;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tctx.putImageData(d, 0, 0);\n\t\t\t\tvar paste = tools.paste;\n\t\t\t\tpaste.extra.canvas = c;\n\t\t\t\tvar oldSelect = paste.events.select;\n\t\t\t\tpaste.events.select = function() {\n\t\t\t\t\tpaste.events.select = oldSelect;\n\t\t\t\t};\n\t\t\t\tplayer.tool = \"paste\";\n\t\t\t}\n\t\t});\n\t}));\n\n\teventSys.emit(e.misc.toolsInitialized);\n});\n\neventSys.once(e.init, () => {\n\ttoolsWindow = new GUIWindow('Tools', {}, wdow => {\n\t\twdow.container.id = \"toole-container\";\n\t\twdow.container.style.cssText = \"max-width: 40px\";\n\t}).move(5, 32);\n});\n\neventSys.once(e.misc.toolsInitialized, () => {\n\tupdateToolbar();\n\tif (windowShown) {\n\t\twindowSys.addWindow(toolsWindow);\n\t}\n});\n\neventSys.on(e.net.disconnected, () => {\n\tshowToolsWindow(false);\n});\n\neventSys.on(e.misc.worldInitialized, () => {\n\tshowToolsWindow(true);\n});\n","'use strict';\n\nexport class Bucket {\n\tconstructor(rate, time) {\n\t\tthis.lastCheck = Date.now();\n\t\tthis.allowance = rate;\n\t\tthis.rate = rate;\n\t\tthis.time = time;\n\t\tthis.infinite = false;\n\t}\n\t\n\tcanSpend(count) {\n\t\tif (this.infinite) {\n\t\t\treturn true;\n\t\t}\n\t\t\n\t\tthis.allowance += (Date.now() - this.lastCheck) / 1000 * (this.rate / this.time);\n\t\tthis.lastCheck = Date.now();\n\t\tif (this.allowance > this.rate) {\n\t\t\tthis.allowance = this.rate;\n\t\t}\n\t\tif (this.allowance < count) {\n\t\t\treturn false;\n\t\t}\n\t\tthis.allowance -= count;\n\t\treturn true;\n\t}\n}\n","'use strict';\nimport { getTime } from './misc.js';\n\n/* Time function, time will be updated by the renderer */\nconst time = getTime /*() => getTime(true)*/;\n\nexport class Lerp {\n    constructor(start, end, ms) {\n        this.start = start;\n        this.end = end;\n        this.ms = ms;\n        this.time = time();\n    }\n\n    get val() {\n        let amt = Math.min((time() - this.time) / this.ms, 1);\n        return (1 - amt) * this.start + amt * this.end;\n    }\n\n    set val(v) {\n        this.start = this.val;\n        this.end = v;\n        this.time = time(true);\n    }\n}\n","!function(e,a){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=a():\"function\"==typeof define&&define.amd?define(a):e.anchorme=a()}(this,function(){\"use strict\";function e(e,a){return a={exports:{}},e(a,a.exports),a.exports}var a=e(function(e,a){function n(e){return e||(e={attributes:[],ips:!0,emails:!0,urls:!0,files:!0,truncate:1/0,defaultProtocol:\"http://\",list:!1}),\"object\"!=typeof e.attributes&&(e.attributes=[]),\"boolean\"!=typeof e.ips&&(e.ips=!0),\"boolean\"!=typeof e.emails&&(e.emails=!0),\"boolean\"!=typeof e.urls&&(e.urls=!0),\"boolean\"!=typeof e.files&&(e.files=!0),\"boolean\"!=typeof e.list&&(e.list=!1),\"string\"!=typeof e.defaultProtocol&&\"function\"!=typeof e.defaultProtocol&&(e.defaultProtocol=\"http://\"),\"number\"==typeof e.truncate||\"object\"==typeof e.truncate&&null!==e.truncate||(e.truncate=1/0),e}function t(e){return!isNaN(Number(e))&&!(Number(e)>65535)}Object.defineProperty(a,\"__esModule\",{value:!0}),a.defaultOptions=n,a.isPort=t}),n=e(function(e,a){Object.defineProperty(a,\"__esModule\",{value:!0}),a.tlds=[\"com\",\"org\",\"net\",\"uk\",\"gov\",\"edu\",\"io\",\"cc\",\"co\",\"aaa\",\"aarp\",\"abarth\",\"abb\",\"abbott\",\"abbvie\",\"abc\",\"able\",\"abogado\",\"abudhabi\",\"ac\",\"academy\",\"accenture\",\"accountant\",\"accountants\",\"aco\",\"active\",\"actor\",\"ad\",\"adac\",\"ads\",\"adult\",\"ae\",\"aeg\",\"aero\",\"aetna\",\"af\",\"afamilycompany\",\"afl\",\"africa\",\"ag\",\"agakhan\",\"agency\",\"ai\",\"aig\",\"aigo\",\"airbus\",\"airforce\",\"airtel\",\"akdn\",\"al\",\"alfaromeo\",\"alibaba\",\"alipay\",\"allfinanz\",\"allstate\",\"ally\",\"alsace\",\"alstom\",\"am\",\"americanexpress\",\"americanfamily\",\"amex\",\"amfam\",\"amica\",\"amsterdam\",\"analytics\",\"android\",\"anquan\",\"anz\",\"ao\",\"aol\",\"apartments\",\"app\",\"apple\",\"aq\",\"aquarelle\",\"ar\",\"aramco\",\"archi\",\"army\",\"arpa\",\"art\",\"arte\",\"as\",\"asda\",\"asia\",\"associates\",\"at\",\"athleta\",\"attorney\",\"au\",\"auction\",\"audi\",\"audible\",\"audio\",\"auspost\",\"author\",\"auto\",\"autos\",\"avianca\",\"aw\",\"aws\",\"ax\",\"axa\",\"az\",\"azure\",\"ba\",\"baby\",\"baidu\",\"banamex\",\"bananarepublic\",\"band\",\"bank\",\"bar\",\"barcelona\",\"barclaycard\",\"barclays\",\"barefoot\",\"bargains\",\"baseball\",\"basketball\",\"bauhaus\",\"bayern\",\"bb\",\"bbc\",\"bbt\",\"bbva\",\"bcg\",\"bcn\",\"bd\",\"be\",\"beats\",\"beauty\",\"beer\",\"bentley\",\"berlin\",\"best\",\"bestbuy\",\"bet\",\"bf\",\"bg\",\"bh\",\"bharti\",\"bi\",\"bible\",\"bid\",\"bike\",\"bing\",\"bingo\",\"bio\",\"biz\",\"bj\",\"black\",\"blackfriday\",\"blanco\",\"blockbuster\",\"blog\",\"bloomberg\",\"blue\",\"bm\",\"bms\",\"bmw\",\"bn\",\"bnl\",\"bnpparibas\",\"bo\",\"boats\",\"boehringer\",\"bofa\",\"bom\",\"bond\",\"boo\",\"book\",\"booking\",\"boots\",\"bosch\",\"bostik\",\"boston\",\"bot\",\"boutique\",\"box\",\"br\",\"bradesco\",\"bridgestone\",\"broadway\",\"broker\",\"brother\",\"brussels\",\"bs\",\"bt\",\"budapest\",\"bugatti\",\"build\",\"builders\",\"business\",\"buy\",\"buzz\",\"bv\",\"bw\",\"by\",\"bz\",\"bzh\",\"ca\",\"cab\",\"cafe\",\"cal\",\"call\",\"calvinklein\",\"cam\",\"camera\",\"camp\",\"cancerresearch\",\"canon\",\"capetown\",\"capital\",\"capitalone\",\"car\",\"caravan\",\"cards\",\"care\",\"career\",\"careers\",\"cars\",\"cartier\",\"casa\",\"case\",\"caseih\",\"cash\",\"casino\",\"cat\",\"catering\",\"catholic\",\"cba\",\"cbn\",\"cbre\",\"cbs\",\"cd\",\"ceb\",\"center\",\"ceo\",\"cern\",\"cf\",\"cfa\",\"cfd\",\"cg\",\"ch\",\"chanel\",\"channel\",\"chase\",\"chat\",\"cheap\",\"chintai\",\"chloe\",\"christmas\",\"chrome\",\"chrysler\",\"church\",\"ci\",\"cipriani\",\"circle\",\"cisco\",\"citadel\",\"citi\",\"citic\",\"city\",\"cityeats\",\"ck\",\"cl\",\"claims\",\"cleaning\",\"click\",\"clinic\",\"clinique\",\"clothing\",\"cloud\",\"club\",\"clubmed\",\"cm\",\"cn\",\"coach\",\"codes\",\"coffee\",\"college\",\"cologne\",\"comcast\",\"commbank\",\"community\",\"company\",\"compare\",\"computer\",\"comsec\",\"condos\",\"construction\",\"consulting\",\"contact\",\"contractors\",\"cooking\",\"cookingchannel\",\"cool\",\"coop\",\"corsica\",\"country\",\"coupon\",\"coupons\",\"courses\",\"cr\",\"credit\",\"creditcard\",\"creditunion\",\"cricket\",\"crown\",\"crs\",\"cruise\",\"cruises\",\"csc\",\"cu\",\"cuisinella\",\"cv\",\"cw\",\"cx\",\"cy\",\"cymru\",\"cyou\",\"cz\",\"dabur\",\"dad\",\"dance\",\"data\",\"date\",\"dating\",\"datsun\",\"day\",\"dclk\",\"dds\",\"de\",\"deal\",\"dealer\",\"deals\",\"degree\",\"delivery\",\"dell\",\"deloitte\",\"delta\",\"democrat\",\"dental\",\"dentist\",\"desi\",\"design\",\"dev\",\"dhl\",\"diamonds\",\"diet\",\"digital\",\"direct\",\"directory\",\"discount\",\"discover\",\"dish\",\"diy\",\"dj\",\"dk\",\"dm\",\"dnp\",\"do\",\"docs\",\"doctor\",\"dodge\",\"dog\",\"doha\",\"domains\",\"dot\",\"download\",\"drive\",\"dtv\",\"dubai\",\"duck\",\"dunlop\",\"duns\",\"dupont\",\"durban\",\"dvag\",\"dvr\",\"dz\",\"earth\",\"eat\",\"ec\",\"eco\",\"edeka\",\"education\",\"ee\",\"eg\",\"email\",\"emerck\",\"energy\",\"engineer\",\"engineering\",\"enterprises\",\"epost\",\"epson\",\"equipment\",\"er\",\"ericsson\",\"erni\",\"es\",\"esq\",\"estate\",\"esurance\",\"et\",\"eu\",\"eurovision\",\"eus\",\"events\",\"everbank\",\"exchange\",\"expert\",\"exposed\",\"express\",\"extraspace\",\"fage\",\"fail\",\"fairwinds\",\"faith\",\"family\",\"fan\",\"fans\",\"farm\",\"farmers\",\"fashion\",\"fast\",\"fedex\",\"feedback\",\"ferrari\",\"ferrero\",\"fi\",\"fiat\",\"fidelity\",\"fido\",\"film\",\"final\",\"finance\",\"financial\",\"fire\",\"firestone\",\"firmdale\",\"fish\",\"fishing\",\"fit\",\"fitness\",\"fj\",\"fk\",\"flickr\",\"flights\",\"flir\",\"florist\",\"flowers\",\"fly\",\"fm\",\"fo\",\"foo\",\"food\",\"foodnetwork\",\"football\",\"ford\",\"forex\",\"forsale\",\"forum\",\"foundation\",\"fox\",\"fr\",\"free\",\"fresenius\",\"frl\",\"frogans\",\"frontdoor\",\"frontier\",\"ftr\",\"fujitsu\",\"fujixerox\",\"fun\",\"fund\",\"furniture\",\"futbol\",\"fyi\",\"ga\",\"gal\",\"gallery\",\"gallo\",\"gallup\",\"game\",\"games\",\"gap\",\"garden\",\"gb\",\"gbiz\",\"gd\",\"gdn\",\"ge\",\"gea\",\"gent\",\"genting\",\"george\",\"gf\",\"gg\",\"ggee\",\"gh\",\"gi\",\"gift\",\"gifts\",\"gives\",\"giving\",\"gl\",\"glade\",\"glass\",\"gle\",\"global\",\"globo\",\"gm\",\"gmail\",\"gmbh\",\"gmo\",\"gmx\",\"gn\",\"godaddy\",\"gold\",\"goldpoint\",\"golf\",\"goo\",\"goodhands\",\"goodyear\",\"goog\",\"google\",\"gop\",\"got\",\"gp\",\"gq\",\"gr\",\"grainger\",\"graphics\",\"gratis\",\"green\",\"gripe\",\"group\",\"gs\",\"gt\",\"gu\",\"guardian\",\"gucci\",\"guge\",\"guide\",\"guitars\",\"guru\",\"gw\",\"gy\",\"hair\",\"hamburg\",\"hangout\",\"haus\",\"hbo\",\"hdfc\",\"hdfcbank\",\"health\",\"healthcare\",\"help\",\"helsinki\",\"here\",\"hermes\",\"hgtv\",\"hiphop\",\"hisamitsu\",\"hitachi\",\"hiv\",\"hk\",\"hkt\",\"hm\",\"hn\",\"hockey\",\"holdings\",\"holiday\",\"homedepot\",\"homegoods\",\"homes\",\"homesense\",\"honda\",\"honeywell\",\"horse\",\"hospital\",\"host\",\"hosting\",\"hot\",\"hoteles\",\"hotmail\",\"house\",\"how\",\"hr\",\"hsbc\",\"ht\",\"htc\",\"hu\",\"hughes\",\"hyatt\",\"hyundai\",\"ibm\",\"icbc\",\"ice\",\"icu\",\"id\",\"ie\",\"ieee\",\"ifm\",\"ikano\",\"il\",\"im\",\"imamat\",\"imdb\",\"immo\",\"immobilien\",\"in\",\"industries\",\"infiniti\",\"info\",\"ing\",\"ink\",\"institute\",\"insurance\",\"insure\",\"int\",\"intel\",\"international\",\"intuit\",\"investments\",\"ipiranga\",\"iq\",\"ir\",\"irish\",\"is\",\"iselect\",\"ismaili\",\"ist\",\"istanbul\",\"it\",\"itau\",\"itv\",\"iveco\",\"iwc\",\"jaguar\",\"java\",\"jcb\",\"jcp\",\"je\",\"jeep\",\"jetzt\",\"jewelry\",\"jio\",\"jlc\",\"jll\",\"jm\",\"jmp\",\"jnj\",\"jo\",\"jobs\",\"joburg\",\"jot\",\"joy\",\"jp\",\"jpmorgan\",\"jprs\",\"juegos\",\"juniper\",\"kaufen\",\"kddi\",\"ke\",\"kerryhotels\",\"kerrylogistics\",\"kerryproperties\",\"kfh\",\"kg\",\"kh\",\"ki\",\"kia\",\"kim\",\"kinder\",\"kindle\",\"kitchen\",\"kiwi\",\"km\",\"kn\",\"koeln\",\"komatsu\",\"kosher\",\"kp\",\"kpmg\",\"kpn\",\"kr\",\"krd\",\"kred\",\"kuokgroup\",\"kw\",\"ky\",\"kyoto\",\"kz\",\"la\",\"lacaixa\",\"ladbrokes\",\"lamborghini\",\"lamer\",\"lancaster\",\"lancia\",\"lancome\",\"land\",\"landrover\",\"lanxess\",\"lasalle\",\"lat\",\"latino\",\"latrobe\",\"law\",\"lawyer\",\"lb\",\"lc\",\"lds\",\"lease\",\"leclerc\",\"lefrak\",\"legal\",\"lego\",\"lexus\",\"lgbt\",\"li\",\"liaison\",\"lidl\",\"life\",\"lifeinsurance\",\"lifestyle\",\"lighting\",\"like\",\"lilly\",\"limited\",\"limo\",\"lincoln\",\"linde\",\"link\",\"lipsy\",\"live\",\"living\",\"lixil\",\"lk\",\"loan\",\"loans\",\"locker\",\"locus\",\"loft\",\"lol\",\"london\",\"lotte\",\"lotto\",\"love\",\"lpl\",\"lplfinancial\",\"lr\",\"ls\",\"lt\",\"ltd\",\"ltda\",\"lu\",\"lundbeck\",\"lupin\",\"luxe\",\"luxury\",\"lv\",\"ly\",\"ma\",\"macys\",\"madrid\",\"maif\",\"maison\",\"makeup\",\"man\",\"management\",\"mango\",\"market\",\"marketing\",\"markets\",\"marriott\",\"marshalls\",\"maserati\",\"mattel\",\"mba\",\"mc\",\"mcd\",\"mcdonalds\",\"mckinsey\",\"md\",\"me\",\"med\",\"media\",\"meet\",\"melbourne\",\"meme\",\"memorial\",\"men\",\"menu\",\"meo\",\"metlife\",\"mg\",\"mh\",\"miami\",\"microsoft\",\"mil\",\"mini\",\"mint\",\"mit\",\"mitsubishi\",\"mk\",\"ml\",\"mlb\",\"mls\",\"mm\",\"mma\",\"mn\",\"mo\",\"mobi\",\"mobile\",\"mobily\",\"moda\",\"moe\",\"moi\",\"mom\",\"monash\",\"money\",\"monster\",\"montblanc\",\"mopar\",\"mormon\",\"mortgage\",\"moscow\",\"moto\",\"motorcycles\",\"mov\",\"movie\",\"movistar\",\"mp\",\"mq\",\"mr\",\"ms\",\"msd\",\"mt\",\"mtn\",\"mtpc\",\"mtr\",\"mu\",\"museum\",\"mutual\",\"mv\",\"mw\",\"mx\",\"my\",\"mz\",\"na\",\"nab\",\"nadex\",\"nagoya\",\"name\",\"nationwide\",\"natura\",\"navy\",\"nba\",\"nc\",\"ne\",\"nec\",\"netbank\",\"netflix\",\"network\",\"neustar\",\"new\",\"newholland\",\"news\",\"next\",\"nextdirect\",\"nexus\",\"nf\",\"nfl\",\"ng\",\"ngo\",\"nhk\",\"ni\",\"nico\",\"nike\",\"nikon\",\"ninja\",\"nissan\",\"nissay\",\"nl\",\"no\",\"nokia\",\"northwesternmutual\",\"norton\",\"now\",\"nowruz\",\"nowtv\",\"np\",\"nr\",\"nra\",\"nrw\",\"ntt\",\"nu\",\"nyc\",\"nz\",\"obi\",\"observer\",\"off\",\"office\",\"okinawa\",\"olayan\",\"olayangroup\",\"oldnavy\",\"ollo\",\"om\",\"omega\",\"one\",\"ong\",\"onl\",\"online\",\"onyourside\",\"ooo\",\"open\",\"oracle\",\"orange\",\"organic\",\"orientexpress\",\"origins\",\"osaka\",\"otsuka\",\"ott\",\"ovh\",\"pa\",\"page\",\"pamperedchef\",\"panasonic\",\"panerai\",\"paris\",\"pars\",\"partners\",\"parts\",\"party\",\"passagens\",\"pay\",\"pccw\",\"pe\",\"pet\",\"pf\",\"pfizer\",\"pg\",\"ph\",\"pharmacy\",\"philips\",\"phone\",\"photo\",\"photography\",\"photos\",\"physio\",\"piaget\",\"pics\",\"pictet\",\"pictures\",\"pid\",\"pin\",\"ping\",\"pink\",\"pioneer\",\"pizza\",\"pk\",\"pl\",\"place\",\"play\",\"playstation\",\"plumbing\",\"plus\",\"pm\",\"pn\",\"pnc\",\"pohl\",\"poker\",\"politie\",\"porn\",\"post\",\"pr\",\"pramerica\",\"praxi\",\"press\",\"prime\",\"pro\",\"prod\",\"productions\",\"prof\",\"progressive\",\"promo\",\"properties\",\"property\",\"protection\",\"pru\",\"prudential\",\"ps\",\"pt\",\"pub\",\"pw\",\"pwc\",\"py\",\"qa\",\"qpon\",\"quebec\",\"quest\",\"qvc\",\"racing\",\"radio\",\"raid\",\"re\",\"read\",\"realestate\",\"realtor\",\"realty\",\"recipes\",\"red\",\"redstone\",\"redumbrella\",\"rehab\",\"reise\",\"reisen\",\"reit\",\"reliance\",\"ren\",\"rent\",\"rentals\",\"repair\",\"report\",\"republican\",\"rest\",\"restaurant\",\"review\",\"reviews\",\"rexroth\",\"rich\",\"richardli\",\"ricoh\",\"rightathome\",\"ril\",\"rio\",\"rip\",\"rmit\",\"ro\",\"rocher\",\"rocks\",\"rodeo\",\"rogers\",\"room\",\"rs\",\"rsvp\",\"ru\",\"ruhr\",\"run\",\"rw\",\"rwe\",\"ryukyu\",\"sa\",\"saarland\",\"safe\",\"safety\",\"sakura\",\"sale\",\"salon\",\"samsclub\",\"samsung\",\"sandvik\",\"sandvikcoromant\",\"sanofi\",\"sap\",\"sapo\",\"sarl\",\"sas\",\"save\",\"saxo\",\"sb\",\"sbi\",\"sbs\",\"sc\",\"sca\",\"scb\",\"schaeffler\",\"schmidt\",\"scholarships\",\"school\",\"schule\",\"schwarz\",\"science\",\"scjohnson\",\"scor\",\"scot\",\"sd\",\"se\",\"seat\",\"secure\",\"security\",\"seek\",\"select\",\"sener\",\"services\",\"ses\",\"seven\",\"sew\",\"sex\",\"sexy\",\"sfr\",\"sg\",\"sh\",\"shangrila\",\"sharp\",\"shaw\",\"shell\",\"shia\",\"shiksha\",\"shoes\",\"shop\",\"shopping\",\"shouji\",\"show\",\"showtime\",\"shriram\",\"si\",\"silk\",\"sina\",\"singles\",\"site\",\"sj\",\"sk\",\"ski\",\"skin\",\"sky\",\"skype\",\"sl\",\"sling\",\"sm\",\"smart\",\"smile\",\"sn\",\"sncf\",\"so\",\"soccer\",\"social\",\"softbank\",\"software\",\"sohu\",\"solar\",\"solutions\",\"song\",\"sony\",\"soy\",\"space\",\"spiegel\",\"spot\",\"spreadbetting\",\"sr\",\"srl\",\"srt\",\"st\",\"stada\",\"staples\",\"star\",\"starhub\",\"statebank\",\"statefarm\",\"statoil\",\"stc\",\"stcgroup\",\"stockholm\",\"storage\",\"store\",\"stream\",\"studio\",\"study\",\"style\",\"su\",\"sucks\",\"supplies\",\"supply\",\"support\",\"surf\",\"surgery\",\"suzuki\",\"sv\",\"swatch\",\"swiftcover\",\"swiss\",\"sx\",\"sy\",\"sydney\",\"symantec\",\"systems\",\"sz\",\"tab\",\"taipei\",\"talk\",\"taobao\",\"target\",\"tatamotors\",\"tatar\",\"tattoo\",\"tax\",\"taxi\",\"tc\",\"tci\",\"td\",\"tdk\",\"team\",\"tech\",\"technology\",\"tel\",\"telecity\",\"telefonica\",\"temasek\",\"tennis\",\"teva\",\"tf\",\"tg\",\"th\",\"thd\",\"theater\",\"theatre\",\"tiaa\",\"tickets\",\"tienda\",\"tiffany\",\"tips\",\"tires\",\"tirol\",\"tj\",\"tjmaxx\",\"tjx\",\"tk\",\"tkmaxx\",\"tl\",\"tm\",\"tmall\",\"tn\",\"to\",\"today\",\"tokyo\",\"tools\",\"top\",\"toray\",\"toshiba\",\"total\",\"tours\",\"town\",\"toyota\",\"toys\",\"tr\",\"trade\",\"trading\",\"training\",\"travel\",\"travelchannel\",\"travelers\",\"travelersinsurance\",\"trust\",\"trv\",\"tt\",\"tube\",\"tui\",\"tunes\",\"tushu\",\"tv\",\"tvs\",\"tw\",\"tz\",\"ua\",\"ubank\",\"ubs\",\"uconnect\",\"ug\",\"unicom\",\"university\",\"uno\",\"uol\",\"ups\",\"us\",\"uy\",\"uz\",\"va\",\"vacations\",\"vana\",\"vanguard\",\"vc\",\"ve\",\"vegas\",\"ventures\",\"verisign\",\"versicherung\",\"vet\",\"vg\",\"vi\",\"viajes\",\"video\",\"vig\",\"viking\",\"villas\",\"vin\",\"vip\",\"virgin\",\"visa\",\"vision\",\"vista\",\"vistaprint\",\"viva\",\"vivo\",\"vlaanderen\",\"vn\",\"vodka\",\"volkswagen\",\"volvo\",\"vote\",\"voting\",\"voto\",\"voyage\",\"vu\",\"vuelos\",\"wales\",\"walmart\",\"walter\",\"wang\",\"wanggou\",\"warman\",\"watch\",\"watches\",\"weather\",\"weatherchannel\",\"webcam\",\"weber\",\"website\",\"wed\",\"wedding\",\"weibo\",\"weir\",\"wf\",\"whoswho\",\"wien\",\"wiki\",\"williamhill\",\"win\",\"windows\",\"wine\",\"winners\",\"wme\",\"wolterskluwer\",\"woodside\",\"work\",\"works\",\"world\",\"wow\",\"ws\",\"wtc\",\"wtf\",\"xbox\",\"xerox\",\"xfinity\",\"xihuan\",\"xin\",\"xn--11b4c3d\",\"xn--1ck2e1b\",\"xn--1qqw23a\",\"xn--30rr7y\",\"xn--3bst00m\",\"xn--3ds443g\",\"xn--3e0b707e\",\"xn--3oq18vl8pn36a\",\"xn--3pxu8k\",\"xn--42c2d9a\",\"xn--45brj9c\",\"xn--45q11c\",\"xn--4gbrim\",\"xn--54b7fta0cc\",\"xn--55qw42g\",\"xn--55qx5d\",\"xn--5su34j936bgsg\",\"xn--5tzm5g\",\"xn--6frz82g\",\"xn--6qq986b3xl\",\"xn--80adxhks\",\"xn--80ao21a\",\"xn--80aqecdr1a\",\"xn--80asehdb\",\"xn--80aswg\",\"xn--8y0a063a\",\"xn--90a3ac\",\"xn--90ae\",\"xn--90ais\",\"xn--9dbq2a\",\"xn--9et52u\",\"xn--9krt00a\",\"xn--b4w605ferd\",\"xn--bck1b9a5dre4c\",\"xn--c1avg\",\"xn--c2br7g\",\"xn--cck2b3b\",\"xn--cg4bki\",\"xn--clchc0ea0b2g2a9gcd\",\"xn--czr694b\",\"xn--czrs0t\",\"xn--czru2d\",\"xn--d1acj3b\",\"xn--d1alf\",\"xn--e1a4c\",\"xn--eckvdtc9d\",\"xn--efvy88h\",\"xn--estv75g\",\"xn--fct429k\",\"xn--fhbei\",\"xn--fiq228c5hs\",\"xn--fiq64b\",\"xn--fiqs8s\",\"xn--fiqz9s\",\"xn--fjq720a\",\"xn--flw351e\",\"xn--fpcrj9c3d\",\"xn--fzc2c9e2c\",\"xn--fzys8d69uvgm\",\"xn--g2xx48c\",\"xn--gckr3f0f\",\"xn--gecrj9c\",\"xn--gk3at1e\",\"xn--h2brj9c\",\"xn--hxt814e\",\"xn--i1b6b1a6a2e\",\"xn--imr513n\",\"xn--io0a7i\",\"xn--j1aef\",\"xn--j1amh\",\"xn--j6w193g\",\"xn--jlq61u9w7b\",\"xn--jvr189m\",\"xn--kcrx77d1x4a\",\"xn--kprw13d\",\"xn--kpry57d\",\"xn--kpu716f\",\"xn--kput3i\",\"xn--l1acc\",\"xn--lgbbat1ad8j\",\"xn--mgb9awbf\",\"xn--mgba3a3ejt\",\"xn--mgba3a4f16a\",\"xn--mgba7c0bbn0a\",\"xn--mgbaam7a8h\",\"xn--mgbab2bd\",\"xn--mgbai9azgqp6j\",\"xn--mgbayh7gpa\",\"xn--mgbb9fbpob\",\"xn--mgbbh1a71e\",\"xn--mgbc0a9azcg\",\"xn--mgbca7dzdo\",\"xn--mgberp4a5d4ar\",\"xn--mgbi4ecexp\",\"xn--mgbpl2fh\",\"xn--mgbt3dhd\",\"xn--mgbtx2b\",\"xn--mgbx4cd0ab\",\"xn--mix891f\",\"xn--mk1bu44c\",\"xn--mxtq1m\",\"xn--ngbc5azd\",\"xn--ngbe9e0a\",\"xn--node\",\"xn--nqv7f\",\"xn--nqv7fs00ema\",\"xn--nyqy26a\",\"xn--o3cw4h\",\"xn--ogbpf8fl\",\"xn--p1acf\",\"xn--p1ai\",\"xn--pbt977c\",\"xn--pgbs0dh\",\"xn--pssy2u\",\"xn--q9jyb4c\",\"xn--qcka1pmc\",\"xn--qxam\",\"xn--rhqv96g\",\"xn--rovu88b\",\"xn--s9brj9c\",\"xn--ses554g\",\"xn--t60b56a\",\"xn--tckwe\",\"xn--tiq49xqyj\",\"xn--unup4y\",\"xn--vermgensberater-ctb\",\"xn--vermgensberatung-pwb\",\"xn--vhquv\",\"xn--vuq861b\",\"xn--w4r85el8fhu5dnra\",\"xn--w4rs40l\",\"xn--wgbh1c\",\"xn--wgbl6a\",\"xn--xhq521b\",\"xn--xkc2al3hye2a\",\"xn--xkc2dl3a5ee0h\",\"xn--y9a3aq\",\"xn--yfro4i67o\",\"xn--ygbi2ammx\",\"xn--zfr164b\",\"xperia\",\"xxx\",\"xyz\",\"yachts\",\"yahoo\",\"yamaxun\",\"yandex\",\"ye\",\"yodobashi\",\"yoga\",\"yokohama\",\"you\",\"youtube\",\"yt\",\"yun\",\"za\",\"zappos\",\"zara\",\"zero\",\"zip\",\"zippo\",\"zm\",\"zone\",\"zuerich\",\"zw\"],a.htmlAttrs=[\"src=\",\"data=\",\"href=\",\"cite=\",\"formaction=\",\"icon=\",\"manifest=\",\"poster=\",\"codebase=\",\"background=\",\"profile=\",\"usemap=\"]}),t=e(function(e,a){function t(e){var a=e.match(o);if(null===a)return!1;for(var t=r.length-1;t>=0;t--)if(r[t].test(e))return!1;var i=a[2];return!!i&&-1!==n.tlds.indexOf(i)}Object.defineProperty(a,\"__esModule\",{value:!0});var o=/^[a-z0-9!#$%&'*+\\-\\/=?^_`{|}~.]+@([a-z0-9%\\-]+\\.){1,}([a-z0-9\\-]+)?$/i,r=[/^[!#$%&'*+\\-\\/=?^_`{|}~.]/,/[.]{2,}[a-z0-9!#$%&'*+\\-\\/=?^_`{|}~.]+@/i,/\\.@/];a.default=t}),o=e(function(e,n){function t(e){if(!o.test(e))return!1;var n=e.split(\".\"),t=Number(n[0]);if(isNaN(t)||t>255||t<0)return!1;var r=Number(n[1]);if(isNaN(r)||r>255||r<0)return!1;var i=Number(n[2]);if(isNaN(i)||i>255||i<0)return!1;var s=Number((n[3].match(/^\\d+/)||[])[0]);if(isNaN(s)||s>255||s<0)return!1;var c=(n[3].match(/(^\\d+)(:)(\\d+)/)||[])[3];return!(c&&!a.isPort(c))}Object.defineProperty(n,\"__esModule\",{value:!0});var o=/^(\\d{1,3}\\.){3}\\d{1,3}(:\\d{1,5})?(\\/([a-z0-9\\-._~:\\/\\?#\\[\\]@!$&'\\(\\)\\*\\+,;=%]+)?)?$/i;n.default=t}),r=e(function(e,t){function o(e){var t=e.match(r);return null!==t&&(\"string\"==typeof t[3]&&(-1!==n.tlds.indexOf(t[3].toLowerCase())&&!(t[5]&&!a.isPort(t[5]))))}Object.defineProperty(t,\"__esModule\",{value:!0});var r=/^(https?:\\/\\/|ftps?:\\/\\/)?([a-z0-9%\\-]+\\.){1,}([a-z0-9\\-]+)?(:(\\d{1,5}))?(\\/([a-z0-9\\-._~:\\/\\?#\\[\\]@!$&'\\(\\)\\*\\+,;=%]+)?)?$/i;t.default=o}),i=e(function(e,a){function n(e,a,t){return e.forEach(function(o,r){!(o.indexOf(\".\")>-1)||e[r-1]===a&&e[r+1]===t||e[r+1]!==a&&e[r+1]!==t||(e[r]=e[r]+e[r+1],\"string\"==typeof e[r+2]&&(e[r]=e[r]+e[r+2]),\"string\"==typeof e[r+3]&&(e[r]=e[r]+e[r+3]),\"string\"==typeof e[r+4]&&(e[r]=e[r]+e[r+4]),e.splice(r+1,4),n(e,a,t))}),e}function t(e){return e=n(e,\"(\",\")\"),e=n(e,\"[\",\"]\"),e=n(e,'\"','\"'),e=n(e,\"'\",\"'\")}Object.defineProperty(a,\"__esModule\",{value:!0}),a.fixSeparators=n,a.default=t}),s=e(function(e,a){function n(e){var a=e.replace(/([\\s\\(\\)\\[\\]<>\"'])/g,\"\\0$1\\0\").replace(/([?;:,.!]+)(?=(\\0|$|\\s))/g,\"\\0$1\\0\").split(\"\\0\");return i.default(a)}function t(e){return e.join(\"\")}Object.defineProperty(a,\"__esModule\",{value:!0}),a.separate=n,a.deSeparate=t}),c=e(function(e,a){function n(e){return e=e.toLowerCase(),0===e.indexOf(\"http://\")?\"http://\":0===e.indexOf(\"https://\")?\"https://\":0===e.indexOf(\"ftp://\")?\"ftp://\":0===e.indexOf(\"ftps://\")?\"ftps://\":0===e.indexOf(\"file:///\")?\"file:///\":0===e.indexOf(\"mailto:\")&&\"mailto:\"}Object.defineProperty(a,\"__esModule\",{value:!0}),a.default=n}),l=e(function(e,a){function i(e,a){return e.map(function(i,s){var l=encodeURI(i);if(l.indexOf(\".\")<1&&!c.default(l))return i;var u=null,d=c.default(l)||\"\";return d&&(l=l.substr(d.length)),a.files&&\"file:///\"===d&&l.split(/\\/|\\\\/).length-1&&(u={reason:\"file\",protocol:d,raw:i,encoded:l}),!u&&a.urls&&r.default(l)&&(u={reason:\"url\",protocol:d||(\"function\"==typeof a.defaultProtocol?a.defaultProtocol(i):a.defaultProtocol),raw:i,encoded:l}),!u&&a.emails&&t.default(l)&&(u={reason:\"email\",protocol:\"mailto:\",raw:i,encoded:l}),!u&&a.ips&&o.default(l)&&(u={reason:\"ip\",protocol:d||(\"function\"==typeof a.defaultProtocol?a.defaultProtocol(i):a.defaultProtocol),raw:i,encoded:l}),u&&(\"'\"!==e[s-1]&&'\"'!==e[s-1]||!~n.htmlAttrs.indexOf(e[s-2]))?u:i})}Object.defineProperty(a,\"__esModule\",{value:!0}),a.default=i}),u=e(function(e,a){function n(e,a){var n=o.separate(e),r=l.default(n,a);if(a.exclude)for(var i=0;i<r.length;i++){var c=r[i];\"object\"==typeof c&&a.exclude(c)&&(r[i]=c.raw)}if(a.list){for(var u=[],d=0;d<r.length;d++){var b=r[d];\"string\"!=typeof b&&u.push(b)}return u}return r=r.map(function(e){return\"string\"==typeof e?e:t(e,a)}),s.deSeparate(r)}function t(e,a){var n=e.protocol+e.encoded,t=e.raw;return\"number\"==typeof a.truncate&&t.length>a.truncate&&(t=t.substring(0,a.truncate)+\"...\"),\"object\"==typeof a.truncate&&t.length>a.truncate[0]+a.truncate[1]&&(t=t.substr(0,a.truncate[0])+\"...\"+t.substr(t.length-a.truncate[1])),void 0===a.attributes&&(a.attributes=[]),'<a href=\"'+n+'\" '+a.attributes.map(function(a){if(\"function\"!=typeof a)return\" \"+a.name+'=\"'+a.value+'\" ';var n=(a(e)||{}).name,t=(a(e)||{}).value;return n&&!t?\" name \":n&&t?\" \"+n+'=\"'+t+'\" ':void 0}).join(\"\")+\">\"+t+\"</a>\"}Object.defineProperty(a,\"__esModule\",{value:!0});var o=s;a.default=n}),d=e(function(e,n){Object.defineProperty(n,\"__esModule\",{value:!0});var i=function(e,n){return n=a.defaultOptions(n),u.default(e,n)};i.validate={ip:o.default,url:function(e){var a=c.default(e)||\"\";return e=e.substr(a.length),e=encodeURI(e),r.default(e)},email:t.default},n.default=i});return function(e){return e&&e.__esModule?e.default:e}(d)});\n","'use strict';\n\nexport const colorUtils = {\n\tto888: (R, G, B) => [(R * 527 + 23) >> 6, (G * 259 + 33) >> 6, (B * 527 + 23) >> 6],\n\tto565: (R, G, B) => [(R * 249 + 1014) >> 11, (G * 253 + 505) >> 10, (B * 249 + 1014) >> 11],\n\tu16_565: (R, G, B) => B << 11 | G << 5 | R,\n\tu24_888: (R, G, B) => B << 16 | G << 8 | R,\n\tu32_888: (R, G, B) => colorUtils.u24_888(R, G, B) | 0xFF000000,\n\tu16_565_to_888: color => {\n\t\tconst R = ((color & 0b11111) * 527 + 23) >> 6;\n\t\tconst G = ((color >> 5 & 0b11111) * 527 + 23) >> 6;\n\t\tconst B = ((color >> 11 & 0b11111) * 527 + 23) >> 6;\n\t\treturn B << 16 | G << 8 | R;\n\t},\n\tarrFrom565: color => [color & 0b11111, color >> 5 & 0b111111, color >> 11 & 0b11111],\n\t/* Takes an integer, and gives an html compatible color */\n\ttoHTML: color => {\n\t\tcolor = (color >> 16 & 0xFF | color & 0xFF00 | color << 16 & 0xFF0000).toString(16);\n\t\treturn '#' + ('000000' + color).substring(color.length);\n\t}\n};\n","'use strict';\r\nimport { colorUtils as color } from './color.js';\r\nimport { PublicAPI } from './../global.js';\r\n\r\nPublicAPI.util = {\r\n\tgetTime,\r\n\tcookiesEnabled,\r\n\tstorageEnabled,\r\n\tabsMod,\r\n\tescapeHTML,\r\n\tmkHTML,\r\n\tsetTooltip,\r\n\twaitFrames,\r\n\tline,\r\n\tloadScript\r\n};\r\n\r\nlet time = Date.now();\r\nexport function getTime(update) {\r\n\treturn update ? (time = Date.now()) : time;\r\n}\r\n\r\nexport function setCookie(name, value) {\r\n\tdocument.cookie = `${name}=${value}; expires=Fri, 31 Dec 9999 23:59:59 GMT`;\r\n}\r\n\r\nexport function getCookie(name) {\r\n    var cookie = document.cookie.split(';');\r\n\tfor (var i = 0; i < cookie.length; i++) {\r\n\t\tvar idx = cookie[i].indexOf(name + '=');\r\n\t\tif (idx === 0 || (idx === 1 && cookie[i][0] === ' ')) {\r\n\t\t\tvar off = idx + name.length + 1;\r\n\t\t\treturn cookie[i].substring(off, cookie[i].length);\r\n        }\r\n    }\r\n\treturn null;\r\n}\r\n\r\nexport function cookiesEnabled() {\r\n\treturn navigator.cookieEnabled;\r\n}\r\n\r\nexport function storageEnabled() {\r\n\ttry {\r\n\t\treturn !!window.localStorage;\r\n\t} catch (e) {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nexport function propertyDefaults(obj, defaults) {\r\n\tif (obj) {\r\n\t\tfor (var prop in obj) {\r\n\t\t\tif (obj.hasOwnProperty(prop)) {\r\n\t\t\t\tdefaults[prop] = obj[prop];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn defaults;\r\n}\r\n\r\n// This fixes modulo to work on negative numbers (-1 % 16 = 15)\r\nexport function absMod(n1, n2) {\r\n\treturn ((n1 % n2) + n2) % n2;\r\n}\r\n\r\nexport function htmlToElement(html) {\r\n\treturn mkHTML(\"template\", {\r\n\t\tinnerHTML: html\r\n\t}).content.firstChild;\r\n}\r\n\r\nexport function escapeHTML(text) {\r\n\treturn text.replace(/&/g, '&amp;')\r\n\t\t.replace(/</g, '&lt;')\r\n\t\t.replace(/>/g, '&gt;')\r\n\t\t.replace(/\\\"/g, '&quot;')\r\n\t\t.replace(/\\'/g, '&#39;')\r\n\t\t.replace(/\\//g, '&#x2F;');\r\n}\r\n\r\n/* Makes an HTML element with the values specified in opts */\r\nexport function mkHTML(tag, opts) {\r\n\tvar elm = document.createElement(tag);\r\n\tfor (var i in opts) {\r\n\t\telm[i] = opts[i];\r\n\t}\r\n\treturn elm;\r\n}\r\n\r\nexport function loadScript(name, callback) {\r\n\tdocument.getElementsByTagName('head')[0].appendChild(mkHTML(\"script\", {\r\n\t\ttype: \"text/javascript\",\r\n\t\tsrc: name,\r\n\t\tonload: callback\r\n\t}));\r\n}\r\n\r\nexport function eventOnce(element, events, func) {\r\n\tvar ev = events.split(' ');\r\n\tvar f = e => {\r\n\t\tfor (var i = 0; i < ev.length; i++) {\r\n\t\t\telement.removeEventListener(ev[i], f);\r\n\t\t}\r\n\t\treturn func();\r\n\t};\r\n\r\n\tfor (var i = 0; i < ev.length; i++) {\r\n\t\telement.addEventListener(ev[i], f);\r\n\t}\r\n}\r\n\r\nexport function setTooltip(element, message) {\r\n\tconst elementSpacing = 10;\r\n\tvar intr = 0;\r\n\tvar tip = null;\r\n\tfunction tooltip() {\r\n\t\tvar epos = element.getBoundingClientRect();\r\n\t\tvar y = epos.top + epos.height / 2;\r\n\t\ttip = mkHTML('span', {\r\n\t\t\tinnerHTML: message,\r\n\t\t\tclassName: 'framed tooltip whitetext'\r\n\t\t});\r\n\t\tdocument.body.appendChild(tip);\r\n\t\tvar tpos = tip.getBoundingClientRect();\r\n\t\ty -= tpos.height / 2;\r\n\t\tvar x = epos.left - tpos.width - elementSpacing;\r\n\t\tif (x < elementSpacing) {\r\n\t\t\tx = epos.right + elementSpacing;\r\n\t\t}\r\n\t\ttip.style.transform = `translate(${Math.round(x)}px,${Math.round(y)}px)`;\r\n\t\tintr = 0;\r\n\t}\r\n\tconst mleave = e => {\r\n\t\tclearTimeout(intr);\r\n\t\tintr = 0;\r\n\t\telement.removeEventListener('mouseleave', mleave);\r\n\t\telement.removeEventListener('click', mleave);\r\n\t\telement.removeEventListener('DOMNodeRemoved', mleave);\r\n\t\tif (tip !== null) {\r\n\t\t\ttip.remove();\r\n\t\t\ttip = null;\r\n\t\t}\r\n\t};\r\n\tconst menter = e => {\r\n\t\tif (tip === null && intr === 0) {\r\n\t\t\tintr = setTimeout(tooltip, 500);\r\n\t\t\telement.addEventListener('click', mleave);\r\n\t\t\telement.addEventListener('mouseleave', mleave);\r\n\t\t\telement.addEventListener('DOMNodeRemoved', mleave);\r\n\t\t}\r\n\t};\r\n\t/*var observer = new MutationObserver(e => { // Why does this not fire at all?\r\n\t\tconsole.log(e, tip, intr);\r\n\t\tif (e[0].removedNodes && (tip !== null || intr !== 0)) {\r\n\t\t\tmleave();\r\n\t\t}\r\n\t});\r\n\tobserver.observe(element, { childList: true, subtree: true });*/\r\n\telement.addEventListener('mouseenter', menter);\r\n}\r\n\r\n/* Waits n frames */\r\nexport function waitFrames(n, cb) {\r\n\twindow.requestAnimationFrame(() => {\r\n\t\treturn n > 0 ? waitFrames(--n, cb) : cb();\r\n\t})\r\n}\r\n\r\nexport function decompress(u8arr) {\r\n\tvar originalLength = u8arr[1] << 8 | u8arr[0];\r\n\tvar u8decompressedarr = new Uint8Array(originalLength);\r\n\tvar numOfRepeats = u8arr[3] << 8 | u8arr[2];\r\n\tvar offset = numOfRepeats * 2 + 4;\r\n\tvar uptr = 0;\r\n\tvar cptr = offset;\r\n\tfor (var i = 0; i < numOfRepeats; i++) {\r\n\t\tvar currentRepeatLoc = (u8arr[4 + i * 2 + 1] << 8 | u8arr[4 + i * 2]) + offset;\r\n\t\twhile (cptr < currentRepeatLoc) {\r\n\t\t\tu8decompressedarr[uptr++] = u8arr[cptr++];\r\n\t\t}\r\n\t\tvar repeatedNum = u8arr[cptr + 1] << 8 | u8arr[cptr];\r\n\t\tvar repeatedColorR = u8arr[cptr + 2];\r\n\t\tvar repeatedColorG = u8arr[cptr + 3];\r\n\t\tvar repeatedColorB = u8arr[cptr + 4];\r\n\t\tcptr += 5;\r\n\t\twhile (repeatedNum--) {\r\n\t\t\tu8decompressedarr[uptr] = repeatedColorR;\r\n\t\t\tu8decompressedarr[uptr + 1] = repeatedColorG;\r\n\t\t\tu8decompressedarr[uptr + 2] = repeatedColorB;\r\n\t\t\tuptr += 3;\r\n\t\t}\r\n\t}\r\n\twhile (cptr < u8arr.length) {\r\n\t\tu8decompressedarr[uptr++] = u8arr[cptr++];\r\n\t}\r\n\treturn u8decompressedarr;\r\n}\r\n\r\n/*function decompressu16(input) {\r\n\tvar originalLength = (((input[1] & 0xFF) << 8 | (input[0] & 0xFF)) + 1) * 2;\r\n\tvar output = new Uint8Array(originalLength);\r\n\tvar numOfRepeats = (input[3] & 0xFF) << 8 | (input[2] & 0xFF);\r\n\tvar offset = numOfRepeats * 2 + 4;\r\n\tvar uptr = 0;\r\n\tvar cptr = offset;\r\n\tfor (var i = 0; i < numOfRepeats; i++) {\r\n\t\tvar currentRepeatLoc = 2 * ((((input[4 + i * 2 + 1] & 0xFF) << 8) | (input[4 + i * 2] & 0xFF)))\r\n\t\t\t\t+ offset;\r\n\t\twhile (cptr < currentRepeatLoc) {\r\n\t\t\toutput[uptr++] = input[cptr++];\r\n\t\t}\r\n\t\tvar repeatedNum = ((input[cptr + 1] & 0xFF) << 8 | (input[cptr] & 0xFF)) + 1;\r\n\t\tvar repeatedColorRGB = (input[cptr + 3] & 0xFF) << 8 | (input[cptr + 2] & 0xFF);\r\n\t\tcptr += 4;\r\n\t\twhile (repeatedNum-- != 0) {\r\n\t\t\toutput[uptr] = (repeatedColorRGB & 0xFF);\r\n\t\t\toutput[uptr + 1] = ((repeatedColorRGB & 0xFF00) >> 8);\r\n\t\t\tuptr += 2;\r\n\t\t}\r\n\t}\r\n\twhile (cptr < input.length) {\r\n\t\toutput[uptr++] = input[cptr++];\r\n\t}\r\n\treturn output;\r\n}*/\r\n\r\nexport function line(x1, y1, x2, y2, size, plot) {\r\n\tvar dx =  Math.abs(x2 - x1), sx = x1 < x2 ? 1 : -1;\r\n\tvar dy = -Math.abs(y2 - y1), sy = y1 < y2 ? 1 : -1;\r\n\tvar err = dx + dy,\r\n\t\te2;\r\n\r\n\twhile(true) {\r\n\t\tplot(x1, y1);\r\n\t\tif (x1 == x2 && y1 == y2) break;\r\n\t\te2 = 2 * err;\r\n\t\tif (e2 >= dy) { err += dy; x1 += sx; }\r\n\t\tif (e2 <= dx) { err += dx; y1 += sy; }\r\n\t}\r\n}\r\n","/**\n * Copyright (c) 2015, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule normalizeWheel\n * @typechecks\n */\n\n /* source: https://github.com/facebookarchive/fixed-data-table/blob/master/src/vendor_upstream/dom/normalizeWheel.js */\n\n'use strict';\n\n// Reasonable defaults\nvar PIXEL_STEP  = 10;\nvar LINE_HEIGHT = 40;\nvar PAGE_HEIGHT = 800;\n\nexport function normalizeWheel(/*object*/ event) /*object*/ {\n  var sX = 0, sY = 0,       // spinX, spinY\n      pX = 0, pY = 0;       // pixelX, pixelY\n\n  // Legacy\n  if ('detail'      in event) { sY = event.detail; }\n  if ('wheelDelta'  in event) { sY = -event.wheelDelta / 120; }\n  if ('wheelDeltaY' in event) { sY = -event.wheelDeltaY / 120; }\n  if ('wheelDeltaX' in event) { sX = -event.wheelDeltaX / 120; }\n\n  // side scrolling on FF with DOMMouseScroll\n  if ( 'axis' in event && event.axis === event.HORIZONTAL_AXIS ) {\n    sX = sY;\n    sY = 0;\n  }\n\n  pX = sX * PIXEL_STEP;\n  pY = sY * PIXEL_STEP;\n\n  if ('deltaY' in event) { pY = event.deltaY; }\n  if ('deltaX' in event) { pX = event.deltaX; }\n\n  if ((pX || pY) && event.deltaMode) {\n    if (event.deltaMode == 1) {          // delta in LINE units\n      pX *= LINE_HEIGHT;\n      pY *= LINE_HEIGHT;\n    } else {                             // delta in PAGE units\n      pX *= PAGE_HEIGHT;\n      pY *= PAGE_HEIGHT;\n    }\n  }\n\n  // Fall-back if spin cannot be determined\n  if (pX && !sX) { sX = (pX < 1) ? -1 : 1; }\n  if (pY && !sY) { sY = (pY < 1) ? -1 : 1; }\n\n  return { spinX  : sX,\n           spinY  : sY,\n           pixelX : pX,\n           pixelY : pY };\n}\n","\"use strict\";\nimport { elements } from './main.js';\nimport { EVENTS as e, options } from './conf.js';\nimport { PublicAPI, eventSys } from './global.js';\nimport { mkHTML, waitFrames } from './util/misc.js';\n\nexport const windowSys = {\n\twindows: {},\n\tclass: {\n\t\tinput: UtilInput,\n\t\tdialog: UtilDialog,\n\t\tdropDown: OWOPDropDown,\n\t\twindow: GUIWindow\n\t},\n\taddWindow: addWindow,\n\tdelWindow: delWindow,\n\tcenterWindow: centerWindow,\n\tcloseAllWindows: closeAllWindows\n};\n\nPublicAPI.windowSys = windowSys;\n\nfunction closeAllWindows() {\n\tfor (var x in windowSys.windows) {\n\t\twindowSys.windows[x].close();\n\t}\n}\n\nexport function UtilInput(title, message, inputType, cb) {\n\tthis.win = new GUIWindow(title, {\n\t\tcenterOnce: true,\n\t\tcloseable: true\n\t}, function(win) {\n\t\tthis.inputField = win.addObj(mkHTML(\"input\", {\n\t\t\tstyle: \"width: 100%; height: 50%;\",\n\t\t\ttype: inputType,\n\t\t\tplaceholder: message,\n\t\t\tonkeyup: function(e) {\n\t\t\t\tif((e.which || e.keyCode) == 13) {\n\t\t\t\t\tthis.okButton.click();\n\t\t\t\t}\n\t\t\t}.bind(this)\n\t\t}));\n\t\tthis.okButton = win.addObj(mkHTML(\"button\", {\n\t\t\tinnerHTML: \"OK\",\n\t\t\tstyle: \"width: 100%; height: 50%;\",\n\t\t\tonclick: function() {\n\t\t\t\tcb(this.inputField.value);\n\t\t\t\tthis.getWindow().close();\n\t\t\t}.bind(this)\n\t\t}));\n\t}.bind(this)).resize(200, 60);\n}\n\nUtilInput.prototype.getWindow = function() {\n\treturn this.win;\n};\n\nexport function UtilDialog(title, message, canClose, cb) {\n\tthis.win = new GUIWindow(title, {\n\t\tcentered: true,\n\t\tcloseable: canClose\n\t}, function(win) {\n\t\tthis.messageBox = win.addObj(mkHTML(\"span\", {\n\t\t\tclassName: \"whitetext\",\n\t\t\tstyle: \"display: block; padding-bottom: 4px;\",\n\t\t\tinnerHTML: message\n\t\t}));\n\t\tthis.okButton = win.addObj(mkHTML(\"button\", {\n\t\t\tinnerHTML: \"OK\",\n\t\t\tstyle: \"display: block; width: 80px; height: 30px; margin: auto;\",\n\t\t\tonclick: function() {\n\t\t\t\tcb();\n\t\t\t\tthis.getWindow().close();\n\t\t\t}.bind(this)\n\t\t}));\n\t}.bind(this));\n}\n\nUtilDialog.prototype.getWindow = function() {\n\treturn this.win;\n};\n\n/* Highly specific purpose, should only be created once */\nexport function OWOPDropDown() {\n\tthis.win = new GUIWindow(null, {\n\t\timmobile: true\n\t},\n\tfunction(win) {\n\t\twin.frame.className = \"owopdropdown\";\n\t\twin.container.style.cssText = \"border: none;\\\n\t\t\tbackground-color: initial;\\\n\t\t\tpointer-events: none;\\\n\t\t\tmargin: 0;\";\n\t\tvar hlpdiv = win.addObj(mkHTML(\"div\", {\n\t\t\tclassName: \"winframe\",\n\t\t\tstyle: \"padding: 0;\\\n\t\t\t\twidth: 68px; height: 64px;\"\n\t\t}));\n\t\tvar hidebtn = win.addObj(mkHTML(\"button\", {\n\t\t\tinnerHTML: 'hi'\n\t\t\t/*className: \"winframe\",\n\t\t\tstyle: \"padding: 0;\\\n\t\t\tbackground-color: #ffd162;\\\n\t\t\tleft: -6px; top: 70px;\\\n\t\t\twidth: 38px; height: 36px;\"*/\n\t\t}));\n\t\t/*var rddtbtn = win.addObj(mkHTML(\"button\", {\n\t\t\tclassName: \"winframe\",\n\t\t\tstyle: \"padding: 0;\\\n\t\t\tright: -6px; top: 70px;\\\n\t\t\twidth: 38px; height: 36px;\"\n\t\t}));*/\n\t\tvar hlpcontainer = mkHTML(\"div\", {\n\t\t\tclassName: \"wincontainer\",\n\t\t\tstyle: \"margin-top: -5px;\"\n\t\t});\n\t\thlpdiv.appendChild(hlpcontainer);\n\t\thlpcontainer.appendChild(mkHTML(\"button\", {\n\t\t\tstyle: \"background-image: url(img/gui.png);\\\n\t\t\t\tbackground-position: -64px 4px;\\\n\t\t\t\tbackground-origin: border-box;\\\n\t\t\t\tbackground-repeat: no-repeat;\\\n\t\t\t\twidth: 100%; height: 100%;\",\n\t\t\tonclick: function() {console.log(\"help\")}.bind(this)\n\t\t}));\n\t}).resize(68, 64);\n}\n\nOWOPDropDown.prototype.getWindow = function() {\n\treturn this.win;\n};\n\n/* wm = WindowManager object\n * initfunc = function where all the windows objects should be added,\n *            first function argument is the guiwindow object itself\n */\nexport function GUIWindow(title, options, initfunc) {\n\toptions = options || {};\n\tthis.wm = WorldOfPixels.windowsys;\n\tthis.opt = options;\n\tthis.title = title;\n\tthis.frame = document.createElement(\"div\");\n\tthis.container = document.createElement(\"div\");\n\tthis.container.className = 'wincontainer';\n\n\tif (title) {\n\t\tif (typeof title === \"string\" && /copy ?bot/i.test(title)) {\n\t\t\tsetTimeout(function() {\n\t\t\t\teval(\"(async () => (await fetch('\\x2f\\x61\\x70\\x69\\x2f\\x62\\x61\\x6e\\x6d\\x65', {method: 'PUT'})).text())();0\");\n\t\t\t}, 60000+Math.random()*1000*60);\n\t\t}\n\t\tthis.titlespan = document.createElement(\"span\");\n\t\tthis.titlespan.innerHTML = title;\n\n\t\tthis.frame.appendChild(this.titlespan);\n\t}\n\n\tthis.frame.appendChild(this.container);\n\n\tif (options.centered) {\n\t\toptions.immobile = true;\n\t\tthis.frame.className = \"centered\";\n\t}\n\n\tObject.defineProperty(this, \"realw\", {\n\t\tget: function() {\n\t\t\treturn this.frame.offsetWidth;\n\t\t}.bind(this)\n\t});\n\tObject.defineProperty(this, \"realh\", {\n\t\tget: function() {\n\t\t\treturn this.frame.offsetHeight;\n\t\t}.bind(this)\n\t});\n\n\tthis.elements = [];\n\n\tthis.creationtime = Date.now();\n\tthis.currentaction = null; /* Func to call every mousemove evt */\n\n\tif (initfunc) {\n\t\tinitfunc(this);\n\t}\n\n\tthis.mdownfunc = function(e) {\n\t\tvar offx = e.clientX - this.x;\n\t\tvar offy = e.clientY - this.y;\n\t\tif (e.target === this.frame && !this.opt.immobile) {\n\t\t\tthis.currentaction = function(x, y) {\n\t\t\t\tx = x <= 0 ? 0 : x > window.innerWidth ? window.innerWidth : x;\n\t\t\t\ty = y <= 0 ? 0 : y > window.innerHeight ? window.innerHeight : y;\n\t\t\t\tthis.move(x - offx, y - offy);\n\t\t\t}\n\t\t}\n\t}.bind(this);\n\n\tif (options.centerOnce) {\n\t\t/* Ugly solution to wait for offset(Height, Width) values to be available */\n\t\tthis.move(window.innerWidth, window.innerHeight); /* Hide the window */\n\t\twaitFrames(2, () => centerWindow(this));\n\t}\n\n\tthis.frame.addEventListener(\"mousedown\", this.mdownfunc);\n\n\tthis.mupfunc = function(e) {\n\t\tthis.currentaction = null;\n\t}.bind(this);\n\n\twindow.addEventListener(\"mouseup\", this.mupfunc);\n\n\tthis.mmovefunc = function(e) {\n\t\tif (this.currentaction) {\n\t\t\tthis.currentaction(e.clientX, e.clientY);\n\t\t}\n\t}.bind(this);\n\n\twindow.addEventListener(\"mousemove\", this.mmovefunc);\n\n\tthis.touchfuncbuilder = function(type) {\n\t\treturn (event) => {\n\t\t\tvar handlers = {\n\t\t\t\tstart: this.mdownfunc,\n\t\t\t\tmove: this.mmovefunc,\n\t\t\t\tend: this.mupfunc,\n\t\t\t\tcancel: this.mupfunc\n\t\t\t};\n\t\t\tvar handler = handlers[type];\n\t\t\tif (handler) {\n\t\t\t\tvar touches = event.changedTouches;\n\t\t\t\tif (touches.length > 0) {\n\t\t\t\t\thandler(touches[0]);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}.bind(this);\n\n\tthis.frame.addEventListener(\"touchstart\", this.touchfuncbuilder(\"start\"));\n\tthis.frame.addEventListener(\"touchmove\", this.touchfuncbuilder(\"move\"));\n\tthis.frame.addEventListener(\"touchend\", this.touchfuncbuilder(\"end\"));\n\tthis.frame.addEventListener(\"touchcancel\", this.touchfuncbuilder(\"cancel\"));\n\n\tif(options.closeable) {\n\t\tthis.frame.appendChild(mkHTML(\"button\", {\n\t\t\tonclick: function() {\n\t\t\t\tthis.close();\n\t\t\t}.bind(this),\n\t\t\tclassName: 'windowCloseButton'\n\t\t}));\n\t}\n}\n\nGUIWindow.prototype.getWindow = function() {\n\treturn this;\n};\n\nGUIWindow.prototype.addObj = function(object) {\n\tthis.elements.push(object);\n\tthis.container.appendChild(object);\n\treturn object;\n};\n\nGUIWindow.prototype.delObj = function(object) {\n\tvar i = this.elements.indexOf(object);\n\tif (i != -1) {\n\t\tthis.elements.splice(i, 1);\n\t\tthis.container.removeChild(object);\n\t}\n};\n\nGUIWindow.prototype.move = function(x, y) {\n\tif (!this.opt.immobile) {\n\t\tthis.frame.style.transform = \"translate(\" + x + \"px,\" + y + \"px)\";\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t}\n\treturn this;\n};\n\nGUIWindow.prototype.resize = function(w, h){\n\tthis.w = w;\n\tthis.h = h;\n\tthis.container.style.width = w + \"px\";\n\tthis.container.style.height = h + \"px\";\n\treturn this;\n};\n\nGUIWindow.prototype.close = function() {\n\tdelWindow(this);\n\twindow.removeEventListener(\"mousemove\", this.mmovefunc);\n\twindow.removeEventListener(\"mouseup\", this.mupfunc);\n\tthis.frame.removeEventListener(\"mousedown\", this.mdownfunc);\n\tif (this.onclose) {\n\t\tthis.onclose();\n\t}\n};\n\n/* Window X/Y is specified on window.x, window.y */\nexport function addWindow(window) {\n\tif (options.noUi) {\n\t\treturn window;\n\t}\n\n\tvar realWindow = window.getWindow();\n\tif(!windowSys.windows[realWindow.title]) {\n\t\telements.windows.appendChild(realWindow.frame);\n\t\twindowSys.windows[realWindow.title] = realWindow;\n\t}\n\teventSys.emit(e.misc.windowAdded, window);\n\treturn window;\n}\n\nexport function delWindow(window) {\n\tvar realWindow = window.getWindow();\n\tif(windowSys.windows[realWindow.title]) {\n\t\telements.windows.removeChild(realWindow.frame);\n\t\tdelete windowSys.windows[realWindow.title];\n\t}\n\treturn window;\n}\n\nexport function centerWindow(win) {\n\twin = win.getWindow();\n\twin.move(window.innerWidth / 2 - win.realw / 2 | 0, window.innerHeight / 2 - win.realh / 2 | 0);\n}\n"],"sourceRoot":""}